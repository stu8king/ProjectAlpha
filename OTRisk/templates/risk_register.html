{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>AnzenOT - GRC for OT</title>
    <link rel="icon" href="{% static 'images/AnzenOTIconBlack.png' %}" type="image/x-icon">
    <!-- Load jQuery (only one version) -->
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>AnzenOT - GRC for OT</title>
    <link rel="icon" href="{% static 'images/AnzenOTIconBlack.png' %}" type="image/x-icon">
    <!-- Load jQuery (only one version) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap and related scripts -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>

<!-- DataTables -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>

<!-- Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- AnyChart -->
<script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-bundle.min.js"></script>
<link href="https://cdn.anychart.com/releases/8.10.0/css/anychart-ui.min.css" rel="stylesheet" type="text/css">
<script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-exports.min.js"></script>
<script src="https://cdn.anychart.com/releases/v8/js/anychart-bullet.min.js"></script>
<script src="https://cdn.anychart.com/releases/8.11.1/js/anychart-base.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.1/js/anychart-cartesian.min.js"></script>




    <script src="{% static 'OTRisk/assesscyberpha.js' %}"></script>
    {% load django_bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}

    <title>Assess CyberPHA</title>
    <style>
    .small-font {
        font-size: 0.8rem; /* adjust as needed */
   }
.form-group {
border: 1px solid #464748; /* Border color */
box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.5); /* Outer shadow */
background-color: #5E6266; /* Lighter shade of #464748 */
padding: 15px; /* Optional: for internal spacing */
}
body {
        background-color: #464748;
        color: #d3d1cd;
    }
.sidebar {
    display: flex;
    height: 100vh;
    background-color: #2D2E30; /* Darker shade for sidebar */
    padding: 1vw;
    width: 10vw; /* Sidebar width */
}
.sidebar-logo {
    padding: 1vw;
    text-align: center;
}
    .nav-sidebar {
        display: flex;
        flex-direction: column;
        padding-left: 0;
        list-style: none;
    }
    .nav-sidebar .nav-item {
        padding: 0.1vw;
        /* border-bottom: 1px solid  #fac330; /* Light orange line */
        margin: 0 10%;
        gap: 1rem;
    }
   .nav-sidebar .nav-link {
        color: #d3d1cd;
        border-radius: 0;
        transition: color 0.3s ease-in-out;
        font-size: 0.7rem;
    }
    .nav-sidebar .nav-link:hover, .nav-sidebar .nav-link.active {
        background-color: #3A5F5F;
        color: #E0E0E0;
    }
    /* Enhance dropdown menu */
    .dropdown-menu {
        background-color: #d3d1cd;
        border: none;
    }
    .dropdown-item:hover, .dropdown-item:focus {
        background-color: #fac330; /* Light orange background for hovered dropdown items */
        color: #2D2E30;
    }
    .content {
        padding: 20px;
    }
   .custom-main-content {
    position: relative; /* Adjust if necessary */
    width: calc(100% - 200px); /* Adjust based on the actual sidebar width */
    max-width: calc(90vw - 200px); /* 90% of the viewport width minus sidebar width */
    margin-left: 200px; /* Push content to the right of the sidebar */
}

@media (min-width: 992px) { /* Adjusting for Bootstrap's large devices breakpoint */
    .custom-main-content {
        width: calc(100% - 200px);
        max-width: calc(90vw - 200px);
        margin-left: 100px;
    }
}


    .table tbody tr:hover {
    cursor: pointer;
    }



    .heatmap {
        border-collapse: collapse;
    }
    .heatmap td {
        width: 60px;
        height: 60px;
        text-align: center;
        border: 1px solid #ccc;
    }
    .Low { background-color: #d8e6d6; }
    .Low-Medium { background-color: #f7e5a0; }
    .Medium { background-color: #f9d56e; }
    .Medium-High { background-color: #f9a56e; }
    .High { background-color: #f95d6a; }

    .body {
        font-size: 10px;
    }
.custom-main-content .container {
    width: 100%; /* Ensure the container fills the custom-main-content */
    max-width: none; /* Override Bootstrap's max-width for containers if necessary */
}
.top-strip {
    background-color: #464748; /* Same as body background for seamless integration */
    color: #d3d1cd; /* Text color */
    padding: 10px 20px; /* Adjust as needed */
    padding-left: 100px; /* Align with the end of the sidebar */
    width: calc(100% - 200px); /* Adjust based on the actual sidebar width */
    box-sizing: border-box;
}

.page-title {
    margin: 0; /* Remove default margins */
    font-size: 1.5rem; /* Adjust size as needed */
}

@media (max-width: 992px) {
    .top-strip {
        padding-left: 0;
        width: 100%;
    }
}
.nav-sidebar .nav-link img {
    width: 1.25em; /* Scales with the font size */
    height: 1.25em; /* Scales with the font size */
}
/* Larger icons for tablets */
@media (min-width: 768px) {
    .nav-sidebar .nav-link img {
    width: 1.5em;
    height: 1.5em;
    }
}
/* Even larger icons for desktops */
@media (min-width: 992px) {
    .nav-sidebar .nav-link img {
    width: 1.75em;
    height: 1.75em;
    }
}
    .nav-sidebar .nav-link img {
    width: 1.25em; /* Scales with the font size */
    height: 1.25em; /* Scales with the font size */
}
/* Larger icons for tablets */
@media (min-width: 768px) {
    .nav-sidebar .nav-link img {
    width: 1.5em;
    height: 1.5em;
    }
}
/* Even larger icons for desktops */
@media (min-width: 992px) {
    .nav-sidebar .nav-link img {
    width: 1.75em;
    height: 1.75em;
    }
}
</style>


</head>
<body style="background-color: #464748">


<script>anychart.licenseKey("iotarisk.com-f1ad231c-886c1b88");</script>

<div class="container-fluid">

    <div class="row">
       {% include 'menu_bar.html' %}

            <main role="main" class="col-md-10 ml-sm-auto col-lg-12  custom-main-content" >
            <div class="top-strip">
                <h1 class="page-title">Risk Register@AnzenOT (Beta)</h1>
            </div>
            <div class="container mt-5" >
                <div class="row">
                  <div class="col-md-2">
                      <div class="form-group">

                            <h5><i class="bi bi-funnel"></i> </h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Low" id="filterLow">
                                <label class="form-check-label" for="filterLow">
                                    Low (<span id="countLow">0</span>)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Low/Medium" id="filterLowMedium">
                                <label class="form-check-label" for="filterLowMedium">
                                    Low/Medium (<span id="countLowMedium">0</span>)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Medium" id="filterMedium">
                                <label class="form-check-label" for="filterMedium">
                                    Medium (<span id="countMedium">0</span>)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Medium/High" id="filterMediumHigh">
                                <label class="form-check-label" for="filterMediumHigh">
                                    Medium/High (<span id="countMediumHigh">0</span>)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="High" id="filterHigh">
                                <label class="form-check-label" for="filterHigh">
                                    High (<span id="countHigh">0</span>)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="NoValue" id="filterNoValue">
                                <label class="form-check-label" for="filterNoValue">
                                    No Selection (<span id="countNoValue">0</span>)
                                </label>
                            </div>
                      </div>
                </div>

        <div class="col-md-10">

            <div class="form-group">
                <table class="table table-bordered table-striped compact" id="tbl_risk_register" style="font-size: 10px; width:100%">
                    <thead>
                        <tr>
                            <th>Facility Name</th>
                            <th>Assessment Unit</th>
                            <th>Risk Scenario</th>
                            <th>Residual Risk</th>
                            <th>BIA</th>
                            <th>Est Costs (Low/Medium/High)</th>
                            <th>Probability</th>
                            <th>Snapshots</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in data %}
                        <tr data-id="{{ item.ID }}">

                            <td><a href="{% url 'OTRisk:iotaphamanager_with_id' item.CyberPHA__ID %}">{{ item.CyberPHA__FacilityName }}</a>
            </td>
                            <td>{{ item.CyberPHA__AssessmentUnit }}</td>
                            <td>{{ item.Scenario }}</td>
                            <td>
                                {% if item.RRa == "Low" %}
                                    <span style="color:green;">●</span>
                                {% elif item.RRa == "Low/Medium" %}
                                    <span style="color:olive;">●</span>
                                {% elif item.RRa == "Medium" %}
                                    <span style="color:yellow;">●</span>
                                {% elif  item.RRa == "Medium/High" %}
                                    <span style="color:orange;">●</span>
                                {% elif item.RRa == "High" %}
                                    <span style="color:red;">●</span>
                                {% endif %}
                                {{ item.RRa }}
                            </td>
                            <td>{{ item.business_impact_analysis_score }}({{ item.business_impact_analysis_code }})</td>
                            <td>${{ item.sle_low|intcomma }}/${{ item.sle|intcomma }}/${{ item.sle_high|intcomma }}</td>


                            <td>
                                {% if item.probability < 25 %}
                                    <span style="color:green;">●</span>
                                {% elif item.probability >= 25 and item.probability < 50 %}
                                    <span style="color:yellow;">●</span>
                                {% elif item.probability >= 50 and item.probability < 75 %}
                                    <span style="color:orange;">●</span>
                                {% elif item.probability >= 75 %}
                                    <span style="color:red;">●</span>
                                {% endif %}
                                {{ item.probability }}%
                            </td>
                            <td>
                                {% if item.snapshots == 1 %}
                                    <a href="{% url 'OTRisk:view_snapshots' item.ID %}">View Snapshots</a>
                                {% endif %}
                            </td>

                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div> <!-- risk register table -->

    <div class="row" style="height: 10px"></div>
                </div>
</div>
<script>

 $(document).ready(function() {
    $("table tbody tr").click(function() {
        var scenarioId = $(this).data("id");
        loadScenarioDetails(scenarioId);
    });
    $("table tbody tr:first").trigger('click');
});


$(document).ready(function() {
    $(document).on('click', '#saveRiskData', function() {
        var formData = $("#riskForm").serialize();
        $.post("{% url 'OTRisk:save_risk_data' %}", formData, function(response) {
            if(response.status == 'success') {
                alert("Data saved successfully!");
            } else {
                alert("Error saving data!");
            }
        });
    });
});



    </script>
<script>
$(document).ready(function() {
    function updateTable() {
        let selectedRisks = $('input[type="checkbox"]:checked').map(function() {
            return $(this).val();
        }).get();

        $('#tbl_risk_register tbody tr').each(function() {
            let cellText = $(this).find('td:nth-child(4)').text().trim();
            let riskText = cellText.replace(/^[^\w]+/, ''); // Clean leading symbols for safety

            // Determine if the row should be shown
            let showRow = false;
            if (selectedRisks.length === 0) {
                showRow = true; // No filter selected, show all
            } else {
                // Explicitly handle each case
                if (riskText === "" && selectedRisks.includes("NoValue")) {
                    showRow = true;
                } else if (selectedRisks.includes(riskText)) {
                    showRow = true;
                }
            }

            $(this).toggle(showRow);
        });
    }

    $('input[type="checkbox"]').on('change', updateTable);
    updateTable(); // Initial update

    function updateCounts() {
        let riskValues = {
            'Low': 0,
            'Medium': 0,
            'High': 0,
            'Low/Medium': 0,
            'Medium/High': 0,
            'NoValue': 0
        };

        $('#tbl_risk_register tbody tr').each(function() {
            let cellText = $(this).find('td:nth-child(4)').text().trim();
            let riskText = cellText.replace(/^[^\w]+/, ''); // Clean leading symbols

            if (riskText === "") {
                riskValues['NoValue']++;
            } else if (riskValues.hasOwnProperty(riskText)) {
                riskValues[riskText]++;
            }
        });

        // Update counts in the UI
        for (let risk in riskValues) {
            $('#count' + risk.replace(/\//g, '').replace('NoValue', 'NoValue')).text(riskValues[risk]);
        }
    }

    updateCounts(); // Call this function to update counts on page load
});
</script>


<div class="row">
<div class="col-md-2 " ></div>
<div class="col-md-10 ">
<div class="form-group">
<div class="card" style="display: none;" id="scenarioDetailsCard">
<div class="card-header">
Scenario Details
</div>
<div class="card-body" id="scenarioDetails">


<strong>ID:</strong> <span id="detail_ID"></span> <strong>CyberPHA:</strong> <span id="detail_CyberPHA"></span>



<div class="row">
    <div class="col-md-4">
        <div class="card shadow-lg inner-card">
            <div class="card-body">
                <div class="row">
                    <h6 class="card-title text-left card-title-light">Scenario:</h6>
                </div>
                <div class="row" style="font-size: 12px">
                    <span id="scenario_description"></span>
                </div>
            </div>
        </div>
        <br>
        <div class="card shadow-lg inner-card">
            <div class="card-body">
                <div class="row">
                    <h6 class="card-title text-left card-title-light">Consequences:</h6>
                </div>
                <div class="row" style="font-size: 12px">
                    <span id="consequence_description"></span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-8">
        <div class="row">
            <div class="col-md-3" style="height:100%">
                <div class="card shadow-lg inner-card" style="height:100%;">
                    <div class="card-body">
                        <div class="row justify-content-center align-items-center" style="font-size: 12px">
                            Attack Success Probability
                        </div>
                        <div class="row justify-content-center align-items-center" style="font-size: 16px">
                            <div id="gaugeProbContainer"></div>
                            <br>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card shadow-lg inner-card">
                    <div class="card-body">
                        <div class="row justify-content-center align-items-center" style="font-size: 12px">
                            Control Effectiveness
                        </div>
                        <div class="row justify-content-center align-items-center" style="font-size: 16px">
                            <div id="gaugeEffectivenessContainer"></div>
                            <br>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow-lg inner-card">
                    <div class="card-body">
                        <div class="row justify-content-center align-items-center" style="font-size: 12px">
                            Scenario Likelihood
                        </div>
                    <div class="row justify-content-center align-items-center" style="font-size: 16px">
                        <div id="gaugeLikelihoodContainer"></div>
                        <br>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-lg inner-card">
                <div class="card-body">
                    <div class="row justify-content-center align-items-center" style="font-size: 12px">
                        Residual Risk
                    </div>
                    <div class="row justify-content-center align-items-center" style="font-size: 16px">
                        <div id="gaugeResidualRisk"></div>
                        <br>
                    </div>
                </div>
            </div>
        </div>

</div>
<div class="row" style="height: 70%">

</div>

</div>

</div>
<br>
<div class="row">
<div class="col-md-4" style="border: 1px solid darkgrey;">
<!-- user controls -->
<form id="riskForm">
{% csrf_token %}
<br>
<input type="hidden" id="scenario_id" name="scenario_id" value="${data.ID}">
<label for="risk_owner" class="form-control" style="border: none;">Risk Owner:</label>

<input type="text" class="form-control" id="risk_owner" name="risk_owner" required>
<br>
<label for="risk_priority" class="form-control" style="border: none;">Risk Priority:</label>
<select id="risk_priority" name="risk_priority" class="form-control">
<option value="Low">Low</option>
<option value="Medium">Medium</option>
<option value="High">High</option>
<option value="Critical">Critical</option>
</select>
<br>
<label for="risk_response" class="form-control" style="border: none;">Risk Response:</label>
<select id="risk_response" name="risk_response" class="form-control">
<option value="Manage">Manage</option>
<option value="Mitigate">Mitigate</option>
<option value="Transfer">Transfer</option>
<option value="Accept">Accept</option>
</select>
<br>
<label for="risk_status" class="form-control" style="border: none;">Risk Status:</label>
<select id="risk_status" name="risk_status" class="form-control">
<option value="Open">Open</option>
<option value="Closed">Closed</option>
</select>
<br>
<label for="risk_open_date" class="form-control" style="border: none;">Risk Open Date:</label>
<input type="date" class="form-control" id="risk_open_date" name="risk_open_date" required>
<br>
<label for="risk_close_date" class="form-control" style="border: none;">Risk Close Date:</label>
<input type="date" class="form-control" id="risk_close_date" name="risk_close_date" required>
<br>
<button type="button"  class="btn btn-primary"  id="saveRiskData">Save</button>
</form>
</div>
<div class="col-md-8">

<div class="row" style="height:50%">

<div class="col-md-6" id="impactChartContainer"></div>

<div class="col-md-6" id="bulletChartContainer"></div>
</div>
</div>
</div>

</div>
</div>
    </div>
</div>

</div>





<!-- end of header detail -->

<div class="row">
    <div class="col-md-1 "></div>
    <div class="col-md-10 " style="background-color: white">
        <div class="card" style="display: none;" id="scenarioDetailsCard">
          <div class="card-header">
            Scenario Details
          </div>
          <div class="card-body" id="scenarioDetails">
            <!-- Details will be populated here -->
          </div>
        </div>
    </div>
    <div class="col-md-1 " style="background-color: white"></div>
</div>
<script>


    $(document).ready(function() {
    // Initialize DataTable with options
    $('#tbl_risk_register').DataTable({
        "paging": false, // Enable pagination
        "order": [] // Disable initial sorting if needed
    });
});

function loadScenarioDetails(scenarioId) {
    $.get("{% url 'OTRisk:getSingleScenario' %}", { id: scenarioId }, function(data) {
        // Populate placeholders with data
        $('#detail_ID').text(data.ID);
        $('#detail_CyberPHA').text(data.CyberPHA);
        $('#scenario_description').text(data.Scenario);
        $('#consequence_description').text(data.Consequence);

        $('#scenario_probability').text(data.probability);
        $('#scenario_sis_outage').text(data.sis_outage);
        $('#scenario_sis_compromise').text(data.sis_compromise);
        $('#scenario_ThreatClass').text(data.ThreatClass);
        $('#scenario_standards').text(data.standards);

        $("#scenarioDetailsCard").show(); // Show the card

        clearContainer('bulletChartContainer');
        clearContainer('impactChartContainer');
        clearContainer('gaugeProbContainer');
        clearContainer('gaugeEffectivenessContainer');
        clearContainer('gaugeLikelihoodContainer');
        clearContainer('gaugeResidualRisk');

        createProbGauge(data.probability);
        createEffectivenessGauge(data.control_effectiveness);
        createLikelihoodGauge(data.likelihood);
        createResidualRiskGauge(data.RRa);

                var rangeData = [
            {x: "Best Case", low: 0, high: data.sle_low},
            {x: "Median Case", low: 0, high: data.sle},
            {x: "Worst Case", low: 0, high: data.sle_high}
        ];

        $("#scenarioDetailsCard").show(); // Show the card

        var riskPriorityValue = data.risk_priority;
        var riskOwner = data.risk_owner;
        var riskResponse = data.risk_response;
        var riskStatus = data.risk_status;
        var riskOpenDate = data.risk_open_date;
        var riskCloseDate = data.risk_close_date;

        // Set the dropdown to the correct value
        $("#risk_priority").val(riskPriorityValue);
        $("#risk_owner").val(riskOwner);
        $("#risk_response").val(riskResponse);
        $("#risk_status").val(riskStatus);
        $("#risk_open_date").val(riskOpenDate);
        $("#risk_close_date").val(riskCloseDate);

        anychart.theme('darkBlue');

        var rangechart = anychart.area();
        var credits = rangechart.credits();
            credits.enabled(false);
        var series = rangechart.rangeStepArea(rangeData);
        var yAxis = rangechart.yAxis();

        yAxis.labels().format('${%Value}');
        rangechart.container("bulletChartContainer");
        rangechart.draw();

        var chartData = [
            {x: "Safety", value: data.impactSafety},
            {x: "Danger", value: data.impactDanger},
            {x: "Production", value: data.impactProduction},
            {x: "Finance", value: data.impactFinance},
            {x: "Reputation", value: data.impactReputation},
            {x: "Environment", value: data.impactEnvironment},
            {x: "Regulation", value: data.impactRegulation},
            {x: "Data", value: data.impactData},
            {x: "Supply", value: data.impactSupply}
        ];

        var chart = anychart.column();
        chart.data(chartData);
        chart.title("Impact Analysis");
        var credits = chart.credits();
            credits.enabled(false);
        var yAxisScale = anychart.scales.linear();
        yAxisScale.minimum(0);
        yAxisScale.maximum(10);
        var yAxis_ = chart.yAxis();
        yAxis_.scale(yAxisScale);
        var xAxis = chart.xAxis();
        xAxis.labels().rotation(45);
        chart.container("impactChartContainer");
        chart.draw();
    });
}

function clearContainer(containerId) {
    var container = document.getElementById(containerId);

    // Check if the container is null before proceeding
    if (container === null) {
        return;
    }

    while (container.firstChild) {
        container.removeChild(container.firstChild);
    }
}

function createProbGauge(score) {

    // Remove the '%' character from the score string
    var scoreStripped = score.replace('%', '');

    // Convert the stripped string to an integer
    var scoreInt = parseInt(scoreStripped, 10);

    // Now you can use scoreInt in your function
    var dataSet = anychart.data.set([scoreInt]);

    // Create a circular gauge chart
    var gauge = anychart.gauges.circular();
    var credits = gauge.credits();
    credits.enabled(false);
    // Set gauge settings
    gauge.data(dataSet).padding('4%');
    gauge.startAngle(270);
    gauge.sweepAngle(180);

    // Set axis scale settings
    var scale = gauge.axis().scale();
    scale.minimum(0)
        .maximum(100)
        .ticks()
        .interval(10);

    var needle=gauge.needle();
    needle.enabled(true);
    needle.startRadius("10%");
    needle.endRadius("80%");

    // Set the look of the bar that presents data
    gauge.bar(0)
        .position('i')
        .fill('#F0673B .9')
        .stroke('#F0673B')
        .radius(65);

       gauge.range({
      from: 0,
      to: 100,
      fill: {keys: ["green", "yellow", "orange" , "red"]},
      position: "inside",
      radius: 100,
      endSize: "15%",
      startSize:"15%",
      zIndex: 10
  });
    // Draw the chart
    gauge.container('gaugeProbContainer').draw();
}

function createEffectivenessGauge(score) {

    //clearContainer('gaugeContainer');
    // Create data set with our score
    var dataSet = anychart.data.set([score]);

    // Create a circular gauge chart
    var gauge = anychart.gauges.circular();
    var credits = gauge.credits();
    credits.enabled(false);
    // Set gauge settings
    gauge.data(dataSet).padding('4%');
    gauge.startAngle(270);
    gauge.sweepAngle(180);

    // Set axis scale settings
    var scale = gauge.axis().scale();
    scale.minimum(0)
        .maximum(100)
        .ticks()
        .interval(10);

    var needle=gauge.needle();
    needle.enabled(true);
    needle.startRadius("10%");
    needle.endRadius("80%");

    // Set the look of the bar that presents data
    gauge.bar(0)
        .position('i')
        .fill('#F0673B .9')
        .stroke('#F0673B')
        .radius(65);

       gauge.range({
      from: 0,
      to: 100,
      fill: {keys: ["red", "orange", "yellow", "green"]},
      position: "inside",
      radius: 100,
      endSize: "15%",
      startSize:"15%",
      zIndex: 10
  });
    // Draw the chart
    gauge.container('gaugeEffectivenessContainer').draw();
}

function createLikelihoodGauge(score) {

    //clearContainer('gaugeContainer');
    // Create data set with our score
    var dataSet = anychart.data.set([score]);

    // Create a circular gauge chart
    var gauge = anychart.gauges.circular();
    var credits = gauge.credits();
    credits.enabled(false);
    // Set gauge settings
    gauge.data(dataSet).padding('4%');
    gauge.startAngle(270);
    gauge.sweepAngle(180);

    // Set axis scale settings
    var scale = gauge.axis().scale();
    scale.minimum(0)
        .maximum(100)
        .ticks()
        .interval(10);

    var needle=gauge.needle();
    needle.enabled(true);
    needle.startRadius("10%");
    needle.endRadius("80%");

    // Set the look of the bar that presents data
    gauge.bar(0)
        .position('i')
        .fill('#F0673B .9')
        .stroke('#F0673B')
        .radius(65);

       gauge.range({
      from: 0,
      to: 100,
      fill: {keys: ["green", "yellow", "orange" , "red"]},
      position: "inside",
      radius: 100,
      endSize: "15%",
      startSize:"15%",
      zIndex: 10
  });
    // Draw the chart
    gauge.container('gaugeLikelihoodContainer').draw();
}

function createResidualRiskGauge(rating) {
    // Translate the rating to a numerical value
    var score;
    switch (rating) {
        case "Low":
            score = 10;
            break;
        case "Low/Medium":
            score = 33;
            break;
        case "Medium":
            score = 50;
            break;
        case "Medium/High":
            score = 66;
            break;
        case "High":
            score = 90;
            break;
        default:
            console.error("Invalid rating value");
            return;
    }



    var data = [score];
    // set the gauge type
   var gauge = anychart.gauges.linear();
   gauge.layout('horizontal'); // Set the layout to horizontal
        var credits = gauge.credits();
    credits.enabled(false);
   // set the data for the gauge
   gauge.data(data);

   var scaleBarColorScale = anychart.scales.ordinalColor().ranges(
  [
    {
      from: 0,
      to: 25,

        color: ['#CAD70b', '#2AD62A']
    },
    {
      from: 25,
      to: 50,

        color: ['#FFD700', '#CAD70b']
    },
    {
      from: 50,
      to: 75,
      color: ['#EB7A02', '#FFD700']
    },
    {
      from: 75,
      to: 100,
       color: ['#D81E05', '#EB7A02']
    }
  ]
);
var scaleBar = gauge.scaleBar(0);

   // set the height and offset of the Scale Bar (both as percentages of the gauge height)
   scaleBar.width('15%');
   scaleBar.offset('31.5%');

   // use the color scale (defined earlier) as the color scale of the Scale Bar
   scaleBar.colorScale(scaleBarColorScale);

   // add a marker pointer
   var marker = gauge.marker(0);
    marker.width(15);
   // set the offset of the pointer as a percentage of the gauge width
   marker.offset('43%');

   // set the marker type
   marker.type('triangle-up');
   // set the color of the marker to black
   marker.color('black');
    // set the zIndex of the marker
   marker.zIndex(10);

   // configure the scale
   var scale = gauge.scale();
   scale.minimum(0);
   scale.maximum(100);
   scale.ticks().interval(10);

    var axis = gauge.axis();
    axis.minorTicks(true)
    axis.minorTicks().stroke('#cecece');
    axis.width('1%');
    axis.offset('29.5%');
    axis.orientation('top');

    // format axis labels
    axis.labels().format(function() {
        if (this.value == 0) return "Low";
        else if (this.value == 50) return "Medium";
        else if (this.value == 100) return "High";
        else return "";  // This will hide other labels
    });
    gauge.width('100%');


    gauge.layout();
   // set paddings
   gauge.padding([0, 50]);


    // Draw the chart
    gauge.container('gaugeResidualRisk').draw();
}
</script>

</div>
            </div>
 </main>
    </div>
</div>
</body>
</html>