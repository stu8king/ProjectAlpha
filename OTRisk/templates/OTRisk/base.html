{% load static %}

<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}{% endblock %}</title>

    <link href="{% static 'css/menus.css' %}" rel="stylesheet">

      <style>
        /* Apple.com style */
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        .top-menu {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .top-menu ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .top-menu li {
            display: inline-block;
            margin-right: 10px;
        }

        .top-menu li a {
            text-decoration: none;
            color: #333;
        }

        .sidebar {
            width: 200px;
            background-color: #fff;
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
            padding: 10px;
            margin-right: 20px;
        }

        .sidebar ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .sidebar li {
            margin-bottom: 10px;
        }

        .sidebar li a {
            text-decoration: none;
            color: #333;
        }

        .content {
            flex: 1;
        }

        .chart-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
        }

        .chart-container canvas {
            max-width: 400px;
        }

        .table-container {
            width: 100%;
            overflow-x: auto;
        }

        .custom-table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
        }

        .custom-table th,
        .custom-table td {
            padding: 10px;
            text-align: left;
        }

        .custom-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .custom-table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .custom-table tbody tr:hover {
            background-color: #eaeaea;
        }

        .clickable-row {
            cursor: pointer;
        }

        .hidden-column {
            display: none;
        }

        .logo {
            height: 50px;
            width: 50px;
            /* Add more styles as needed */
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <style>
        canvas {
            max-width: 600px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div class="top-menu">


        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Assessments</a></li>
            <li><a href="{% url 'OTRisk:workshop_without_id' %}">Workshop</a></li>
            <li><a href="{% url 'OTRisk:raworksheets' %}">Walkthroughs</a></li>
            <li><a href="#">Reports</a></li>
        </ul>
    </div>
    <div class="container">
        <div class="sidebar">
            <ul>
                <li><a href="{% url 'OTRisk:post_create' %}">Add New</a></li>
                <li><a href="{% url 'OTRisk:add_team_members' %}">Add Team</a></li>
                <li><a href="{% url 'OTRisk:workshop_setup' %}">Workshop Setup</a></li>
                <li><a href="#">Add Scenarios</a></li>
                <li><a href="#">Add Assets</a></li>
                <li><a href="#">Add Workshop</a></li>
                <li><a href="{% url 'OTRisk:add_walkthrough' %}">Add Walkthrough</a></li>
            </ul>
        </div>

        <div class="content">
        <table>
         <tr>
            <td>

            <div class="chart-container">
              <canvas id="pie-chart"></canvas>
                <script>
                var submitStatusData = {{ submit_status_data|safe }};
                var counts = submitStatusData.counts;

                new Chart(document.getElementById("pie-chart"), {
                    type: 'pie',
                    data: {
                        labels: ["Started", "In Progress", "Under Review", "Action Items", "Completed"],
                        datasets: [{
                            backgroundColor: ["#51EAEA", "#FCDDB0", "#FF9D76", "#FB3569", "#82CD47"],
                            data: {{ submit_status_data.counts|safe }}
                        }]
                    },
                    plugins : {
                        dataLabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold'
                            },
                            formatter: function(value, context) {
                                return value; // Display the count value inside the pie slices
                            }
                        }
                    }
                });
            </script>
        </td>
         <td>
        <canvas id="bar-chart"></canvas>
        <script>
            // Get the unique business units and their counts from the context data
            var businessUnitData = {{ business_unit_data|safe }};
            var businessUnitCounts = {{ business_unit_counts|safe }};

            // Bar chart
            new Chart(document.getElementById("bar-chart"), {
                type: 'bar',
                data: {
                    labels: businessUnitData,
                    datasets: [
                        {
                            label: "Business Unit Count",
                            backgroundColor: ["#51EAEA", "#FCDDB0", "#FF9D76", "#FB3569", "#82CD47"],
                            data: businessUnitCounts
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'Business Unit Count',
                        fontColor: '#ffffff',
                        fontSize: 20,
                        fontFamily: 'Arial, sans-serif',
                        fontStyle: 'bold'
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                fontColor: '#ffffff'
                            }
                        },
                        y: {
                            grid: {
                                color: '#ffffff',
                                lineWidth: 0.5
                            },
                            ticks: {
                                fontColor: '#ffffff',
                                beginAtZero: true
                            }
                        }
                    }
                }

            });
        </script>
         </td>
         <td>
 </td>
         </tr>
        </table>

        <div class="table-container">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Business Unit</th>
                        <th>Status</th>
                        <th>Date Started</th>
                        <th>Owner</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th>
                            <div>
                                <select id="filter-business-unit" onchange="applyFilter()">
                                    <option value="">All</option>
                                    {% for unit in unique_business_units %}
                                        <option value="{{ unit }}">{{ unit }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </th>
                        <th>
                            <div>
                                <select id="filter-submit-status" onchange="applyFilter()">
                                    <option value="">All</option>
                                    {% for status in unique_submit_statuses %}
                                        <option value="{{ status }}">{{ status }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for post in posts %}
                        <tr onclick="window.location='{% url 'OTRisk:post_detail' pk=post.pk %}';">
                            <td class="hidden-column">{{ post.id }}</td>
                            <td>{{ post.process_description }}</td>
                            <td>{{ post.business_unit }}</td>
                            <td>{{ post.submit_status }}</td>
                            <td>{{ post.startdate|date:"m/d/Y" }}</td>
                            <td>{{ post.riskauthor_id }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            applyFilter(); // Apply the initial filter based on the selected value
        });

        $(document).ready(function() {
            $(".clickable-row").click(function() {
                window.location.href = $(this).data("href");
            });
        });

        function applyFilter() {
            var businessUnitFilterValue = document.getElementById("filter-business-unit").value;
            var submitStatusFilterValue = document.getElementById("filter-submit-status").value;
            var rows = document.getElementsByTagName("tbody")[0].getElementsByTagName("tr");

            for (var i = 0; i < rows.length; i++) {
                var businessUnitCell = rows[i].getElementsByTagName("td")[2];
                var submitStatusCell = rows[i].getElementsByTagName("td")[3];

                var businessUnitValue = businessUnitCell.innerText.trim();
                var submitStatusValue = submitStatusCell.innerText.trim();

                var businessUnitMatch = businessUnitFilterValue === "" || businessUnitValue === businessUnitFilterValue;
                var submitStatusMatch = submitStatusFilterValue === "" || submitStatusValue === submitStatusFilterValue;

                if (businessUnitMatch && submitStatusMatch) {
                    rows[i].style.display = "";
                } else {
                    rows[i].style.display = "none";
                }
            }
        }

    </script>
    </div>
</body>
</html>

