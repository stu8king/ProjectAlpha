{% load static %}
<!DOCTYPE html>
<html lang="">
<head>
    <title>AnzenOT - GRC for OT</title>
    <link rel="icon" href="{% static 'images/AnzenOTIconBlack.png' %}" type="image/x-icon">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">

    <!-- Bootstrap Select CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="{% static 'bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'anychart/dist/js/anychart-bundle.min.js'%}"></script>
    <script src="{% static 'anychart/dist/js/anychart-heatmap.min.js' %}"></script>
    <script src="{% static 'anychart/dist/js/anychart-sunburst.min.js' %}"></script>
    <script src="{% static 'anychart/dist/js/anychart-pie.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>


     {% load django_bootstrap5 %}
     {% bootstrap_css %}
     {% bootstrap_javascript %}
<link rel="stylesheet" type="text/css" href="{% static 'css/otriskstyle.css' %}">
<style>


    /* Base Styles for Modern Look */
    :root {
        --font-primary: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        --color-primary: #e3e3e3;
        --color-secondary: #495057;
        --color-background: #14547a;
        --color-link-hover: #000000;
        --color-text: #343a40;
        --color-text-light: #6c757d;
        --border-radius: 8px;
    }

    body, html {
        font-family: var(--font-primary);
    }

    /* News Feed Styles for a Modern, High-Tech Look */
    .news-header {
        color: var(--color-primary);
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 24px;
    }

    .news-container {
        background-color: var(--color-background);
        border-radius: var(--border-radius);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        padding: 20px;
        max-height: 600px;
        overflow-y: auto;
    }

    .news-list {
        list-style: none;
        padding: 0;
    }

    .news-item {
        border-bottom: 1px solid #e1e4e8;
        padding-bottom: 15px;
        margin-bottom: 15px;
    }

    .news-item:last-child {
        border-bottom: none;
    }

    .news-link {
        color: var(--color-primary);
        font-weight: 500;
        font-size: 18px;
        text-decoration: none;
        transition: color 0.2s ease-in-out;
    }

    .news-link:hover {
        color: var(--color-link-hover);
        text-decoration: none; /* Consider keeping underlines off for a cleaner look */
    }

    .news-date {
        font-size: 14px;
        color: var(--color-text-light);
        margin-top: 5px;
    }

    .news-summary {
        font-size: 15px;
        color: var(--color-text);
        margin-top: 10px;
        line-height: 1.6;
    }
    .news-logo {
    max-width: 100%; /* Ensures the image does not exceed the container's width */
    height: auto; /* Keeps the image's aspect ratio intact */
    display: block; /* Removes any default inline spacing */
    margin: 0 auto 20px; /* Centers the image and adds some space below */
}
</style>

</head>
<body style="background-color: #464748">
<script>
   sessionStorage.clear();
    localStorage.clear();

</script>
<div class="container-fluid">

    <div class="row">
        {% include 'menu_bar.html' %}
        <!-- Main content area, including sub-menu and tabs -->
        <div class="col-md-9 col-lg-10">
            <!-- Top Strip -->
            <div class="top-strip">
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-7">
                    <h1 class="page-title">Dashboard@AnzenOT (Beta)</h1>
                    </div>

                    <div class="col-md-3"></div>
                </div>
            </div>
        <div class="sub-menu">
            <br><br><br><br><br><br><br><br><br><br>
        <ul>
            <li><a href="#" data-tab="tab1">Heatmap</a></li>
            <li><a href="#" data-tab="tab2">KPIs / Compliance</a></li>
            <li><a href="#" data-tab="tab3">CyberPHA</a></li>
            <li><a href="#" data-tab="tab4" id="scenarioTabLink">Risk Groups</a></li>

            <li><a href="#" data-tab="tab5">QRAW</a></li>
            <li><a href="#" data-tab="tab6">Moderator Queue</a></li>
            <li><a href="#" data-tab="tab7">News Feeds</a></li>
            <li><a href="#" data-tab="tab8"></a></li>
            <li><a href="#" data-tab="tab9"></a></li>
            <li><a href="#" data-tab="tab10"></a></li>
        </ul>
    </div>


    <div class="custom-main-content" >

    <div class="tab-content tab-link active"  id="tab1">
        <div class="form-group form-sim" >
            <div id="heatmapContainer" style="width:100%; height:400px;"></div>
        </div>
        <script>
         anychart.licenseKey("iotarisk.com-f1ad231c-886c1b88");
         anychart.onDocumentReady(function () {

             // create data
             var heatmapStructure = [
                 {x: "Low", y: "Very High", fill: "#ff4b33", value: 0},
                 {x: "Low/Medium", y: "Very High", fill: "#ff4b33", value: 0},
                 {x: "Medium", y: "Very High", fill: "#ff4b33", value: 0},
                 {x: "Medium/High", y: "Very High", fill: "#ff4b33", value: 0},
                 {x: "High", y: "Very High", fill: "#ff4b33", value: 0},
                 {x: "Very High", y: "Very High", fill: "#ff4b33", value: 0},

                 {x: "Low", y: "High", fill: "#ff9933", value: 0},
                 {x: "Low/Medium", y: "High", fill: "#ff9933", value: 0},
                 {x: "Medium", y: "High", fill: "#ff9933", value: 0},
                 {x: "Medium/High", y: "High", fill: "#ff4b33", value: 0},
                  {x: "High", y: "High", fill: "#ff4b33", value: 0},
                 {x: "Very High", y: "High", fill: "#ff4b33", value: 0},

                 {x: "Low", y: "Medium/High", fill: "#ffcc00", value: 0},
                 {x: "Low/Medium", y: "Medium/High", fill: "#ff9933", value: 0},
                 {x: "Medium", y: "Medium/High", fill: "#ff9933", value: 0},
                 {x: "Medium/High", y: "Medium/High", fill: "#ff9933", value: 0},
                 {x: "High", y: "Medium/High", fill: "#ff4b33", value: 0},
                  {x: "Very High", y: "Medium/High", fill: "#ff4b33", value: 0},

                 {x: "Low", y: "Medium", fill: "#ffcc00", value: 0},
                 {x: "Low/Medium", y: "Medium", fill: "#ffcc00", value: 0},
                 {x: "Medium", y: "Medium", fill: "#ffcc00", value: 0},
                 {x: "Medium/High", y: "Medium", fill: "#ff9933", value: 0},
                 {x: "High", y: "Medium", fill: "#ff9933", value: 0},
                 {x: "Very High", y: "Medium", fill: "#ff4b33", value: 0},

                  {x: "Low", y: "Low/Medium", fill: "#5eff00", value: 0},
                 {x: "Low/Medium", y: "Low/Medium", fill: "#ffcc00", value: 0},
                 {x: "Medium", y: "Low/Medium", fill: "#ffcc00", value: 0},
                 {x: "Medium/High", y: "Low/Medium", fill: "#ffcc00", value: 0},
                 {x: "High", y: "Low/Medium", fill: "#ffcc00", value: 0},
                 {x: "Very High", y: "Low/Medium", fill: "#ff4b33", value: 0},

                  {x: "Low", y: "Low", fill: "#5eff00", value: 0},
                 {x: "Low/Medium", y: "Low", fill: "#5eff00", value: 0},
                 {x: "Medium", y: "Low", fill: "#ffcc00", value: 0},
                 {x: "Medium/High", y: "Low", fill: "#ffcc00", value: 0},
                 {x: "High", y: "Low", fill: "#ffcc00", value: 0},
                 {x: "Very High", y: "Low", fill: "#ff4b33", value: 0},


             ];

             function updateHeatmapStructure(heatmap_data) {
                heatmapStructure.forEach(function(cell) {
                    if (heatmap_data[cell.y] && heatmap_data[cell.y][cell.x]) {
                        cell.value = heatmap_data[cell.y][cell.x];
                    }
                });
            }

            var heatmapDataFromServer = {{ heatmap_data|safe }};
            updateHeatmapStructure(heatmapDataFromServer);

            // Create a chart and set the data
            var chart = anychart.heatMap(heatmapStructure);
            chart.background().fill("#464748");
            var credits = chart.credits();
            credits.enabled(false);
             // Disable tooltips
             chart.tooltip(false);

             // Set the chart title
             chart.title("Scenario Residual Risk vs Likelihood Heatmap")
             .title().fontColor("white");

            chart.labels().fontSize(14);
             // Set the x-axis title
             chart.xAxis().title("Likelihood")
                 .title().fontColor("white");
             chart.xAxis().labels().fontColor("white");
             chart.xAxis().orientation("bottom");
             // Set the y-axis title
             chart.yAxis().title("Residual Risk")
                .title().fontColor("white");
             chart.yAxis().labels().fontColor("white");
             chart.yAxis().labels(["Very High", "High", "Medium/High", "Medium", "Low/Medium", "Low"]);
            chart.labels().fontColor("white");
             // Set the container id
             chart.container("heatmapContainer");

             // Initiate drawing the chart
             chart.draw();
             chart.listen("pointClick", function(e){
                var x = e.point.get("x");
                var y = e.point.get("y");
                var value = e.point.get("value");
                if(value > 0) { // Check if the cell value is greater than 0
                    // Make AJAX call to fetch related tblCyberPHAHeader records
                    fetchRelatedRecords(x, y);
                }
            });
             chart.listen("pointMouseOver", function(e) {
                    var value = e.point.get('value');
                    if (value > 0) {
                        // If value > 0, we want to change the cursor to 'pointer'
                        heatmapContainer.style.cursor = 'pointer';
                    }
                });

            chart.listen("pointMouseOut", function(e) {
                // Reset the cursor when the mouse leaves a point
                heatmapContainer.style.cursor = 'default';
            });

         });
        function fetchRelatedRecords(x, y) {
            $.ajax({
                url: '/OTRisk/get_heatmap_records', // Update this to the path of your Django view
                type: 'GET',
                data: {
                    'x': x,
                    'y': y
                },
                success: function(response) {
                    // Handle the response. For example, display the data in a modal or a new div
                    console.log(response); // For debugging
                    // You can call a function here to display the data
                    displayData(response);
                },
                error: function(error) {
                    console.log(error); // For debugging
                }
            });
        }

        function displayData(response) {
    // Assuming the actual data array is nested under the 'data' property of the response object
    var data = response.data; // Adjust this line to correctly reference the array

    // Find the container where the table will be displayed
    var container = document.getElementById('heatmapTableContainer');

    // Clear previous contents
    container.innerHTML = '';

    // Create a table element with the specified classes
    var table = document.createElement('table');
    table.className = 'table small-font compact'; // Adjusted class names to match the provided styles
    table.id = 'headertable';

    // Create the header row
    var thead = document.createElement('thead');
    var headerRow = document.createElement('tr');

    // Define the headers
    var headers = ['ID', 'Title', 'Facility', 'Scenario', 'Residual Risk'];
    headers.forEach(headerText => {
        var header = document.createElement('th');
        header.textContent = headerText;
        header.className = 'th'; // Apply class to header as per provided styles
        headerRow.appendChild(header);
    });

    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Create the body of the table
    var tbody = document.createElement('tbody');
    tbody.style.fontSize = "10px"; // Apply font size as per provided styles

    // Add rows for each record
   data.forEach(item => {
    var row = document.createElement('tr');
    row.className = "selectable-row"; // Apply class to row as per provided styles

    // Create a cell for each piece of data
    var cellHeaderID = document.createElement('td');
    cellHeaderID.textContent = item.tblCyberPHAHeader_ID;
    row.appendChild(cellHeaderID);

    var cellTitle = document.createElement('td');
    cellTitle.textContent = item.title;
    row.appendChild(cellTitle);

    var cellFacilityName = document.createElement('td');
    cellFacilityName.textContent = item.FacilityName;
    row.appendChild(cellFacilityName);

    var cellScenario = document.createElement('td');
    cellScenario.textContent = item.scenario;
    row.appendChild(cellScenario);

    var cellRRA = document.createElement('td');
    cellRRA.textContent = item.RRA;
    row.appendChild(cellRRA);

    // Make the row clickable
    row.addEventListener('click', function() {
        // Construct the URL with the item's tblCyberPHAHeader_ID
        var url = `/OTRisk/pha_reports/${item.tblCyberPHAHeader_ID}/`; // Adjust the URL pattern as needed
        window.location.href = url; // Redirect the user to the URL
    });

    // Append the row to the tbody
    tbody.appendChild(row);
});


    // Append the tbody to the table
    table.appendChild(tbody);

    // Append the table to the container
    container.appendChild(table);

    // Show the tab containing the heatmap table
    $('.tab-content').removeClass('active').hide();
    $('#tab9').addClass('active').show();
}



        </script>
        <div class="form-group">
            <div class="row" style="height:250px">
                <div class="col-md-4">
                   <div id="raw_bia_container" style="width:100%; height:100%;" class="doughnut_container"></div>
                </div>
                <div class="col-md-4">
                    <div id="residual_risk_container" style="width:100%; height:100%;" class="doughnut_container"></div>
                </div>
                <div class="col-md-4">
                    <div id="pha_bia_container" style="width:100%; height:100%;" class="doughnut_container"></div>
                </div>
            </div>
        </div>

    </div>

    <div class="tab-content tab-link " id="tab2">
        <h2>KPIs / Compliance</h2>
        <div class="form-group">
            <div class="row" >
                <div class="col-md-3 ">
                    <div class="group-container">
                        <div class="group-header" >
                            Open Risk Exposure (CyberPHA)
                        </div>
                            <div class="group-body">
                                <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube">  {{ formatted_sle }}
                            </div>
                        </div>

                </div>
                <div class="col-md-3 ">

                    <div class="group-container">
                        <div class="group-header">
                             Open Risk Exposure (QRAW)
                        </div>
                            <div class="group-body">
                                <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"> {{ formatted_scenario_cost }}
                            </div>
                        </div>


                </div>
                <div class="col-md-3 ">

                    <div class="group-container">
                        <div class="group-header">
                             Open Action Items
                        </div>
                            <div class="group-body">
                                <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"> {{ ra_actions_records_count }}
                        </div>
                    </div>


                </div>
                <div class="col-md-3 ">

                     <div class="group-container">
                        <div class="group-header">
                             Open Risk Assessments
                        </div>
                            <div class="group-body">
                                <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"> {{ open_raws_count }}
                        </div>
                    </div>

                </div>
            </div>
            <div class="row" >
                <div class="col-md-3 ">

                    <div class="group-container">
                        <div class="group-header">
                             Total Risk Assessments
                        </div>
                            <div class="group-body">
                                <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"> {{ raw_count }}
                        </div>
                    </div>

                </div>
                <div class="col-md-3 ">

                    <div class="group-container">
                        <div class="group-header">
                             Risk Scenarios
                        </div>
                            <div class="group-body">
                                <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"> {{ scenarios_count }}
                        </div>
                    </div>


                </div>
                <div class="col-md-3 ">

                    <div class="group-container">
                        <div class="group-header">
                             Total CyberPHAs
                        </div>
                            <div class="group-body">
                                <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"> {{ cyberpha_count }}
                        </div>
                    </div>

                </div>
                <div class="col-md-3 ">

                    <div class="group-container">
                        <div class="group-header">
                             CyberPHA Scenarios
                        </div>
                            <div class="group-body">
                                <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"> {{ cyberpha_scenario_count }}
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="row" >
                <div class="col-md-3"></div>
                <div class="col-md-6">
                    <table id="complianceTable" class="display">
    <thead>
        <tr>
            <th>Compliance Regulation</th>
            <th>Relevant Scenario Count</th>
            <th>URL</th>
        </tr>
    </thead>
    <tbody style="color:#000">
        {% for item in compliance_summary %}
            <tr data-regulation="{{ item.regulation|escape }}">
                <td>{{ item.regulation }}</td>
                <td>{{ item.count }}</td>
                <td><a href="{{ item.url }}" target="_blank">Link</a></td>
            </tr>
        {% endfor %}
    </tbody>
</table>

                </div>
                <div class="col-md-3"></div>
            </div>
        </div>
    </div>

    <!-- Tab 2 Content -->
    <div class="tab-content tab-link" id="tab3">
        <h2>CyberPHA</h2>
        <div class="form-group form-sim" >
            <div class="card shadow flex-fill">
                <div class="card-body">
                    <label for="headertable" class="form-label">CyberPHA Assessments</label>
                    <table id="headertable" class="table small-font" style="border-collapse: separate; border-spacing: 0 15px;">
                    <thead>
                        <tr>
                        <th class="th">ID</th>
                        <th>Site</th>
                        <th>Unit</th>
                        <th>Zone</th>
                        <th>PHA Score</th>
                        </tr>
                    </thead>
                    <tbody style="font-size: 10px;">
                        {% for pha in phas %}
                        <tr class="selectable-row" data-id="{{ pha.ID }}" style="background-color: #f0f0f0; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); border-radius: 5px;">
                        <td >{{ pha.ID }}</td>
                        <td ><a href="/OTRisk/iotaphamanager/{{ pha.ID }}/" >{{ pha.FacilityName }}</a></td>
                        <td>{{ pha.AssessmentUnit }}</td>
                        <td>{{ pha.AssessmentZone }}</td>
                         <td>
                            {% if pha.pha_score <= 16 %}
                                <div style="background-color: green; border-radius: 20px; text-align: center; color: black">Low</div>
                            {% elif pha.pha_score <= 33 %}
                                <div style="background-color: lightgreen; border-radius: 20px; text-align: center; color: black">Low/Medium</div>
                            {% elif pha.pha_score <= 50 %}
                                <div style="background-color: yellow; border-radius: 20px; text-align: center; color: black">Medium</div>
                            {% elif pha.pha_score <= 66 %}
                                <div style="background-color: orange; border-radius: 20px; text-align: center; color: black">Medium/High</div>
                            {% elif pha.pha_score <= 83 %}
                                <div style="background-color: red; border-radius: 20px; text-align: center; color: black">High</div>
                            {% else %}
                                <div style="background-color: darkred; border-radius: 20px; text-align: center; color: black">Very High</div>
                            {% endif %}
                        </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <script type="text/javascript">
                $(document).ready(function () {
                    if ($.fn.dataTable.isDataTable('#phaTable')) {
                        $('#phaTable').DataTable().destroy();
                    }
                    $('#phaTable').DataTable({
                        "paging": true,
                        "lengthChange": false,
                        "searching": false,
                        "pageLength": 10
                        // No need for drawCallback here
                    });
                });
</script>


                </div>
            </div>
        </div>
    </div>

    <!-- Tab 3 Content -->
    <div class="tab-content tab-link" id="tab4">
        <h2>Risk Groups</h2>
        <div class="form-group">
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col text-center text-white">
            CyberPHA Group Assignments<br>
        </div>

        <div class="col-md-1"></div>
    </div>
    <br>
    <div class="row">
   {% for group in groups_with_cyberphas %}
<div class="col-md-4">
    <div class="group-container" data-group-id="{{ group.id }}" onclick="getGroupReport(this.getAttribute('data-group-id'))">
        <div class="group-header">
            {{ group.group_name }}
        </div>
        <div class="group-body">
            {% for cyberpha in group.cyberphas %}
                <div class="cyberpha-item">
                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube">
                    <span class="facility-name">{{ cyberpha.facility_name }}</span>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% empty %}
    <p>No groups found.</p>
{% endfor %}


    </div>
</div>
<script>
function getGroupReport(groupId) {
    $.ajax({
        url: '/OTRisk/get_group_report',  // Update with the actual URL
        data: { 'group_id': groupId },
        success: function(data) {
            // Create a table for the CyberPHAs with the specific styling
            var tableHtml = '<table id="headertable" class="table small-font compact"><thead><tr><th class="th">Title</th><th>Facility Name</th><th>Facility Type</th><th>Industry</th><th>Employees On Site</th></tr></thead><tbody style="font-size: 10px">';
            data.cyberphas.forEach(function(cyberpha) {
                tableHtml += '<tr class="selectable-row">' +
                             '<td>' + cyberpha.title + '</td>' +
                             '<td>' + cyberpha.FacilityName + '</td>' +
                             '<td>' + cyberpha.FacilityType + '</td>' +
                             '<td>' + cyberpha.Industry + '</td>' +
                             '<td>' + cyberpha.EmployeesOnSite + '</td>' +
                             '</tr>';
            });
            tableHtml += '</tbody></table>';

            // Ensure the table container is specifically targeted and not overwritten by averages content
            $('#cyberphasTableContainer').html(tableHtml);

            // Create content for the averages and append it separately
            var averagesContent = '<div>Average Image Safety: ' + data.avg_imageSafety +
                                  ', Average Impact Danger: ' + data.avg_impactDanger +
                                  ', Average Impact Production: ' + data.avg_impactProduction + '</div>';

            // Append the averages content next to the table container within tab8
            $('#tab8').append(averagesContent);

            // Make sure tab8 is displayed
            $('.tab-content').removeClass('active').hide();
            $('#tab8').addClass('active').show();
        }
    });
}

</script>

    </div>

    <!-- Tab 4 Content -->
    <div class="tab-content tab-link" id="tab5">
    <h2>QRAW</h2>
    <div class="table-responsive">
        <table id="headertable" class="table small-font compact" style="width: 100%; border-collapse: separate; border-spacing: 0 15px;">
            <thead>
                <tr>
                    <th class="th">Title</th>
                    <th>Status</th>
                    <th>Trigger</th>
                    <th>Scenario Count</th>
                </tr>
            </thead>
            <tbody style="font-size: 10px;">
                {% for worksheet in ra_worksheets_with_scenario_count %}
                    <tr style="background-color: #f0f0f0; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); border-radius: 5px;">
                        <td>{{ worksheet.RATitle }}</td>
                        <td>{{ worksheet.StatusFlag }}</td>
                        <td>{{ worksheet.RATrigger }}</td>
                        <td>{{ worksheet.scenario_count }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4">No records found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


    <div class="tab-content tab-link" id="tab6">
        <h2>Moderator Queue</h2>
          <div class="form-group">
            <!-- Worksheets Approval Section -->
            <div class="card shadow flex-fill">
                <div class="card-body">
                <div class="worksheets-approval-section">
                    <h4 style="color: white">Worksheets for Moderation</h4>
                    {% if worksheets_to_approve == "No moderations waiting" %}
                        <p>No approvals for action.</p>
                    {% else %}
                        <ul>
                            {% for worksheet in worksheets_to_approve %}
                                <li style="color: white">
                                    <strong>Title:</strong> {{ worksheet.RATitle }}<br>
                                    <strong>Date:</strong> {{ worksheet.RADate }}<br>
                                    <strong>Status:</strong> {{ worksheet.StatusFlag }}<br>
                                    <!-- Add link to view or approve the worksheet -->

                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
                </div>
            </div>

        </div>
    </div>

<div class="tab-content tab-link" id="tab7">
    <h2>News Feeds</h2>
    <div class="row">
        <div class="col-md-6">
        <div class="form-group">
            <div class="news-container">
                <ul class="news-list">
                    <img src="/static/images/SecurityWeek.png" class="news-logo">
                    {% for item in security_week %}
                    <li class="news-item">
                         <a href="{{ item.link }}" class="news-link" target="_blank" rel="noopener noreferrer">{{ item.title|safe }}</a>
                        <p class="news-date">Published: {{ item.published }}</p>
                        <p class="news-summary" data-summary-content>{{ item.summary|safe }}</p>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
            <div class="news-container">
                <ul class="news-list">
                <img src="https://vpnpro.com/wp-content/uploads/darkreading-logo-1024x173.png" class="news-logo">
                    {% for item in dark_reading %}
                    <li class="news-item">
                         <a href="{{ item.link }}" class="news-link" target="_blank" rel="noopener noreferrer">{{ item.title|safe }}</a>
                        <p class="news-date">Published: {{ item.published }}</p>
                        <p class="news-summary" data-summary-content>{{ item.summary|safe }}</p>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        </div>
    </div>


</div>




     <div class="tab-content tab-link"  id="tab8">
        <h2>Group Report</h2>
         <div id="cyberphasTableContainer"></div>

     </div>
    <div class="tab-content tab-link" id="tab9">
        <h2>Heatmap Report</h2>
         <div id="heatmapTableContainer"></div>

     </div>
     <div class="tab-content tab-link" id="tab10">
        <h2>Scenario Compliance Report for </h2>
         <div id="scenarioComplianceContainer"></div>

     </div>

</div>
</div>
    </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Select all tab links within the sub-menu
    const tabLinks = document.querySelectorAll('.sub-menu a[data-tab]');

    tabLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();

            // Get the ID of the tab content to show
            const targetTab = link.getAttribute('data-tab');

            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tabContent => {
                tabContent.style.display = 'none';
            });

            // Remove 'active' class from all tab links
            tabLinks.forEach(link => {
                link.classList.remove('active');
            });

            // Show the target tab content and add 'active' class to the clicked tab link
            document.getElementById(targetTab).style.display = 'block';
            link.classList.add('active');
        });
    });

    // Optionally, automatically click the first tab to show it on page load
    if(tabLinks.length > 0) {
        tabLinks[0].click();
    }
});
</script>

<script>
$(document).ready(function() {
    $('.group-container').hide().fadeIn(1000);
});


function formatCurrency(value) {
    value = parseInt(value);
    if (value >= 1000000) {
    return `$${(value / 1000000).toFixed(1)}m`;
    } else if (value >= 1000) {
    return `$${(value / 1000).toFixed(1)}k`;
    } else {
    return `$${value}`;
    }
}


document.addEventListener('DOMContentLoaded', (event) => {
    const sleCells = document.querySelectorAll('.sle-cell');
    sleCells.forEach(cell => {
        cell.textContent = formatCurrency(cell.textContent);
    });
});
</script>

<script>
anychart.onDocumentReady(function() {
    var pie_data = {{ bia_summary|safe }};
    let chart_data = [];
    for (let [key, value] of Object.entries(pie_data)) {
        chart_data.push({x: key, value: value});
    }

    if (chart_data.length === 0) {
        document.getElementById('raw_bia_container').innerHTML = 'No QRAW Assessments';
    } else {
        var chart = anychart.pie(chart_data);
        var colors = {
            'Low': 'green',
            'Low/Medium': '#ADFF2F', // Green-yellow
            'Medium': '#ffcc00',
            'Medium/High': '#FFA500', // Orange
            'High': '#c7471e',
            'Very High': '#ef4710'
        };
        var chartColors = [];
        for (let item of chart_data) {
            chartColors.push(colors[item.x]);
        }
        chart.background().fill("#464748");
        chart.palette(chartColors);
        chart.labels().format("{%Value}");
        chart.labels().fontSize(16);
        chart.title("QRAW BIA Summary");
        chart.innerRadius("40%");
        var credits = chart.credits();
        credits.enabled(false);
        chart.bounds(0, 0, "100%", "100%");
        chart.container("raw_bia_container");
        chart.draw();
    }
});

anychart.onDocumentReady(function() {
    var pie_data = {{ pha_risk_summary|safe }};
    let chart_data = [];
    for (let [key, value] of Object.entries(pie_data)) {
        chart_data.push({x: key, value: value});
    }

    var chart = anychart.pie(chart_data);
    var colors = {
        'Low': 'green',
        'Low/Medium': '#ADFF2F',  // Green-yellow
        'Medium': '#ffcc00',
        'Medium/High': '#FFA500',  // Orange
        'High': '#c7471e',
        'Very High': '#ef4710'
    };
    var chartColors = [];
    for (let item of chart_data) {
        chartColors.push(colors[item.x]);
    }
    chart.background().fill("#464748");
    chart.palette(chartColors);
    chart.labels().format("{%Value}");
     chart.labels().fontSize(16);
    chart.title("CyberPHA Residual Risks");
    chart.innerRadius("30%");
    var credits = chart.credits();
    credits.enabled(false);
    chart.container("residual_risk_container");
    chart.draw();

});

anychart.onDocumentReady(function() {
    var pie_data = {{ pha_bia_summary|safe }};
    let chart_data = [];
    for (let [key, value] of Object.entries(pie_data)) {
        chart_data.push({x: key, value: value});
    }

    var chart = anychart.pie(chart_data);
    var colors = {
        'Low': 'green',
        'Low/Medium': '#ADFF2F',  // Green-yellow
        'Medium': '#ffcc00',
        'Medium/High': '#FFA500',  // Orange
        'High': '#c7471e',
        'Very High': '#ef4710'
    };
    var chartColors = [];
    for (let item of chart_data) {
        chartColors.push(colors[item.x]);
    }
    chart.background().fill("#464748");
    chart.palette(chartColors);
    chart.labels().format("{%Value}");
     chart.labels().fontSize(16);
    chart.title("CyberPHA BIA Summary");
    chart.innerRadius("30%");
    var credits = chart.credits();
    credits.enabled(false);
    chart.container("pha_bia_container");
    chart.draw();

});


$(document).ready( function () {
    $('#myTable').DataTable({
        "pageLength": 5
    });
} );


$(document).ready(function() {
    $('#dataTable').DataTable({
        "pageLength": 5, // Set the length of the pagination
        "searching": false // Disable searching
    });
});

$(document).ready(function() {
    var table = $('#complianceTable').DataTable({
        "searching": false,
        "pageLength": 10
    });

    $('#complianceTable tbody').on('click', 'tr', function(e) {
        if (!$(e.target).is('a')) { // Exclude clicks on the URL link
            var regulation = $(this).data('regulation');
            $.ajax({
                url: '/OTRisk/get_scenarios_for_regulation/',
                data: {
                    'regulation_name': regulation
                },
                dataType: 'json',
                success: function(data) {
                    var container = document.getElementById('scenarioComplianceContainer');
                    // Clear previous contents
                    container.innerHTML = '';

                    // Update the H2 element
                    document.querySelector('#tab10 h2').textContent = 'Scenario Compliance Report for ' + regulation;

                    // Create a table element with the specified classes
                    var table = document.createElement('table');
                    table.className = 'table small-font compact'; // Adjusted class names to match the provided styles
                    table.id = 'headertable'; // Ensure this ID is unique

                    // Create the header row
                    var thead = document.createElement('thead');
                    var headerRow = document.createElement('tr');

                    // Define the headers
                    var headers = ['CyberPHA ID', 'Title', 'Scenario'];
                    headers.forEach(headerText => {
                        var header = document.createElement('th');
                        header.textContent = headerText;
                        header.className = 'th'; // Apply class to header as per provided styles
                        headerRow.appendChild(header);
                    });

                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    // Create the body of the table
                    var tbody = document.createElement('tbody');

                    // Add rows for each record
                    data.forEach(item => {
                        var row = document.createElement('tr');
                        row.className = "selectable-row"; // Apply class to row as per provided styles

                        // Create a cell for CyberPHA ID, Title, and Scenario
                        var cellCyberPHAID = document.createElement('td');
                        cellCyberPHAID.textContent = item.CyberPHA__ID;
                        row.appendChild(cellCyberPHAID);

                        var cellTitle = document.createElement('td');
                        cellTitle.textContent = item.CyberPHA__title;
                        row.appendChild(cellTitle);

                        var cellScenario = document.createElement('td');
                        cellScenario.textContent = item.Scenario;
                        row.appendChild(cellScenario);
                         row.addEventListener('click', function() {
                            // Construct the URL with the item's tblCyberPHAHeader_ID
                            var url = `/OTRisk/pha_reports/${item.CyberPHA__ID}/`; // Adjust the URL pattern as needed
                            window.location.href = url; // Redirect the user to the URL
                        });
                        tbody.appendChild(row);

                    });

                    table.appendChild(tbody);
                    container.appendChild(table);
                    $('.tab-content').removeClass('active').hide();
                    $('#tab10').addClass('active').show();
                }

            });
        }
    });
});



</script>


</body>
</html>