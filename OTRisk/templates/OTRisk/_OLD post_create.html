{% load static %}
<!DOCTYPE html>
<html>
<head>
    <link href="{% static 'css/menus.css' %}" rel="stylesheet">
    <style>
        /* Main content styles */
        .top-menu {
            background-color: paleorange; /* Change to your desired color */
            padding: 10px;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 2%;
            margin-top: 2%;
        }

        #left-column,
        #right-column,
        #bottom-column {
            padding: 20px;
            box-sizing: border-box;
        }

        #left-column {
            width: 48%; /* Adjust the width as needed */
            background-color: #eaeaea; /* Left column color: grey */
            height: auto;
        }

        #right-column {
            width: 48%; /* Adjust the width as needed */
            background-color: #d3d3d3; /* Right column color: slightly darker grey */
            overflow-y: auto; /* Add vertical scroll when content exceeds the height */
            height: 100%;
        }

        #bottom-column {
            width: 48%; /* Adjust the width as needed */
            background-color: #d3d3d3; /* Bottom column color: slightly darker grey */
            margin-top: 5px;
        }

        #left-column h1,
        #right-column h2,
        #bottom-column h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        #left-column textarea {
            width: 100%;
            resize: vertical;
        }

        #right-column input[type="text"],
        #right-column textarea,
        #right-column select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }

        #right-column button[type="submit"] {
            padding: 10px 20px;
            background-color: #000;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #team-members {
            margin-top: 2%;
        }

        .team-members-header {
            margin-bottom: 20px;
        }

        .team-members-table {
            width: 100%;
            border-collapse: collapse;
        }

        .team-members-table th,
        .team-members-table td {
            padding: 10px;
            border: 1px solid #ccc;
        }

        #third-column {
            width: 100%; /* Same width as left column */
            background-color: #d3d3d3; /* Third column color: slightly darker grey */
            margin-top: 5px;
            padding: 20px;
            box-sizing: border-box;
        }

        #third-column h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
        }

        #third-column ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #third-column li {
            margin-bottom: 10px;
        }

        #third-column li a {
            color: white;
            text-decoration: none;
        }
    </style>
    <script src="https://cdn.zinggrid.com/zinggrid.min.js" defer></script>


</head>
<body>
    <div class="top-menu">
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Assessments</a></li>
            <li><a href="#">Workshops</a></li>
            <li><a href="#">Walkthroughs</a></li>
            <li><a href="#">Reports</a></li>
        </ul>
    </div>

    <zing-grid id="example-grid" theme="default" caption="Threat Assessments" columns-control column-drag layout-controls pager search sort >
        <script type="application/json" id="data">
            [
            {% for threat in threats %}
                {
                    "ThreatAssessmentID": "<a href='{% url 'OTRisk:post_create' %}'>{{ threat.ThreatAssessmentID }}</a>",
                    "post_id": "{{ threat.post_id }}",
                    "ThreatType": "{{ threat.ThreatType }}",
                    "ThreatImpactDescription": "{{ threat.ThreatImpactDescription }}",
                    "ThreatImpactScore": "{{ threat.ThreatImpactScore }}",
                    "ThreatLikelihoodDescription": "{{ threat.ThreatLikelihoodDescription }}",
                    "ThreatLikelihoodScore": "{{ threat.ThreatLikelihoodScore }}",
                    "IndustryAttackHistory": "{{ threat.IndustryAttackHistory }}",
                    "HasAttackedYesNo": "{{ threat.HasAttackedYesNo }}",
                    "HasBusinessImpactYesNo": "{{ threat.HasBusinessImpactYesNo }}",
                    "AttackExpectedYesNo": "{{ threat.AttackExpectedYesNo }}",
                    "KnownExposureYesNo": "{{ threat.KnownExposureYesNo }}",
                    "Comments": "{{ threat.Comments }}",
                    "OverallThreatRatingHML": "{{ threat.OverallThreatRatingHML }}"
                }{% if not forloop.last %},{% endif %}
            {% endfor %}
            ]
        </script>
    </zing-grid>

    <script>
        window.addEventListener('load', () => {
            const zingGridRef = document.querySelector('#example-grid');
            const data = JSON.parse(document.querySelector('#data').innerHTML);
            zingGridRef.setData(data);
        });

    </script>



    <div class="container">
        <section id="left-column">
            <div class="content">
                {% block content %}
                <h1>Begin a new CyberPHA</h1>
                <form id="risk_form" method="POST" action="/OTRisk/post/create/">
                    {% csrf_token %}
                    <div class="form-field">
                        <label for="process_description">CyberPHA Title</label>
                        <textarea id="process_description" name="process_description" {% if saved %}disabled{% endif %}>{{ post_form.instance.process_description }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="hazardous_events">Description</label>
                        <textarea id="hazardous_events" name="hazardous_events" {% if saved %}disabled{% endif %}>{{ post_form.instance.hazardous_events }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="facility">Location Name</label>
                        <textarea id="facility" name="facility" {% if saved %}disabled{% endif %}>{{ post_form.instance.facility }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="business_unit">Plant or Facility Name</label>
                        <textarea id="business_unit" name="business_unit" {% if saved %}disabled{% endif %}>{{ post_form.instance.business_unit }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="project_name">Project Name</label>
                        <textarea id="project_name" name="project_name" {% if saved %}disabled{% endif %}>{{ post_form.instance.project_name }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="scope">Assessment Scope</label>
                        <textarea id="scope" name="scope" {% if saved %}disabled{% endif %}>{{ post_form.instance.scope }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="objective">Assessment Objectives</label>
                        <textarea id="objective" name="objective" {% if saved %}disabled{% endif %}>{{ post_form.instance.objective }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="assumptions">Assumptions</label>
                        <textarea id="assumptions" name="assumptions" {% if saved %}disabled{% endif %}>{{ post_form.instance.assumptions }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="SystemName">System Name</label>
                        <textarea id="SystemName" name="SystemName" {% if saved %}disabled{% endif %}>{{ post_form.instance.SystemName }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="SystemDescription">System Description</label>
                        <textarea id="SystemDescription" name="SystemDescription" {% if saved %}disabled{% endif %}>{{ post_form.instance.SystemDescription }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="SystemOwner">System Owner</label>
                        <textarea id="SystemOwner" name="SystemOwner" {% if saved %}disabled{% endif %}>{{ post_form.instance.SystemOwner }}</textarea>
                    </div>
                    <div class="form-field">
                        <label for="SystemScope">System Scope</label>
                        <textarea id="SystemScope" name="SystemScope" {% if saved %}disabled{% endif %}>{{ post_form.instance.SystemScope }}</textarea>
                    </div>
                    <div>
                        <label for="trigger_event">Trigger Events</label>
                        <select id="trigger_event" name="trigger_event" {% if saved %}disabled{% endif %}>{{ post_form.instance.trigger_event }}
                            <option value="Audit">Audit</option>
                            <option value="Incident">Incident</option>
                            <option value="Change Request">Change Request</option>
                            <option value="Internal Request">Internal Request</option>
                        </select>
                    </div>
                    <input type="hidden" name="riskauthor" value="1">
                    <input type="hidden" name="causes" value="A">
                    <input type="hidden" name="consequences" value="A">
                    <input type="hidden" name="layers_of_protection" value="A">
                    <input type="hidden" name="risk_ranking" value="L">
                    <input type="hidden" name="risk_reduction_measures" value="A">
                    <input type="hidden" name="risk_residual_level" value="A">
                    <input type="hidden" name="acceptability_criteria" value="A">
                    <input type="hidden" name="threats" value="A">
                    <input type="hidden" name="vulnerabilities" value="A">
                    <input type="hidden" name="impact_analysis" value="L">
                    <input type="hidden" name="likelihood_assessment" value="A">
                    <input type="hidden" name="risk_evaluation" value="A">
                    <input type="hidden" name="risk_mitigation" value="A">
                    <input type="hidden" name="submit_status" value="S">
                    <input type="hidden" id="editflag" name="editflag" value="0">
                    <div class="form-field">
                        {% if saved %}
                            <button type="button" onclick="enableForm()">Edit</button>
                            <button type="submit" disabled>Save</button>
                        {% else %}
                            <button type="submit">Save</button>
                        {% endif %}
                        <button type="button" onclick="createNewCyberPHA()">Create New CyberPHA</button>
                        <li><a href="{% url 'OTRisk:save_threat' %}">Add Walkthrough</a></li>
                    </div>
                </form>
            {% endblock %}
            </div>
        </section>
        <section id="right-column">
            <div class="team-members">
                <div class="team-members-header">
                    <h2>Assessment Team Members</h2>
                    <form method="POST" action="{% url 'OTRisk:add_team_members' %}">
                        {% csrf_token %}
                        <div class="form-field">
                            <label for="id_first_name">First Name</label>
                            <input type="text" id="FirstName" name="FirstName" required>
                        </div>
                        <div class="form-field">
                            <label for="id_last_name">Last Name</label>
                            <input type="text" id="LastName" name="LastName" required>
                        </div>
                        <div class="form-field">
                            <label for="id_title">Title</label>
                            <input type="text" id="Title" name="Title" required>
                        </div>
                        <div class="form-field">
                            <label for="id_organization">Organization</label>
                            <input type="text" id="Organization" name="Organization" required>
                        </div>
                        <div class="form-field">
                            <label for="id_department">Department</label>
                            <input type="text" id="Department" name="Department" required>
                        </div>
                        <div class="form-field">
                            <label for="id_notes">Notes</label>
                            <textarea id="Notes" name="Notes"></textarea>
                        </div>
                        <div class="form-field">
                            <button type="submit" {% if post_id <= 0 %}disabled{% endif %}>Add Team Member</button>
                        </div>
                    </form>
                    <div id="team-members-table-wrapper">
                        <table class="team-members-table">
                            <thead>
                                <tr>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Department</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for team_member in team_members %}
                                    <tr>
                                        <td>{{ team_member.FirstName }}</td>
                                        <td>{{ team_member.LastName }}</td>
                                        <td>{{ team_member.Department }}</td>
                                        <td>
                                            <a href="#">Edit</a>
                                            <a href="#">Delete</a>
                                        </td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="4">No team members found.</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="bottom-column">
            <div id="third-column">
                <h2>Select an Option</h2>
                <ul>
                    <li><a href="{% url 'OTRisk:raworksheets' %}">CyberPHA Scenario Worksheet</a></li>
                    <li><a href="{% url 'OTRisk:add_walkthrough' %}">Add Walkthrough</a></li>
                </ul>
            </div>
        </section>
    </div>

    <script>
        function enableForm() {
            var form = document.getElementById("risk_form");
            var inputs = form.getElementsByTagName("input");
            var textareas = form.getElementsByTagName("textarea");
            var selects = form.getElementsByTagName("select");
            document.getElementById("editflag").value = "1";
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].removeAttribute("disabled");
            }

            for (var i = 0; i < textareas.length; i++) {
                textareas[i].removeAttribute("disabled");
            }

            for (var i = 0; i < selects.length; i++) {
                selects[i].removeAttribute("disabled");
            }

            var editButton = form.querySelector('button[type="button"]');
            var saveButton = form.querySelector('button[type="submit"]');

            editButton.disabled = true;
            saveButton.disabled = false;
        }

        function createNewCyberPHA() {
            var form = document.getElementById("risk_form");
            var inputs = form.getElementsByTagName("input");
            var textareas = form.getElementsByTagName("textarea");
            document.getElementById("editflag").value = "0";
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].removeAttribute("disabled");
                inputs[i].style.backgroundColor = "rgba(255, 255, 192, 0.5)";
            }

            for (var i = 0; i < textareas.length; i++) {
                textareas[i].removeAttribute("disabled");
                textareas[i].style.backgroundColor = "rgba(255, 255, 192, 0.5)";
            }

            var createButton = form.querySelector('button[type="button"]');
            var saveButton = form.querySelector('button[type="submit"]');

            createButton.disabled = true;
            saveButton.disabled = false;

            document.getElementById("risk_form").reset();

        }
    </script>


</body>
</html>
