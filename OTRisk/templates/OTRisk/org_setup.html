{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>AnzenOT - GRC for OT</title>
    <link rel="icon" href="{% static 'images/AnzenOTIconBlack.png' %}" type="image/x-icon">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">

    <!-- Bootstrap Select CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="{% static 'bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>

        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

     {% load django_bootstrap5 %}
     {% bootstrap_css %}
     {% bootstrap_javascript %}
<link rel="stylesheet" type="text/css" href="{% static 'css/otriskstyle.css' %}">
</head>
<body style="background-color: #464748">
<div class="container-fluid">
<div class="row">
    {% include 'menu_bar.html' %}
    <main role="main" class="col-md-10 ml-sm-auto col-lg-12  custom-main-content" >
    <div class="top-strip">
        <h1 class="page-title">Defaults@AnzenOT (Beta)</h1>
    </div>



<div class="row" style="height: 10px">
    <div class="col"></div>
</div>
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="text-center">Default Settings for {{ user.userprofile.organization.name }}</h4>
                </div>
                <div class="card-body">
                    <form method="post" class="form-horizontal">
                        {% csrf_token %}
                        {% for field in form %}
                            <div class="form-group row mb-3">
                                <label for="{{ field.id_for_label }}" >{{ field.label }}</label>
                                <div class="col-sm-8">
                                    {{ field }}
                                    {% if field.help_text %}
                                        <small class="form-text text-muted">{{ field.help_text }}</small>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                        <div class="form-group row">
                            <div class="col-sm-12 text-center">
                                <button type="button" class="btn btn-primary" id="submitBtn">Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('submitBtn').addEventListener('click', function(e) {
    e.preventDefault();

    // Function to reformat currency values to plain numbers
    function reformatCurrencyFields() {
        var currencyFields = ['id_annual_revenue', 'id_cyber_insurance', 'id_insurance_deductible'];
        currencyFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field && field.value) {
                // Remove non-numeric characters except the decimal point
                var numericValue = field.value.replace(/[^0-9.]/g, '');
                field.value = numericValue;
            }
        });
    }

    // Call the reformat function before submitting
    reformatCurrencyFields();

    swal({
        title: "Are you sure?",
        text: "Do you want to proceed with making changes?",
        icon: "warning",
        buttons: true,
        dangerMode: true,
    })
    .then((willSubmit) => {
        if (willSubmit) {
            document.querySelector('form').submit();
        }
    });
});
</script>


 <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // Function to format numbers as currency
        function formatCurrency(value) {
            return parseFloat(value).toLocaleString('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            });
        }

        // Format fields on load
        document.querySelectorAll('input[type="text"][pattern="^\\d+(\\.?\\d{2})?$"]').forEach(function(input) {
            var value = input.value;
            if(value) input.value = formatCurrency(value);
        });

        // Format fields before submitting form
        document.querySelector('form').addEventListener('submit', function() {
            document.querySelectorAll('input[type="text"][pattern="^\\d+(\\.?\\d{2})?$"]').forEach(function(input) {
                var value = input.value.replace(/[^0-9.-]+/g,"");
                input.value = value; // Convert back to plain number for submission
            });
        });

        // Reformat on field blur
        document.querySelectorAll('input[type="text"][pattern="^\\d+(\\.?\\d{2})?$"]').forEach(function(input) {
            input.addEventListener('blur', function(e) {
                var value = e.target.value.replace(/[^0-9.-]+/g,"");
                e.target.value = formatCurrency(value);
            });
        });
    });

    function formatCurrency() {
    var currencyFields = ['id_annual_revenue', 'id_cyber_insurance', 'id_insurance_deductible'];
    currencyFields.forEach(function(fieldId) {
        var field = document.getElementById(fieldId);
        if (field && field.value) {
            field.value = parseFloat(field.value).toLocaleString('en-US', {
                style: 'currency',
                currency: 'USD',
            });
        }
    });
}
window.onload = formatCurrency;
</script>
</body>
</html>