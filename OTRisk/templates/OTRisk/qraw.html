{% load static %}
<!DOCTYPE html>
<!--suppress ALL -->
<html lang="">
<head>

<title>AnzenOT</title>
<link rel="icon" href="{% static 'images/AnzenOTIconBlack.png' %}" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="{%  static 'css/qraw.css' %}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
<script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-bundle.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://d3js.org/d3.v6.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
<link href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
<script type="text/javascript" src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

<script>
$('select').selectpicker();
</script>

{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
<style>

/* Custom CSS for SweetAlert2 dialog */
.swal2-custom-border {
    border: 2px solid #ddd; /* Lighter border */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Shadow */
}


.sub-menu2 {
    display: none;
}

.sub-menu2.active {
    display: block;
}
.sidebar {
height: 100vh;
background-color: #2D2E30; /* Darker shade for sidebar */
padding: 20px 0;
width: 220px; /* Reduced width */
}
.sidebar-logo {
padding: 10px 15px;
text-align: center;
}
.nav-sidebar {
display: flex;
flex-direction: column;
padding-left: 0;
list-style: none;
}
.nav-sidebar .nav-item {
padding: 5px 10px;
/* border-bottom: 1px solid  #fac330; /* Light orange line */
margin: 0 10%;
}
.nav-sidebar .nav-link {
color: #d3d1cd;
border-radius: 0;
transition: color 0.3s ease-in-out;
font-size: 0.8em;
}
.nav-sidebar .nav-link:hover, .nav-sidebar .nav-link.active {
background-color: #3A5F5F;
color: #E0E0E0;
}
/* Enhance dropdown menu */
.dropdown-menu {
background-color: #d3d1cd;
border: none;
}
.dropdown-item:hover, .dropdown-item:focus {
background-color: #fac330; /* Light orange background for hovered dropdown items */
color: #2D2E30;
}

.small-font {
font-size: 0.8rem; /* adjust as needed */
}

.inner-card {
background-color: white;
border-radius: 10px;
margin: 10px 10px 20px 10px;
height: 70%;
}
.card-title-light {
font-weight: lighter;
}

.form-group-white {
    border: 1px solid #464748; /* Border color */
    box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5); /* Outer shadow */
    background-color: #ffffff; /* Lighter shade of #464748 */
     padding: 15px; /* Optional: for internal spacing */
}

.form-sim .form-control{
    max-width: 100%; /* Ensures select does not exceed container width */
    width: auto; /* Optional: Ensures select width is based on content up to max-width */
}
.select2-container--default .select2-selection--single {
    height: calc(1.5em + .75rem + 2px);
    padding: .375rem .75rem;
    font-size: 1rem;
    max-width: 100%;
    font-weight: 400;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: .25rem;
    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
    line-height: 1.5;
}

.select2-container .select2-selection--single .select2-selection__arrow {
    height: calc(1.5em + .75rem + 2px);
}


.custom-table-style th,
.custom-table-style td {
    color: white;
}

.custom-table-style .thead-dark th {
    background-color: #464748;
}
.form-control.custom-textarea {
    flex: 1; /* Make textarea flexible within its container */
    font-size: 14px;
    color: #0a53be;
    resize: none; /* Prevent resizing */
}
.card-body-white {
    background-color: #ffffff;
}

.card-body .custom-table-style .thead-dark th {
    background-color: #464748; /* Dark background for table header */
}

.group-container {
    background: linear-gradient(to bottom right, #464748, #57595b); /* Gradient background */
    border: 1px solid #666; /* Darker border */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); /* Box shadow */
    padding: 15px;
    margin-bottom: 20px; /* Increased space between containers */
    border-radius: 5px; /* Rounded corners */
}

.group-header {
    color: #d3d1cd; /* Lighter color for contrast */
    font-weight: bold;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #777; /* Subtle bottom border */
    font-size: 1.2em; /* Larger font size */
}

.group-body {
    color: #e0e0e0; /* Slightly lighter text color */
    font-family: 'Arial', sans-serif; /* Modern font */
}
.cyberpha-item {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
}

.cube-icon {
    width: 20px; /* Adjust size as needed */
    height: 20px; /* Adjust size as needed */
    margin-right: 10px;
}

.facility-name {
    color: white;
}
.form-group-attack-tree {
    border: 1px solid #464748; /* Border color */
    box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5); /* Outer shadow */
    background-color: #FFFFFF;
    padding: 15px; /* Optional: for internal spacing */
}

.form-group {
    border: 1px solid #464748; /* Border color */
    box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5); /* Outer shadow */
    background-color: #5E6266; /* Lighter shade of #464748 */
    padding: 15px; /* Optional: for internal spacing */
}

.list-group {
  display: flex;
  flex-direction: column;
  padding-left: 0;
  margin-bottom: 0;
}
.file-explorer {
  max-height: 400px;
  overflow-y: auto;
}

.file-explorer .list-group-item {
  display: flex;
  align-items: center;
  padding: 10px;
}

.file-explorer .list-group-item .file-icon {
  font-size: 24px;
  margin-right: 10px;
}

.file-explorer .list-group-item .file-name {
  flex-grow: 1;
}
    .btn-file-dialog {
        background-color: #f0ad4e; /* File folder color */
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
        box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);
        transition: background-color 0.3s ease;
    }
    .btn-file-dialog:hover {
        background-color: #ec971f; /* Darker shade for hover effect */
        color: white;
    }
    /* Optional: Add an icon to resemble a file folder */
    .btn-file-dialog:before {
        content: '\f07b'; /* FontAwesome folder icon */
        font-family: FontAwesome;
        margin-right: 5px;
    }

    .table#rawtable {
        font-family: "Segoe UI", Arial, sans-serif; /* Windows font */
        font-size: 12px;
        color: #000;
    }
    .table#rawtable thead {
        background-color: #e1e1e1; /* Light grey header */
        color: #000;
    }
    .table#rawtable tbody tr {
        background-color: #fff; /* White rows */
    }
    .table#rawtable tbody tr:hover {
        background-color: #e8f4fc; /* Light blue on hover, like Windows selection */
        cursor: default;
    }
    .table#rawtable th, .table#rawtable td {
        border-color: #d3d3d3; /* Light borders for cells */
    }
    /* Style for file/folder icons */
    .table#rawtable .file-icon {
        font-size: 16px;
        color: #808080; /* Grey icon */
        margin-right: 5px;
    }
    .copy-code-link {
    display: inline-block;
    margin-top: 5px;
    color: #aaacaf; /* Adjust the color to match ChatGPT's style or your preference */
    text-decoration: none; /* Removes underline from the link */
    cursor: pointer; /* Changes cursor to indicate clickable */
}

.copy-code-link:hover {
    text-decoration: underline; /* Adds underline on hover for better UX */
}
   .content {
        padding: 20px;
    }
.custom-main-content {
    position: relative; /* Needed for absolute positioning of tabs */
    margin-left: 10px; /* Adjust to account for both sidebars */
    width: calc(100% - 350px); /* Adjust based on the total width of the sidebars */
    min-height: 100vh; /* Ensure it fills the viewport height */
}


@media (min-width: 992px) { /* Adjusting for Bootstrap's large devices breakpoint */
    .custom-main-content {
        width: calc(100% - 200px);
        max-width: calc(90vw - 200px);
        margin-left: 100px;
    }
}

.custom-main-content .container {
    width: 100%; /* Ensure the container fills the custom-main-content */
    max-width: none; /* Override Bootstrap's max-width for containers if necessary */
}
.top-strip {
    background-color: #464748; /* Same as body background for seamless integration */
    color: #d3d1cd; /* Text color */
    padding: 10px 20px; /* Adjust as needed */
    padding-left: 80px; /* Align with the end of the sidebar */
    width: calc(100% - 100px); /* Adjust based on the actual sidebar width */
    box-sizing: border-box;
}
.page-title {
    margin: 0; /* Remove default margins */
    font-size: 1.2rem; /* Adjust size as needed */
}
@media (max-width: 992px) {
    .top-strip {
        padding-left: 0;
        width: 100%;
    }
     .sub-menu {
        left: 0;
        width: 100px; /* Adjust for smaller screens */
    }

.tab-content.active {
    display: block; /* Only the active tab is displayed */
}
    .custom-main-content {
        margin-left: 100px; /* Adjust based on the sub-menu width on smaller screens */
    }
}
/* Sub-menu styles */
.sub-menu {
    position: fixed; /* Fixed position to stay in view */
    top: 0; /* Align with the top of the viewport */
    left: 200px; /* Adjust based on the width of the main sidebar */
    width: 150px; /* Width of the sub-menu */
    height: 100vh; /* Full viewport height */
    background-color: #333; /* Sub-menu background color */
    color: #fff; /* Text color */
    padding: 20px 10px; /* Padding */
    box-sizing: border-box; /* Include padding in width calculation */
}
.sub-menu ul {
    list-style: none; /* Remove default list styling */
    padding: 0; /* Remove default padding */
    margin: 0; /* Remove default margin */
}

.sub-menu li a {
    color: #d3d1cd; /* Link color */
    text-decoration: none; /* Remove underline */
    display: block; /* Make the links fill the container */
    padding: 10px 0; /* Padding for touch targets */
    transition: background-color 0.3s; /* Smooth transition for hover effect */
}
.sub-menu li a:hover, .sub-menu li a.active {
    background-color: #57595b; /* Hover/active background color */
}
.tab-content {
    display: none; /* Hide all tab content by default */
    padding: 20px; /* Padding around content */
    border: 1px solid #666; /* Border for definition */
    margin-top: 20px; /* Space from the top */
    width: 95%; /* 80% of the available width */
    /* height: 80vh; /* 80% of the viewport height */
    position: absolute; /* Positioning relative to its nearest positioned ancestor */
    left: 150px; /* Adjust based on the total width of the main sidebar and sub-menu */
    top: 0; /* Align with the top of the viewport */
    overflow: auto; /* Add scroll for overflow content */
    box-sizing: border-box; /* Include padding and border in the element's total width and height */
}
.tab-content.active {
    display: block; /* Only the active tab is displayed */
}

.top-strip {

    padding: 10px 0;
}

.top-strip .btn {
    margin-right: 10px; /* Spacing between buttons */
}

.page-title {

    text-decoration: none;
}

.page-title:hover {
    text-decoration: underline;
}

#rawtable {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 15px; /* Creates space between rows */
}

/* Style each table row */
#rawtable tr.selectable-row {
    background-color: #f0f0f0; /* Light grey background */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Adds shadow to each row */
    border-radius: 5px; /* Rounds the corners of each row */
}

/* Style the cells (td) of each row */
#rawtable tr.selectable-row td {
    border: none;
    padding: 10px; /* Adds padding inside each cell */
    background-color: #fff; /* White background for contrast with the row's shadow */
    border-radius: 5px; /* Ensure the rounded corners apply to cells as well */
}

/* Ensure hidden inputs do not affect layout */
#rawtable tr.selectable-row input[type="hidden"] {
    display: none;
}

/* Additional styling for headers to match the row aesthetics */
#rawtable th {
    background-color: #2c2c2c;
    color: white;
    padding: 10px;
    border-radius: 5px; /* Optional: Rounds the corners of the header cells */
}
/* Style for selected rows */
#rawtable tr.selectable-row.selected {
    background-color: #007bff; /* Example: a blue background for selected rows */
    color: black; /* White text color for contrast */
}

/* Ensure text within selected rows is also white for contrast */
#rawtable tr.selectable-row.selected td {
    color: black;
}

</style>

</head>
    <!-- Initialize sliders when the page loads -->
<script>
window.onload = function() {
const categories = [
"safety", "life", "production", "finance", "reputation",
"environment", "regulatory", "supply", "data", "vuln",
"threat", "frequency"
];
const numSliders = 5;

for (let i = 1; i <= numSliders; i++) {
categories.forEach(function(category) {
initSlider(`range_${category}_${i}`, `${category}range_${i}`);
});
}
};
</script>

<body style="background-color: #464748">
<script>

    document.addEventListener('DOMContentLoaded', function() {
        sessionStorage.setItem('editMode', '0');
        sessionStorage.setItem('scenario1id', '');
        sessionStorage.setItem('scenario2id', '');
        sessionStorage.setItem('scenario3id', '');
        sessionStorage.setItem('scenario4id', '');
        sessionStorage.setItem('scenario5id', '');
        sessionStorage.setItem('rawid', '');
        setRiskAssessmentRefreshNotRequired(1)
        setRiskAssessmentRefreshNotRequired(2)
        setRiskAssessmentRefreshNotRequired(3)
        setRiskAssessmentRefreshNotRequired(4)
        setRiskAssessmentRefreshNotRequired(5)
});
anychart.licenseKey("iotarisk.com-f1ad231c-886c1b88");
</script>


<form name="frmRAW" id="frmRAW" method="POST" action="{% url 'OTRisk:qraw' %}">
{% csrf_token %}
<input type="hidden" id="orgid" name="orgid" value="{{ user.userprofile.organization.id }}">
<input type="hidden" id="userId" name="userId" value="{{ user.id }}">
<input type="hidden" id="isSuperUser" value="{{ user.is_superuser }}">

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse" id="sidebarMenu">
            <div class="sidebar-sticky " >
                <div class="sidebar-logo">
                    <img src="{% static 'images/anzen_owl.png' %}" class="img-fluid" alt="Logo">
                </div>
                    <ul class="nav flex-column nav-sidebar">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'OTRisk:dashboardhome' %}">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'OTRisk:qraw' %}">QRAW</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'OTRisk:iotaphamanager' %}">CyberPHA</a>
                        </li>
                        <li class="nav-item menu-item">
                            <a class="nav-link" href="{% url 'OTRisk:scenario_sim' %}">Scenario Builder</a>
                        </li>
                        <li class="nav-item menu-item">
                            <a class="nav-link" href="{% url 'OTRisk:ra_actions_view_default' %}">Actions</a>
                        </li>
                        <li class="nav-item menu-item">
                            <a class="nav-link" href="{% url 'OTRisk:risk_register' %}">Risk Register</a>
                        </li>
                        <li class="nav-item menu-item">
                            <a class="nav-link" href="{% url 'OTRisk:list_frameworks' %}">Assessments</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Admin
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">

                                <li>
                                    <a  class="dropdown-item" style="font-size: 12px;" href="{% url 'OTRisk:setup_org' %}">Set Defaults</a>
                                </li>
                                <li>
                                    <a  class="dropdown-item" style="font-size: 12px;" href="{% url 'OTRisk:admin_users' %}">Admin Users</a>
                                </li>
                                <li>
                                    <a  class="dropdown-item" style="font-size: 12px;" href="{% url 'OTRisk:upload_questionnaire' %}">Upload Questionnaires</a>
                                </li>
                                {% if user.is_staff %}
                                <!-- Links visible only to superusers -->
                                <li>
                                    <a class="dropdown-item" style="font-size: 12px;" href="{% url 'OTRisk:user_admin' %}">User Administration</a>
                                </li>
                                <li>
                                    <a class="dropdown-item"  style="font-size: 12px;" href="{% url 'OTRisk:organization_form' %}">Manage Organizations</a>
                                </li>
                                <li>
                                    <a class="dropdown-item" style="font-size: 12px;" href="{% url 'OTRisk:execute_sql' %}">Execute SQL</a>
                                </li>
                                {% endif %}
                            </ul>
                         </li>
                    <li class="nav-item menu-item">
                        <a class="nav-link" href="{% url 'accounts:profile' %}">
                        <i class="bi bi-person-fill"></i> {{ user.first_name }} {{ user.last_name }} | {{ user.userprofile.organization.name }}
                        </a>
                        </li>
                         <li class="nav-item menu-item">
                        <form action="{% url 'logout' %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="nav-link" id="btnlogout" style="background:none; border:none; padding:0; margin:0; color:#d3d1cd;">Logout</button>
                    </form>

                        </li>
                        </ul>
            </div>
                </nav>
                <div id="notificationMessage" class="notification-message" style="display: none;"></div>
                <div class="col-md-9 col-lg-10 position-relative">

                    <div id="notificationMessage" class="notification-message" style="display: none;"></div>
                    <div class="top-strip">
                    <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-4">
                        <a class="page-title" style="color: #d3d1cd" id="cyberPHALink">QRAW@AnzenOT (Beta) </a>

                    </div>
                    <div class="col-md-1" >
                        <button class="form-control" id="addNewBtn" type="button" data-bs-toggle="tooltip" data-bs-placement="top" title="Click this button to clear the form and enter and begin a new risk assessment"><i class="bi bi-folder-plus"></i> New</button>
                        <script>
                            document.addEventListener('DOMContentLoaded', function() {
                            document.getElementById('addNewBtn').addEventListener('click', function() {
                                confirmAddNew();
                            });
                        });

                        function confirmAddNew() {
                            Swal.fire({
                                title: 'Add New Risk Assessment?',
                                text: "Create a new risk assessment? Any unsaved data will be lost",
                                imageUrl: 'static/images/anzen_owl.png',
                                imageWidth: 150, // Adjust as necessary
                                imageHeight: 150, // Adjust as necessary
                                background: '#000', // Black background
                                color: '#fff', // Set text color to white
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Yes',
                                cancelButtonText: 'Cancel',
                                customClass: {
                                    popup: 'swal2-custom-border' // Apply custom class to the popup/dialog
                                }
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    handleAddNewClick(1); // Proceed with the original function if the user confirms
                                }
                                // If the user cancels, do nothing
                            });
                        }

                        </script>
                    </div>
                    <div class="col-md-1" >
                            <button class="form-control" id="editBtn" type="button" data-bs-toggle="tooltip" data-bs-placement="top" title="Click this button to edit the current risk assessment and scenarios"><i class="bi bi-pencil-square"></i> Edit</button>
                    </div>
                    <div class="col-md-1" >
                        <button class="form-control" type="button" id="actionBtn" onclick="showRAActionsModal()"><i class="bi bi-subtract"></i> Action</button>
                    </div>
                    <div class="col-md-1"></div>
                    <div class="col-md-1"></div>
                    <div class="col-md-1"></div>
                    <div class="col-md-1"></div>
                    <div class="col-md-1"></div>
                </div>
                    <div class="row">
                        <div class="col-md-1"></div>
                        <div class="col-md-6">Risk Assessment Title: <span id="scenario_title"></span></div>
                        <div class="col-md-5"></div>
                    </div>
            </div>
                    <div class="sub-menu sub-menu-container small-font">
            <br><br><br><br><br><br><br><br><br><br><br><br>
            Click the tab headings
        <ul>

            <li><a href="#" data-tab="tab1" class="tab-link">QRAW Table</a></li>
            <li><a href="#" data-tab="tab2" class="tab-link">QRAW Setup</a></li>
            <li>
                <a href="#scenario1" data-tab="scenario1" class="tab-link" id="scenario1-tab" >Scenario 1</a>
                 <ul class="sub-menu2">
                    <li><a href="#" data-tab="tab9" class="tab-link">Scenario 1 Outcomes</a></li>
                </ul>
            </li>
            <li><a href="#scenario2" data-tab="scenario2" class="tab-link" id="scenario2-tab" >Scenario 2</a>
                <ul class="sub-menu2">
                    <li><a href="#" data-tab="tab10" class="tab-link">Scenario 2 Outcomes</a></li>
                </ul>
            </li>

            <li><a href="#scenario3" data-tab="scenario3" class="tab-link" id="scenario3-tab">Scenario 3</a>
                <ul class="sub-menu2">
                    <li><a href="#" data-tab="tab11" class="tab-link">Scenario 3 Outcomes</a></li>
                </ul>
            </li>
            <li><a href="#scenario4" data-tab="scenario4" class="tab-link" id="scenario4-tab">Scenario 4</a>
                <ul class="sub-menu2">
                    <li><a href="#" data-tab="tab12" class="tab-link">Scenario 4 Outcomes</a></li>
                </ul>
            </li>
            <li><a href="#scenario5" data-tab="scenario5" class="tab-link" id="scenario5-tab" >Scenario 5</a>
                <ul class="sub-menu2">
                    <li><a href="#" data-tab="tab13" class="tab-link">Scenario 5 Outcomes</a></li>
                </ul>
            </li>
            <li><a href="#" data-tab="tab8" class="tab-link">Action Items</a></li>

        </ul>
        <script>
        $(document).ready(function() {
            $('.tab-link').click(function(e) {
                e.preventDefault(); // Prevent the default link behavior

                var currentTab = $(this).attr('data-tab');

                $('.tab-content').hide(); // Hide all tab contents
                $('#' + currentTab).show(); // Show the current tab content

                $('.tab-link').removeClass('active'); // Remove 'active' class from all tab links
                $(this).addClass('active'); // Add 'active' class to the clicked tab link
            });
        });

        $(document).ready(function() {
            $('.tab-link').click(function(e) {
                e.preventDefault();

                // Hide all sub-menus
                $('.sub-menu2').removeClass('active');

                // If the clicked tab is a scenario, toggle its submenu
                if ($(this).data('tab').startsWith('scenario1') || $(this).data('tab').startsWith('scenario2') || $(this).data('tab').startsWith('scenario3') || $(this).data('tab').startsWith('scenario4') || $(this).data('tab').startsWith('scenario5')) {
                $(this).next('.sub-menu2').toggleClass('active');
            }
            });
        });
    </script>
    </div>
     <div class="custom-main-content" >
        <div class="tab-content active" id="tab1">
            <h3 style="color: #FFF">Assessments</h3>
            <div id="dataTableContainer" data-saved-id="{{ saved_worksheet_id }}">
            <div class="form-group">
            <table id="rawtable" class="table table-striped table-bordered">
                <thead style="background-color: #2c2c2c; color: white">
                <tr>
                    <th></th>
                    <th width="20%">Title</th>
                    <th>Status</th>
                    <th>BIA</th>
                    <th>Risk</th>
                    <th>Trigger</th>
                    <th>Facility Type</th>
                    <th>Industry</th>
                    <th>Business Unit</th>
                    <th>Leader</th>
                    <th></th>
                    <!-- Add more <th> elements for each field in the RAWorksheet model -->
                </tr>
            </thead>
            <tbody>
                {% for raw in raws %}
                    <tr class="selectable-row"
                        data-id="{{ raw.ID }}"
                        data-revenue="{{ raw.revenue }}"
                        data-insurance="{{ raw.insurance }}"
                        data-approver-id="{{ raw.approver_id }}"
                        data-owner="{{ raw.UserID}}"
                        data-deductable="{{ raw.deductable }}">
                        <td>{{ raw.ID }}</td>
                        <td style="font-size: 14px"><b>{{ raw.RATitle }}</b></td>
                        <td>{{ raw.StatusFlag }}</td>
                        <td>
                            {% if raw.bia_text == 'Low' or raw.bia_text == 'Low/Medium' %}
                                <span class="green-circle"></span>
                            {% elif raw.bia_text == 'Medium' or raw.bia_text == 'Medium/High' %}
                                <span class="orange-circle"></span>
                            {% elif raw.bia_text == 'High' or raw.bia_text == 'Very High' %}
                                <span class="red-circle"></span>
                            {% endif %}
                            {{ raw.bia_text }}
                        </td>
                        <td>
                            {% if raw.risk_text == 'Low' or raw.risk_text == 'Low/Medium' %}
                                <span class="green-circle"></span>
                            {% elif raw.risk_text == 'Medium' or raw.risk_text == 'Medium/High' %}
                                <span class="orange-circle"></span>
                            {% elif raw.risk_text == 'High' or raw.risk_text == 'Very High' %}
                                <span class="red-circle"></span>
                            {% endif %}
                            {{ raw.risk_text }}
                        </td>
                        <td>{{ raw.RATrigger }}</td>
                        <td>{{ raw.BusinessUnitType }}</td>
                        <td>{{ raw.industry }}</td>
                        <td>{{ raw.BusinessUnit }}</td>
                        <td>{{ raw.AssessorName }}</td>
                        <td><a class="dropdown-item" href="{% url 'OTRisk:qraw_reports'  qraw_id=raw.ID  %}">Report</a></td>
                    </tr>
                {% endfor %}
            </tbody>
            </table>
    </div>
        </div>
            <script>
                $(document).ready(function() {
                    $('#rawtable').on('click', 'tbody tr.selectable-row', function() {
                    // Remove 'highlighted' class from all other rows
                     $('tr.selectable-row').removeClass('highlighted');

                    // Add 'highlighted' class to the clicked row
                    $(this).addClass('highlighted');
                    var ratitle = $(this).find('td:nth-child(2)').text();
                    $('#scenario_title').text(ratitle);
                    //handleAddNewClick(1);
                    });
                });

            function showRAActionsModal() {
                var rawid = sessionStorage.getItem('rawid');  // Get the value from session storage

                if (rawid === null || rawid === "") {
                    alert("Please select a risk assessment from the table first before creating an action item.");
                } else {
                    $('#RAActionsModal').modal('show');  // Show the modal if rawid has a value
                }
            }

            function handleAddNewClick(default_code) {

                if (default_code == 1) {
                    var ratitle = $(this).find('td:nth-child(2)').text();
                    $('#scenario_title').text(ratitle);
                };
                for (var j = 1; j <= 5; j++) {
                    $('#scenario' + j + '-tab').find('.bi-check-square').remove();
                }
                // Enable buttons and set session storage
                $('#saveBtn, #actionBtn, #btnlogout').prop('disabled', false);
                ['editMode', 'addNew', 'rawid'].forEach(key => sessionStorage.setItem(key, key === 'editMode' ? '0' : '1'));
                enableAllControls();
                // Reset input fields and enable them
                var inputFields = [
                "txtTitle", "txtRevenue", "txtInsurance", "txtDeductable",
                "txtLeader", "txtBU", "selectIndustry", "selectFacility",
                "selectTrigger", "selectStatus"
                ];
                inputFields.forEach(resetAndEnableField);

                // Reset scenario tabs
                for (let i = 1; i <= 5; i++) {
                resetScenarioTab(i);
                }
                document.getElementById("hdnRawID").value = 0;
                // Click the first scenario tab to reset it to default
                document.getElementById("scenario1-tab").click();

                var organizationId = document.getElementById('orgid').value;

                if (default_code==1) {
                    fetch(`/OTRisk/get-organization-defaults/${organizationId}/`)
                        .then(response => response.json())
                        .then(data => {
                            var revenue = data.annual_revenue || 0;
                            var formattedRevenue = formatCurrency(revenue);

                            var insurance = data.cyber_insurance || 0;
                            var formattedInsurance = formatCurrency(insurance);

                            var deductable = data.insurance_deductible || 0;
                            var formattedDeductable = formatCurrency(deductable);

                            // Update txtRevenue field with formatted annual_revenue
                            document.getElementById('txtRevenue').value = formattedRevenue;
                            document.getElementById('txtInsurance').value = formattedInsurance;
                            document.getElementById('txtDeductable').value = formattedDeductable;
                            document.getElementById('selectIndustry').value = data.industry;
                            let industrySelect = document.getElementById('selectIndustry');
                            industrySelect.value = data.industry; // Set the value

                            // Trigger a change event
                            if ('createEvent' in document) {
                                var evt = document.createEvent('HTMLEvents');
                                evt.initEvent('change', false, true);
                                industrySelect.dispatchEvent(evt);
                            } else {
                                industrySelect.fireEvent('onchange');
                            }
                        })
                        .catch(error => console.error('Error fetching organization defaults:', error));
                }
                document.getElementById("txtTitle").focus();

                    $('.tab-content').removeClass('active').hide();
                    $('#tab2').addClass('active').show();


            }

            // Function to format number as currency
            function formatCurrency(number) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',  // Update the currency code as needed
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(number);
            }

            function resetAndEnableField(fieldId) {
              var field = document.getElementById(fieldId);
              if(field.type === 'select-one') field.selectedIndex = 0;
              else field.value = "";
              field.disabled = false;
            }

            function resetScenarioTab(tabNumber) {

              var prefix = `scenario${tabNumber}`;
              document.getElementById(`${prefix}-tab`).click();

              var fieldsToReset = ["txtScenarioDescription", "selectThreat", "selectTactics", "exposed_system","weak_credentials",
                                   "id_impact", "txtAssets",  "lblriskRating","txtexec_summary","txtDamage","production_outage",
                                   "scenario_12month_costs", "outage", "txtScenarioAnalysis"];

              fieldsToReset.forEach(function(field) {
                    var element = document.getElementById(`${field}_${tabNumber}`);
                    // Check if the element exists before trying to access its properties
                    if (element) {
                        if(element.tagName === 'SELECT') {
                            element.value = '';
                        } else if(element.type === 'checkbox') { // Check if the element is a checkbox
                            element.checked = false; // Reset checkbox to unchecked
                        } else {
                            element.value = element.type === 'range' ? '0' : '';
                        }

                        element.disabled = false;
                    } else {
                        // Optionally, log a warning or handle the case where the element is not found
                        console.warn(`Element with ID ${field}_${tabNumber} not found.`);
                    }
                });

             const categories = [
                "safety", "life", "production", "finance", "reputation",
                "environment", "regulatory", "supply", "data", "vuln",
                "threat", "frequency"
            ];
            const numSliders = 5;

            for (let i = 1; i <= numSliders; i++) {
                categories.forEach(function(category) {
                    document.getElementById(`range_${category}_${i}`).value = 0;
                    initSlider(`range_${category}_${i}`, `${category}range_${i}`);
                });
            }

            }
            // end of reset controls

            document.addEventListener('DOMContentLoaded', function() {
              var enableButton = document.getElementById('editBtn');

              enableButton.addEventListener('click', function() {
                $('#saveBtn').prop('disabled', false);
                $('#actionBtn').prop('disabled', false);
                $('#btnlogout').prop('disabled', false);
                sessionStorage.setItem('editMode', '1');
                sessionStorage.setItem('addNew', '0');
                document.getElementById("edit_mode").value="1";
                enableAllControls();
                //document.getElementById("scenario1-tab").click();

               });
            });

        </script>
            <input type="hidden" name="edit_mode" id="edit_mode">
            <input type="hidden" name="scenarioCount" id="scenarioCount">
            <input type="hidden" name="hdnRawID" id="hdnRawID">
        </div>
        <div class="tab-content" id="tab2">
            <h2 style="color:white">QRAW Setup</h2>
            <div class="form-group">
            <div class="row">

            <div class="col-md-4">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                <div class="card-body">
                <label for="txtTitle" style="color: black">Risk Assessment Title</label>
                <input type="text" class="form-control" name="txtTitle" id="txtTitle" placeholder="Enter a title for this risk assessment" maxlength="50" required/>
                </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                <div class="card-body">
                <label for="txtBU" style="color: #000">Business Unit</label>
                <input type="text" class="form-control" name="txtBU" id="txtBU" placeholder="Enter a name for the business unit or facility for this risk assessment" maxlength="50" required>
                </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                <div class="card-body">
                <label for="txtLeader" style="color: #000">Assessment Leader</label>
                <input type="text" class="form-control" name="txtLeader" id="txtLeader" placeholder="Enter the name of the person leading this risk assessment" maxlength="50" required>
                </div>
                </div>
            </div>

            </div>
            </div>
            <br>
            <div class="form-group">
            <div class="row">
                <div class="col-md-4">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                    <div class="card-body">
                        <label for="selectIndustry" style="color: #black">Industry</label><br>
                        <select id="selectIndustry" name="selectIndustry" class="form-control">
                            <option value="">-- Select Industry --</option>
                            {% for industry in industries %}
                                <option value="{{ industry.Industry }}">{{ industry.Industry }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                    <div class="card-body">
                                <label for="selectFacility" style="color: black">Facility Type</label><br>
                                <select id="selectFacility" name="selectFacility" class="form-control">
                                    <option value="">-- Select Facility --</option>
                                    {% for facility in facilities %}
                                        <option value="{{ facility.FacilityType}}">{{ facility.FacilityType }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                     <div class="card-body">
                                <label for="selectTrigger" style="color: black">Trigger Event</label><br>
                                <select id="selectTrigger" name="selectTrigger" class="form-control">
                                    <option value="">-- Select Assessment Trigger --</option>
                                    <option value="Audit - External">Audit - External</option>
                                    <option value="Audit - Internal">Audit - Internal</option>
                                    <option value="Change Request">Change Request</option>
                                    <option value="Incident">Incident</option>
                                    <option value="Policy Exception">Policy Exception</option>
                                    <option value="Scheduled Assessment">Scheduled Assessment</option>
                                    <option value="Site Walkdown">Site Walkdown</option>
                                </select>
                            </div>
                    </div>
                </div>

            </div>
            </div>
            <br>
            <div class="form-group">
            <div class="row">

            <div class="col-md-4">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                    <div class="card-body">
                        <label for="txtRevenue" style="color: #000"><i class="bi bi-currency-exchange"></i> Annual Revenue</label>
                        <input type="text" class="form-control" name="txtRevenue" id="txtRevenue" >
                    </div>
                 <script>
                 $(document).ready(function() {
                    $("#txtRevenue").on("input", function() {
                        // Remove any non-digit characters
                        var val = $(this).val().replace(/[^0-9]/g, '');

                        // Convert to whole number currency format
                        var currencyVal = parseInt(val, 10).toLocaleString('en-US');

                        // Set the formatted value
                        $(this).val(currencyVal);
                    });
                });
                 </script>

             </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;"> <!-- Bootstrap card with shadow -->
                    <div class="card-body">
                        <label for="txtInsurance" style="color: #000"><i class="bi bi-cash-coin"></i> Cyber Insurance Cover</label>
                        <input type="text" class="form-control" name="txtInsurance" id="txtInsurance" >
                        <script>
                         $(document).ready(function() {
                            $("#txtInsurance").on("input", function() {
                                // Remove any non-digit characters
                                var val = $(this).val().replace(/[^0-9]/g, '');

                                // Convert to whole number currency format
                                var currencyVal = parseInt(val, 10).toLocaleString('en-US');

                                // Set the formatted value
                                $(this).val(currencyVal);
                            });
                        });
                         </script>

                    </div>
             </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                    <div class="card-body">
                        <label for="txtDeductable" style="color: #000"><i class="bi bi-calculator"></i> Insurance Deductable Amount</label>
                        <script>
                         $(document).ready(function() {
                            $("#txtDeductable").on("input", function() {
                                // Remove any non-digit characters
                                var val = $(this).val().replace(/[^0-9]/g, '');

                                // Convert to whole number currency format
                                var currencyVal = parseInt(val, 10).toLocaleString('en-US');

                                // Set the formatted value
                                $(this).val(currencyVal);
                            });
                        });
                         </script>
                        <input type="text" class="form-control" name="txtDeductable" id="txtDeductable" >

                    </div>
                </div>
            </div>

            </div>
            </div>
            <br>
            <div class="form-group">
            <div class="row">

            <div class="col-md-4">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                  <div class="card-body">
                    <label for="selectStatus" style="color: black">Status</label><br>
                    <select id="selectStatus" name="selectStatus" class="form-control">
                        <option value="">-- Select Status --</option>
                        <option value="Open">Open</option>
                        <option value="Closed">Closed</option>
                        <option value="Approved">Approved</option>
                        <option value="Rejected">Rejected</option>
                    </select>
                </div>
                </div>
            </div>
            <div class="col-md-4 workflow-management-section">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;" id="workflow-mgmt">
        <div class="card-body">
            <h5 class="card-title" style="color: #d3d1cd">Workflow Management</h5>

            <!-- Assign Approver (Visible to Creator/Editor) -->
            <div class="mb-3">
                <!-- Approver Selection Dropdown -->
                <div class="form-group">
                    <label for="selectApprover">Select Approver:</label>
                    <select class="form-control" id="selectApprover" name="selectedApprover">
                        <option value="">-- Select Approver --</option>
                        {% for approver in potential_approvers %}
                            <option value="{{ approver.user.id }}">{{ approver.user.get_full_name }}</option>
                        {% endfor %}
                    </select>
                </div>

            </div>

            <!-- Approval Controls (Visible to Approver) -->
            <div id="approvalControls" style="display: none;">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="approveCheckbox">
                    <label class="form-check-label" for="approveCheckbox" style="color: #d3d1cd">
                        Approve
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="rejectCheckbox">
                    <label class="form-check-label" for="rejectCheckbox" style="color: #d3d1cd">
                        Reject
                    </label>
                </div>
                <div class="mb-3">
                    <label for="rejectionComments" style="color: #d3d1cd">Comments</label>
                    <textarea class="form-control" id="rejectionComments" rows="3"></textarea>
                </div>
            </div>

            <!-- Submit Button for Workflow Actions -->
            <button class="btn btn-primary" type="button" id="workflowBtn">Submit Workflow Action</button>
        </div>
    </div>
                <script>
   $(document).ready(function() {
    $('#workflowBtn').on('click', function(e) {
        e.preventDefault();

        var worksheetId = $('#hdnRawID').val(); // Ensure this is the correct ID
        var selectedApproverId = $('#selectApprover').val();
        var approvalStatus = $('#approveCheckbox').is(':checked') ? 'Approved' :
                             $('#rejectCheckbox').is(':checked') ? 'Rejected' : '';
        var rejectionComments = $('#rejectionComments').val();

        // Determine the action to take (assign approver, approve, or reject)
        var action, titleText, confirmButtonText;
        if (selectedApproverId) {
            action = 'assign_approver';
            titleText = "Are you sure you want to assign this user as approver?";
            confirmButtonText = 'Yes, assign it!';
        } else if (approvalStatus === 'Approved') {
            action = 'approve';
            titleText = "You are about to approve this worksheet.";
            confirmButtonText = 'Yes, approve it!';
        } else if (approvalStatus === 'Rejected') {
            action = 'reject';
            titleText = "You are about to reject this worksheet.";
            confirmButtonText = 'Yes, reject it!';
        } else {
            swal.fire('Error!', 'No action selected.', 'error');
            return;
        }

        swal.fire({
            title: 'Are you sure?',
            text: titleText,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: confirmButtonText
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '/OTRisk/update_workflow/',
                    type: 'POST',
                    data: {
                        'worksheet_id': worksheetId,
                        'selected_approver_id': selectedApproverId,
                        'approval_status': approvalStatus,
                        'rejection_comments': rejectionComments,
                        'action': action,
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val() // CSRF token
                    },
                    success: function(response) {
                        swal.fire('Updated!', response.message, 'success');
                    },
                    error: function(xhr) {
                        var errorMessage = xhr.status === 404 ? 'Worksheet not found.' : 'An error occurred.';
                        swal.fire('Error!', errorMessage, 'error');
                    }
                });
            }
        });
    });
});

</script>
            </div>
            <div class="col-md-4 ">
                <div class="card mb-3 shadow-sm" style="border: 1px solid black;">
                    <div class="card-body">
                <button class="form-control" type="submit" id="saveBtn" data-bs-toggle="tooltip" data-bs-placement="top" title="Click this button to save the risk assessment header information." onclick="return checkRiskAssessmentRefreshVariables();" ><i class="bi bi-download"></i> Save Header</button>
                </div>
                </div>
            </div>

            </div>
            </div>
        </div>

        <div class="tab-content" id="scenario1">
            <h3 style="color:#fff">Scenario 1</h3>
            <div class="row">
            <div class="col-md-6 small-font">

                <input type="hidden" name="hdnScenarioID_1" id="hdnScenarioID_1">
                <br>
                <div class="group-container">
                    <div class="group-header">
                        <div class="row">
                            <div class="col-md-5"><span style="color: white;">Scenario Description</span></div>
                            <div class="col-md-1"></div>
                            <div class="col-md-5"><button type="button" class="btn btn-primary btn-file-dialog" data-bs-toggle="modal" data-bs-target="#scenarioSelectModal" id="btnSelectScenario_1">Load Scenario</button></div>
                            <div class="col-md-1"></div>
                        </div>
                        </div>
                    <div class="group-body">
                        <textarea class="form-control small-font" name="txtScenarioDescription_1" id="txtScenarioDescription_1" rows="5" style="resize: none; word-wrap: normal" placeholder="Enter a concise and descriptive scenario" onchange="setRiskAssessmentRefreshRequired(1)" onblur="analyze_Scenario(1)"></textarea>
                        <div class="spinner-container" style="position: relative;">
                            <div class="spinner-overlay_1" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.7); display: none; justify-content: center; align-items: center;">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only">Analyzing...</span>
                                </div>
                            </div>
                            <br>
                            <input class="form-check-input" type="checkbox" id="lock_scenario_1" onchange="toggleLockScenario()">
                            <label class="form-check-label" for="lock_scenario_1">
                                Lock Scenario
                            </label>
                                <br>
                            <label for="txtScenarioAnalysis_1" class="small-font" style="visibility: hidden">Recommendations will align with selected standards:</label>
                            <textarea id="txtScenarioAnalysis_1" name="txtScenarioAnalysis_1" class="form-control small-font"  rows="5" style="resize: none; word-wrap: normal" readonly></textarea>

                            <script>
                            function toggleLockScenario() {
                                var checkbox = document.getElementById('lock_scenario_1');
                                var textarea = document.getElementById('txtScenarioDescription_1');
                                textarea.readOnly = checkbox.checked; // Set textarea readonly based on checkbox
                            }
                            </script>
                        </div>
                    </div>
                </div>


            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Exposed IP Address
                                </div>
                                <div class="group-body">

                                    <label class="switch">
                                      <input type="checkbox" id="exposed_system_1" name="exposed_system_1">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Default/ Weak Credentials
                                </div>
                                <div class="group-body">
                                <label class="switch">
                          <input type="checkbox" id="weak_credentials_1" name="weak_credentials_1">
                          <span class="slider1 round"></span>
                        </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>
            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Production Outage
                                </div>
                                <div class="group-body">
                                <label class="switch">
                                      <input type="checkbox" id="production_outage_1" name="production_outage_1">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Outage Length (hours)
                                </div>
                                <div class="group-body">

                            <input type="number" id="outage_1" name="outage_1" min="0" max="100" class="form-control">
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Source

                </div>
                <div class="group-body">

                  <select id="selectThreat_1" name="selectThreat_1" class="form-control small-font">
                    <option value="">-- Select Threat Source --</option>
                    {% for threatsources in threatsources %}
                        <option value="{{ threatsources.ThreatSource}}">{{ threatsources.ThreatSource }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Tactic

                </div>
                <div class="group-body">
                    <select id="selectTactics_1" name="selectTactics_1" class="form-control small-font">
                    <option value="">-- Select Threat Tactics --</option>
                    {% for mitreTactics in mitreTactics %}
                        <option value="{{ mitreTactics.tactic}}">{{ mitreTactics.tactic }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>
            <div class="group-container">
                <div class="group-header">
                     Scenario Impact

                </div>
                <div class="group-body">
                     <select id="id_impact_1" name="impact" class="form-control small-font">
                        <option value="">-- Select Impact --</option>
                        {% for value, display in scenario_form.fields.impact.choices %}
                            <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>

                </div>
              </div>
                <div class="group-container">
                <div class="group-header">
                     Asset Detail

                </div>
                <div class="group-body">
                     <textarea class="form-control small-font" name="txtAssets_1" id="txtAssets_1" rows="3" style="resize: none; word-wrap: normal" placeholder="Add asset names relevant to the scenario..."></textarea>

                </div>
              </div>

                </div>
            <div class="col-md-6 small-font">
                <br>
                <div class="group-container">
                <h5 style="color: white">Business Impact Analysis</h5>
                <font style="color:white">Click the icons to add additional detail</font>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for safety rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#safetyModal_1" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/safety.png' %}" style="height:2rem"> &nbsp;Safety</label></div>
                                <div class="col-7">
                                    <label for="range_safety_1"></label>

                                    <input type="range" min="1" max="10" value="1" class="slider" id="range_safety_1" name="range_safety_1" onchange="initSlider('range_safety_1', 'safetyrange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><label id="safetyrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                              </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for life rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#lifeModal_1" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/danger.png' %}" style="height:2rem"> &nbsp;Life</label></div>
                                <div class="col-7">
                                    <label for="range_life_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_life_1" name="range_life_1" onchange="initSlider('range_life_1', 'liferange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><h6><label id="liferange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for production rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#productionModal_1" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/production.png' %}" style="height:2rem">&nbsp; Production</label></div>
                                <div class="col-7">
                                    <label for="range_production_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_production_1" name="range_production_1" onchange="initSlider('range_production_1', 'productionrange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><h6><label id="productionrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                             <!--slider for finance rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#financeModal_1"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/finance.png' %}" style="height:2rem">&nbsp; Financial</label></div>
                                <div class="col-7">
                                    <label for="range_finance_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_finance_1" name="range_finance_1" onchange="initSlider('range_finance_1', 'financerange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><h6><label id="financerange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for reputation rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#reputationModal_1"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/reputation.png' %}" style="height:2rem"> &nbsp;Reputation</label></div>
                                <div class="col-7">
                                    <label for="range_reputation_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_reputation_1" name="range_reputation_1" onchange="initSlider('range_reputation_1', 'reputationrange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><h6><label id="reputationrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for environment impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#environmentModal_1"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/environment.png' %}" style="height:2rem"> &nbsp;Environment</label></div>
                                <div class="col-7">
                                    <label for="range_environment_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_environment_1" name="range_environment_1" onchange="initSlider('range_environment_1', 'environmentrange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><h6><label id="environmentrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for regulatory impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#regulationModal_1"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/regulation.png' %}" style="height:2rem">&nbsp; Regulatory</label></div>
                                <div class="col-7">
                                    <label for="range_regulatory_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_regulatory_1" name="range_regulatory_1" onchange="initSlider('range_regulatory_1', 'regulatoryrange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><h6><label id="regulatoryrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#dataModal_1"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/data.png' %}" style="height:2rem"> &nbsp;Data/IP</label></div>
                                <div class="col-7">
                                    <label for="range_data_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_data_1" name="range_data_1" onchange="initSlider('range_data_1', 'datarange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><h6><label id="datarange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#supplyModal_1"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/supply.png' %}" style="height:2rem"> &nbsp;Supply Chain</label></div>
                                <div class="col-7">
                                    <label for="range_supply_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_supply_1" name="range_supply_1" onchange="initSlider('range_supply_1', 'supplyrange_1');setRiskAssessmentRefreshRequired(1);">
                                </div>
                                <div class="col-2"><h6><label id="supplyrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                </div>
                <h5 style="color: white">Vulnerability and Likelihood Analysis</h5>
                <div class="group-container">
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for vulnerability rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#vulnModal_1"  data-bs-placement="top" style="cursor: pointer">Vulnerability</label></div>
                                <div class="col-7">
                                    <label for="range_vuln_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_vuln_1" name="range_vuln_1" onchange="initSlider('range_vuln_1', 'vulnrange_1')">
                                </div>
                                <div class="col-3"><label id="vulnrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for threat rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to estimate the danger to life of the selected scenario">Threat</label></div>
                                <div class="col-7">
                                    <label for="range_threat_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_threat_1" name="range_threat_1" onchange="initSlider('range_threat_1', 'threatrange_1');">
                                </div>
                                <div class="col-3"><h6><label id="threatrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for frequency-->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to indicate asset status">Asset Status</label></div>
                                <div class="col-7">
                                    <label for="range_frequency_1"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_frequency_1" name="range_frequency_1" onchange="initFrequencySlider('range_frequency_1', 'frequencyrange_1');">
                                </div>
                                <div class="col-3"><h6><label id="frequencyrange_1" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title" style="color: white">Physical Safeguards</h5>
                        <div id="tablePhysicalControls_1" class="mb-2">
                            <button id="addRowBtn" class="btn btn-primary btn-sm" type="button">Add Row</button>
                        </div>
                        <table class="table table-bordered small-font" id="table_safeguards_1">
                            <thead>
                                <tr>
                                    <th>Safeguard</th>
                                    <th>Safeguard Type</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be added here dynamically -->
                            </tbody>
                        </table>
                        <script>
                            $(document).ready(function() {
                                $("#addRowBtn").click(function() {
                                    var newRow = `<tr>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><button type="button" class="btn btn-danger btn-sm deleteRowBtn">Delete</button></td>
                                    </tr>`;
                                    $("#table_safeguards_1 tbody").append(newRow);
                                });

                                // Event delegation to handle dynamically added elements
                                $("#table_safeguards_1").on("click", ".deleteRowBtn", function() {
                                    $(this).closest("tr").remove();
                                });
                            });
                            </script>

                    </div>
                </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <button id="save_scenario_1" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(1);">
                            <i class="bi bi-play-fill mr-2"></i>Save Scenario 1
                            </button>
                        </div>
                    </div>


                </div>
            </div>

            </div>
        </div>
        <div class="tab-content" id="scenario2">
            <span id="facilityNameTable"></span> <h2>Scenario 2</h2>
            <div class="row">
            <div class="col-md-6 small-font">

                <input type="hidden" name="hdnScenarioID_2" id="hdnScenarioID_2">
                <br>
                <div class="group-container">
                    <div class="group-header">
                        <div class="row">
                            <div class="col-md-5"><span style="color: white;">Scenario Description</span></div>
                            <div class="col-md-1"></div>
                            <div class="col-md-5"><button type="button" class="btn btn-primary btn-file-dialog" data-bs-toggle="modal" data-bs-target="#scenarioSelectModal" id="btnSelectScenario_2">Load Scenario</button></div>
                            <div class="col-md-1"></div>
                        </div>
                        </div>
                    <div class="group-body">
                        <textarea class="form-control small-font" name="txtScenarioDescription_2" id="txtScenarioDescription_2" rows="5" style="resize: none; word-wrap: normal" placeholder="Enter a concise and descriptive scenario" onchange="setRiskAssessmentRefreshRequired(2)" onblur="analyze_Scenario(2)"></textarea>
                        <div class="spinner-container" style="position: relative;">
                            <div class="spinner-overlay_2" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.7); display: none; justify-content: center; align-items: center;">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only">Analyzing...</span>
                                </div>
                            </div>
                            <br>
                            <input class="form-check-input" type="checkbox" id="lock_scenario_2" onchange="toggleLockScenario2()">
                            <label class="form-check-label" for="lock_scenario_2">
                                Lock Scenario
                            </label>
                                <br>
                            <label for="txtScenarioAnalysis_2" class="small-font" style="visibility: hidden">Recommendations will align with selected standards:</label>
                            <textarea id="txtScenarioAnalysis_2" name="txtScenarioAnalysis_2" class="form-control small-font"  rows="5" style="resize: none; word-wrap: normal" readonly></textarea>

                            <script>
                            function toggleLockScenario2() {
                                var checkbox = document.getElementById('lock_scenario_2');
                                var textarea = document.getElementById('txtScenarioDescription_2');
                                textarea.readOnly = checkbox.checked; // Set textarea readonly based on checkbox
                            }
                            </script>
                        </div>
                    </div>
                </div>


            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Exposed IP Address
                                </div>
                                <div class="group-body">

                                    <label class="switch">
                                      <input type="checkbox" id="exposed_system_2" name="exposed_system_2">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Default/ Weak Credentials
                                </div>
                                <div class="group-body">
                                <label class="switch">
                          <input type="checkbox" id="weak_credentials_2" name="weak_credentials_2">
                          <span class="slider1 round"></span>
                        </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>
            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Production Outage
                                </div>
                                <div class="group-body">
                                <label class="switch">
                                      <input type="checkbox" id="production_outage_2" name="production_outage_2">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Outage Length (hours)
                                </div>
                                <div class="group-body">

                            <input type="number" id="outage_2" name="outage_2" min="0" max="100" class="form-control">
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Source

                </div>
                <div class="group-body">

                  <select id="selectThreat_2" name="selectThreat_2" class="form-control small-font">
                    <option value="">-- Select Threat Source --</option>
                    {% for threatsources in threatsources %}
                        <option value="{{ threatsources.ThreatSource}}">{{ threatsources.ThreatSource }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Tactic

                </div>
                <div class="group-body">
                    <select id="selectTactics_2" name="selectTactics_2" class="form-control small-font">
                    <option value="">-- Select Threat Tactics --</option>
                    {% for mitreTactics in mitreTactics %}
                        <option value="{{ mitreTactics.tactic}}">{{ mitreTactics.tactic }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>
            <div class="group-container">
                <div class="group-header">
                     Scenario Impact

                </div>
                <div class="group-body">
                     <select id="id_impact_2" name="impact" class="form-control small-font">
                        <option value="">-- Select Impact --</option>
                        {% for value, display in scenario_form.fields.impact.choices %}
                            <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>

                </div>
              </div>
                <div class="group-container">
                <div class="group-header">
                     Asset Detail

                </div>
                <div class="group-body">
                     <textarea class="form-control small-font" name="txtAssets_2" id="txtAssets_2" rows="3" style="resize: none; word-wrap: normal" placeholder="Add asset names relevant to the scenario..."></textarea>

                </div>
              </div>

                </div>
            <div class="col-md-6 small-font">
                <br>
                <div class="group-container">
                <h5 style="color: white">Business Impact Analysis</h5>
                <font style="color:white">Click the icons to add additional detail</font>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for safety rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#safetyModal_2" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/safety.png' %}" style="height:2rem"> &nbsp;Safety</label></div>
                                <div class="col-7">
                                    <label for="range_safety_2"></label>

                                    <input type="range" min="1" max="10" value="1" class="slider" id="range_safety_2" name="range_safety_2" onchange="initSlider('range_safety_2', 'safetyrange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><label id="safetyrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                              </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for life rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#lifeModal_2" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/danger.png' %}" style="height:2rem"> &nbsp;Life</label></div>
                                <div class="col-7">
                                    <label for="range_life_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_life_2" name="range_life_2" onchange="initSlider('range_life_2', 'liferange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><h6><label id="liferange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for production rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#productionModal_2" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/production.png' %}" style="height:2rem">&nbsp; Production</label></div>
                                <div class="col-7">
                                    <label for="range_production_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_production_2" name="range_production_2" onchange="initSlider('range_production_2', 'productionrange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><h6><label id="productionrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                             <!--slider for finance rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#financeModal_2"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/finance.png' %}" style="height:2rem">&nbsp; Financial</label></div>
                                <div class="col-7">
                                    <label for="range_finance_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_finance_2" name="range_finance_2" onchange="initSlider('range_finance_2', 'financerange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><h6><label id="financerange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for reputation rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#reputationModal_2"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/reputation.png' %}" style="height:2rem"> &nbsp;Reputation</label></div>
                                <div class="col-7">
                                    <label for="range_reputation_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_reputation_2" name="range_reputation_2" onchange="initSlider('range_reputation_2', 'reputationrange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><h6><label id="reputationrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for environment impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#environmentModal_2"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/environment.png' %}" style="height:2rem"> &nbsp;Environment</label></div>
                                <div class="col-7">
                                    <label for="range_environment_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_environment_2" name="range_environment_2" onchange="initSlider('range_environment_2', 'environmentrange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><h6><label id="environmentrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for regulatory impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#regulationModal_2"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/regulation.png' %}" style="height:2rem">&nbsp; Regulatory</label></div>
                                <div class="col-7">
                                    <label for="range_regulatory_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_regulatory_2" name="range_regulatory_2" onchange="initSlider('range_regulatory_2', 'regulatoryrange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><h6><label id="regulatoryrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#dataModal_2"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/data.png' %}" style="height:2rem"> &nbsp;Data/IP</label></div>
                                <div class="col-7">
                                    <label for="range_data_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_data_2" name="range_data_2" onchange="initSlider('range_data_2', 'datarange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><h6><label id="datarange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#supplyModal_2"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/supply.png' %}" style="height:2rem"> &nbsp;Supply Chain</label></div>
                                <div class="col-7">
                                    <label for="range_supply_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_supply_2" name="range_supply_2" onchange="initSlider('range_supply_2', 'supplyrange_2');setRiskAssessmentRefreshRequired(2);">
                                </div>
                                <div class="col-2"><h6><label id="supplyrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                </div>
                <h5 style="color: white">Vulnerability and Likelihood Analysis</h5>
                <div class="group-container">
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for vulnerability rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#vulnModal_2"  data-bs-placement="top" style="cursor: pointer">Vulnerability</label></div>
                                <div class="col-7">
                                    <label for="range_vuln_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_vuln_2" name="range_vuln_2" onchange="initSlider('range_vuln_2', 'vulnrange_2')">
                                </div>
                                <div class="col-3"><label id="vulnrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for threat rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to estimate the danger to life of the selected scenario">Threat</label></div>
                                <div class="col-7">
                                    <label for="range_threat_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_threat_2" name="range_threat_2" onchange="initSlider('range_threat_2', 'threatrange_2');">
                                </div>
                                <div class="col-3"><h6><label id="threatrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for frequency-->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to indicate asset status">Asset Status</label></div>
                                <div class="col-7">
                                    <label for="range_frequency_2"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_frequency_2" name="range_frequency_2" onchange="initFrequencySlider('range_frequency_2', 'frequencyrange_2');">
                                </div>
                                <div class="col-3"><h6><label id="frequencyrange_2" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title" style="color: white">Physical Safeguards</h5>
                        <div id="tablePhysicalControls_2" class="mb-2">
                            <button id="addRowBtn" class="btn btn-primary btn-sm" type="button">Add Row</button>
                        </div>
                        <table class="table table-bordered small-font" id="table_safeguards_2">
                            <thead>
                                <tr>
                                    <th>Safeguard</th>
                                    <th>Safeguard Type</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be added here dynamically -->
                            </tbody>
                        </table>
                        <script>
                            $(document).ready(function() {
                                $("#addRowBtn").click(function() {
                                    var newRow = `<tr>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><button type="button" class="btn btn-danger btn-sm deleteRowBtn">Delete</button></td>
                                    </tr>`;
                                    $("#table_safeguards_2 tbody").append(newRow);
                                });

                                // Event delegation to handle dynamically added elements
                                $("#table_safeguards_2").on("click", ".deleteRowBtn", function() {
                                    $(this).closest("tr").remove();
                                });
                            });
                            </script>

                    </div>
                </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <button id="save_scenario_2" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(2);">
                            <i class="bi bi-play-fill mr-2"></i>Save Scenario 2
                            </button>
                        </div>
                    </div>


                </div>
            </div>

            </div>
        </div>
        <div class="tab-content" id="scenario3">
            <h3 style="color:#fff">Scenario 3</h3>
            <div class="row">
            <div class="col-md-6 small-font">

                <input type="hidden" name="hdnScenarioID_3" id="hdnScenarioID_3">
                <br>
                <div class="group-container">
                    <div class="group-header">
                        <div class="row">
                            <div class="col-md-5"><span style="color: white;">Scenario Description</span></div>
                            <div class="col-md-1"></div>
                            <div class="col-md-5"><button type="button" class="btn btn-primary btn-file-dialog" data-bs-toggle="modal" data-bs-target="#scenarioSelectModal" id="btnSelectScenario_3">Load Scenario</button></div>
                            <div class="col-md-1"></div>
                        </div>
                        </div>
                    <div class="group-body">
                        <textarea class="form-control small-font" name="txtScenarioDescription_3" id="txtScenarioDescription_3" rows="5" style="resize: none; word-wrap: normal" placeholder="Enter a concise and descriptive scenario" onchange="setRiskAssessmentRefreshRequired(3)" onblur="analyze_Scenario(3)"></textarea>
                        <div class="spinner-container" style="position: relative;">
                            <div class="spinner-overlay_3" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.7); display: none; justify-content: center; align-items: center;">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only">Analyzing...</span>
                                </div>
                            </div>
                            <br>
                            <input class="form-check-input" type="checkbox" id="lock_scenario_3" onchange="toggleLockScenario3()">
                            <label class="form-check-label" for="lock_scenario_3">
                                Lock Scenario
                            </label>
                                <br>
                            <label for="txtScenarioAnalysis_3" class="small-font" style="visibility: hidden">Recommendations will align with selected standards:</label>
                            <textarea id="txtScenarioAnalysis_3" name="txtScenarioAnalysis_3" class="form-control small-font"  rows="5" style="resize: none; word-wrap: normal" readonly></textarea>

                            <script>
                            function toggleLockScenario3() {
                                var checkbox = document.getElementById('lock_scenario_3');
                                var textarea = document.getElementById('txtScenarioDescription_3');
                                textarea.readOnly = checkbox.checked; // Set textarea readonly based on checkbox
                            }
                            </script>
                        </div>
                    </div>
                </div>


            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Exposed IP Address
                                </div>
                                <div class="group-body">

                                    <label class="switch">
                                      <input type="checkbox" id="exposed_system_3" name="exposed_system_3">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Default/ Weak Credentials
                                </div>
                                <div class="group-body">
                                <label class="switch">
                          <input type="checkbox" id="weak_credentials_3" name="weak_credentials_3">
                          <span class="slider1 round"></span>
                        </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>
            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Production Outage
                                </div>
                                <div class="group-body">
                                <label class="switch">
                                      <input type="checkbox" id="production_outage_3" name="production_outage_3">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Outage Length (hours)
                                </div>
                                <div class="group-body">

                            <input type="number" id="outage_3" name="outage_3" min="0" max="100" class="form-control">
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Source

                </div>
                <div class="group-body">

                  <select id="selectThreat_3" name="selectThreat_3" class="form-control small-font">
                    <option value="">-- Select Threat Source --</option>
                    {% for threatsources in threatsources %}
                        <option value="{{ threatsources.ThreatSource}}">{{ threatsources.ThreatSource }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Tactic

                </div>
                <div class="group-body">
                    <select id="selectTactics_3" name="selectTactics_3" class="form-control small-font">
                    <option value="">-- Select Threat Tactics --</option>
                    {% for mitreTactics in mitreTactics %}
                        <option value="{{ mitreTactics.tactic}}">{{ mitreTactics.tactic }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>
            <div class="group-container">
                <div class="group-header">
                     Scenario Impact

                </div>
                <div class="group-body">
                     <select id="id_impact_3" name="impact" class="form-control small-font">
                        <option value="">-- Select Impact --</option>
                        {% for value, display in scenario_form.fields.impact.choices %}
                            <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>

                </div>
              </div>
                <div class="group-container">
                <div class="group-header">
                     Asset Detail

                </div>
                <div class="group-body">
                     <textarea class="form-control small-font" name="txtAssets_3" id="txtAssets_3" rows="3" style="resize: none; word-wrap: normal" placeholder="Add asset names relevant to the scenario..."></textarea>

                </div>
              </div>

                </div>
            <div class="col-md-6 small-font">
                <br>
                <div class="group-container">
                <h5 style="color: white">Business Impact Analysis</h5>
                <font style="color:white">Click the icons to add additional detail</font>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for safety rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#safetyModal_3" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/safety.png' %}" style="height:2rem"> &nbsp;Safety</label></div>
                                <div class="col-7">
                                    <label for="range_safety_3"></label>

                                    <input type="range" min="1" max="10" value="1" class="slider" id="range_safety_3" name="range_safety_3" onchange="initSlider('range_safety_3', 'safetyrange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><label id="safetyrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                              </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for life rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#lifeModal_3" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/danger.png' %}" style="height:2rem"> &nbsp;Life</label></div>
                                <div class="col-7">
                                    <label for="range_life_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_life_3" name="range_life_3" onchange="initSlider('range_life_3', 'liferange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><h6><label id="liferange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for production rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#productionModal_3" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/production.png' %}" style="height:2rem">&nbsp; Production</label></div>
                                <div class="col-7">
                                    <label for="range_production_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_production_3" name="range_production_3" onchange="initSlider('range_production_3', 'productionrange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><h6><label id="productionrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                             <!--slider for finance rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#financeModal_3"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/finance.png' %}" style="height:2rem">&nbsp; Financial</label></div>
                                <div class="col-7">
                                    <label for="range_finance_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_finance_3" name="range_finance_3" onchange="initSlider('range_finance_3', 'financerange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><h6><label id="financerange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for reputation rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#reputationModal_3"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/reputation.png' %}" style="height:2rem"> &nbsp;Reputation</label></div>
                                <div class="col-7">
                                    <label for="range_reputation_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_reputation_3" name="range_reputation_3" onchange="initSlider('range_reputation_3', 'reputationrange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><h6><label id="reputationrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for environment impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#environmentModal_3"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/environment.png' %}" style="height:2rem"> &nbsp;Environment</label></div>
                                <div class="col-7">
                                    <label for="range_environment_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_environment_3" name="range_environment_3" onchange="initSlider('range_environment_3', 'environmentrange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><h6><label id="environmentrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for regulatory impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#regulationModal_3"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/regulation.png' %}" style="height:2rem">&nbsp; Regulatory</label></div>
                                <div class="col-7">
                                    <label for="range_regulatory_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_regulatory_3" name="range_regulatory_3" onchange="initSlider('range_regulatory_3', 'regulatoryrange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><h6><label id="regulatoryrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#dataModal_3"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/data.png' %}" style="height:2rem"> &nbsp;Data/IP</label></div>
                                <div class="col-7">
                                    <label for="range_data_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_data_3" name="range_data_3" onchange="initSlider('range_data_3', 'datarange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><h6><label id="datarange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#supplyModal_3"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/supply.png' %}" style="height:2rem"> &nbsp;Supply Chain</label></div>
                                <div class="col-7">
                                    <label for="range_supply_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_supply_3" name="range_supply_3" onchange="initSlider('range_supply_3', 'supplyrange_3');setRiskAssessmentRefreshRequired(3);">
                                </div>
                                <div class="col-2"><h6><label id="supplyrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                </div>
                <h5 style="color: white">Vulnerability and Likelihood Analysis</h5>
                <div class="group-container">
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for vulnerability rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#vulnModal_3"  data-bs-placement="top" style="cursor: pointer">Vulnerability</label></div>
                                <div class="col-7">
                                    <label for="range_vuln_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_vuln_3" name="range_vuln_3" onchange="initSlider('range_vuln_3', 'vulnrange_3')">
                                </div>
                                <div class="col-3"><label id="vulnrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for threat rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to estimate the danger to life of the selected scenario">Threat</label></div>
                                <div class="col-7">
                                    <label for="range_threat_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_threat_3" name="range_threat_3" onchange="initSlider('range_threat_3', 'threatrange_3');">
                                </div>
                                <div class="col-3"><h6><label id="threatrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for frequency-->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to indicate asset status">Asset Status</label></div>
                                <div class="col-7">
                                    <label for="range_frequency_3"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_frequency_3" name="range_frequency_3" onchange="initFrequencySlider('range_frequency_3', 'frequencyrange_3');">
                                </div>
                                <div class="col-3"><h6><label id="frequencyrange_3" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title" style="color: white">Physical Safeguards</h5>
                        <div id="tablePhysicalControls_3" class="mb-2">
                            <button id="addRowBtn" class="btn btn-primary btn-sm" type="button">Add Row</button>
                        </div>
                        <table class="table table-bordered small-font" id="table_safeguards_3">
                            <thead>
                                <tr>
                                    <th>Safeguard</th>
                                    <th>Safeguard Type</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be added here dynamically -->
                            </tbody>
                        </table>
                        <script>
                            $(document).ready(function() {
                                $("#addRowBtn").click(function() {
                                    var newRow = `<tr>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><button type="button" class="btn btn-danger btn-sm deleteRowBtn">Delete</button></td>
                                    </tr>`;
                                    $("#table_safeguards_3 tbody").append(newRow);
                                });

                                // Event delegation to handle dynamically added elements
                                $("#table_safeguards_3").on("click", ".deleteRowBtn", function() {
                                    $(this).closest("tr").remove();
                                });
                            });
                            </script>

                    </div>
                </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <button id="save_scenario_3" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(3);">
                            <i class="bi bi-play-fill mr-2"></i>Save Scenario 3
                            </button>
                        </div>
                    </div>


                </div>
            </div>

            </div>
        </div>
        <div class="tab-content" id="scenario4">
            <h3 style="color:#fff">Scenario 4</h3>
            <div class="row">
            <div class="col-md-6 small-font">

                <input type="hidden" name="hdnScenarioID_4" id="hdnScenarioID_4">
                <br>
                <div class="group-container">
                    <div class="group-header">
                        <div class="row">
                            <div class="col-md-5"><span style="color: white;">Scenario Description</span></div>
                            <div class="col-md-1"></div>
                            <div class="col-md-5"><button type="button" class="btn btn-primary btn-file-dialog" data-bs-toggle="modal" data-bs-target="#scenarioSelectModal" id="btnSelectScenario_4">Load Scenario</button></div>
                            <div class="col-md-1"></div>
                        </div>
                        </div>
                    <div class="group-body">
                        <textarea class="form-control small-font" name="txtScenarioDescription_4" id="txtScenarioDescription_4" rows="5" style="resize: none; word-wrap: normal" placeholder="Enter a concise and descriptive scenario" onchange="setRiskAssessmentRefreshRequired(4)" onblur="analyze_Scenario(4)"></textarea>
                        <div class="spinner-container" style="position: relative;">
                            <div class="spinner-overlay_4" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.7); display: none; justify-content: center; align-items: center;">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only">Analyzing...</span>
                                </div>
                            </div>
                            <br>
                            <input class="form-check-input" type="checkbox" id="lock_scenario_4" onchange="toggleLockScenario4()">
                            <label class="form-check-label" for="lock_scenario_4">
                                Lock Scenario
                            </label>
                                <br>
                            <label for="txtScenarioAnalysis_4" class="small-font" style="visibility: hidden">Recommendations will align with selected standards:</label>
                            <textarea id="txtScenarioAnalysis_4" name="txtScenarioAnalysis_4" class="form-control small-font"  rows="5" style="resize: none; word-wrap: normal" readonly></textarea>

                            <script>
                            function toggleLockScenario4() {
                                var checkbox = document.getElementById('lock_scenario_4');
                                var textarea = document.getElementById('txtScenarioDescription_4');
                                textarea.readOnly = checkbox.checked; // Set textarea readonly based on checkbox
                            }
                            </script>
                        </div>
                    </div>
                </div>


            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Exposed IP Address
                                </div>
                                <div class="group-body">

                                    <label class="switch">
                                      <input type="checkbox" id="exposed_system_4" name="exposed_system_4">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Default/ Weak Credentials
                                </div>
                                <div class="group-body">
                                <label class="switch">
                          <input type="checkbox" id="weak_credentials_4" name="weak_credentials_4">
                          <span class="slider1 round"></span>
                        </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>
            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Production Outage
                                </div>
                                <div class="group-body">
                                <label class="switch">
                                      <input type="checkbox" id="production_outage_4" name="production_outage_4">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Outage Length (hours)
                                </div>
                                <div class="group-body">

                            <input type="number" id="outage_4" name="outage_4" min="0" max="100" class="form-control">
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Source

                </div>
                <div class="group-body">

                  <select id="selectThreat_4" name="selectThreat_4" class="form-control small-font">
                    <option value="">-- Select Threat Source --</option>
                    {% for threatsources in threatsources %}
                        <option value="{{ threatsources.ThreatSource}}">{{ threatsources.ThreatSource }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Tactic

                </div>
                <div class="group-body">
                    <select id="selectTactics_4" name="selectTactics_4" class="form-control small-font">
                    <option value="">-- Select Threat Tactics --</option>
                    {% for mitreTactics in mitreTactics %}
                        <option value="{{ mitreTactics.tactic}}">{{ mitreTactics.tactic }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>
            <div class="group-container">
                <div class="group-header">
                     Scenario Impact

                </div>
                <div class="group-body">
                     <select id="id_impact_4" name="impact" class="form-control small-font">
                        <option value="">-- Select Impact --</option>
                        {% for value, display in scenario_form.fields.impact.choices %}
                            <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>

                </div>
              </div>
                <div class="group-container">
                <div class="group-header">
                     Asset Detail

                </div>
                <div class="group-body">
                     <textarea class="form-control small-font" name="txtAssets_4" id="txtAssets_4" rows="3" style="resize: none; word-wrap: normal" placeholder="Add asset names relevant to the scenario..."></textarea>

                </div>
              </div>

                </div>
            <div class="col-md-6 small-font">
                <br>
                <div class="group-container">
                <h5 style="color: white">Business Impact Analysis</h5>
                <font style="color:white">Click the icons to add additional detail</font>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for safety rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#safetyModal_4" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/safety.png' %}" style="height:2rem"> &nbsp;Safety</label></div>
                                <div class="col-7">
                                    <label for="range_safety_4"></label>

                                    <input type="range" min="1" max="10" value="1" class="slider" id="range_safety_4" name="range_safety_4" onchange="initSlider('range_safety_4', 'safetyrange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><label id="safetyrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                              </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for life rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#lifeModal_4" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/danger.png' %}" style="height:2rem"> &nbsp;Life</label></div>
                                <div class="col-7">
                                    <label for="range_life_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_life_4" name="range_life_4" onchange="initSlider('range_life_4', 'liferange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><h6><label id="liferange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for production rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#productionModal_4" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/production.png' %}" style="height:2rem">&nbsp; Production</label></div>
                                <div class="col-7">
                                    <label for="range_production_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_production_4" name="range_production_4" onchange="initSlider('range_production_4', 'productionrange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><h6><label id="productionrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                             <!--slider for finance rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#financeModal_4"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/finance.png' %}" style="height:2rem">&nbsp; Financial</label></div>
                                <div class="col-7">
                                    <label for="range_finance_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_finance_4" name="range_finance_4" onchange="initSlider('range_finance_4', 'financerange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><h6><label id="financerange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for reputation rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#reputationModal_4"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/reputation.png' %}" style="height:2rem"> &nbsp;Reputation</label></div>
                                <div class="col-7">
                                    <label for="range_reputation_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_reputation_4" name="range_reputation_4" onchange="initSlider('range_reputation_4', 'reputationrange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><h6><label id="reputationrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for environment impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#environmentModal_4"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/environment.png' %}" style="height:2rem"> &nbsp;Environment</label></div>
                                <div class="col-7">
                                    <label for="range_environment_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_environment_4" name="range_environment_4" onchange="initSlider('range_environment_4', 'environmentrange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><h6><label id="environmentrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for regulatory impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#regulationModal_4"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/regulation.png' %}" style="height:2rem">&nbsp; Regulatory</label></div>
                                <div class="col-7">
                                    <label for="range_regulatory_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_regulatory_4" name="range_regulatory_4" onchange="initSlider('range_regulatory_4', 'regulatoryrange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><h6><label id="regulatoryrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#dataModal_4"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/data.png' %}" style="height:2rem"> &nbsp;Data/IP</label></div>
                                <div class="col-7">
                                    <label for="range_data_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_data_4" name="range_data_4" onchange="initSlider('range_data_4', 'datarange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><h6><label id="datarange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#supplyModal_4"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/supply.png' %}" style="height:2rem"> &nbsp;Supply Chain</label></div>
                                <div class="col-7">
                                    <label for="range_supply_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_supply_4" name="range_supply_4" onchange="initSlider('range_supply_4', 'supplyrange_4');setRiskAssessmentRefreshRequired(4);">
                                </div>
                                <div class="col-2"><h6><label id="supplyrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                </div>
                <h5 style="color: white">Vulnerability and Likelihood Analysis</h5>
                <div class="group-container">
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for vulnerability rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#vulnModal_4"  data-bs-placement="top" style="cursor: pointer">Vulnerability</label></div>
                                <div class="col-7">
                                    <label for="range_vuln_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_vuln_4" name="range_vuln_4" onchange="initSlider('range_vuln_4', 'vulnrange_4')">
                                </div>
                                <div class="col-3"><label id="vulnrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for threat rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to estimate the danger to life of the selected scenario">Threat</label></div>
                                <div class="col-7">
                                    <label for="range_threat_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_threat_4" name="range_threat_4" onchange="initSlider('range_threat_4', 'threatrange_4');">
                                </div>
                                <div class="col-3"><h6><label id="threatrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for frequency-->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to indicate asset status">Asset Status</label></div>
                                <div class="col-7">
                                    <label for="range_frequency_4"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_frequency_4" name="range_frequency_4" onchange="initFrequencySlider('range_frequency_4', 'frequencyrange_4');">
                                </div>
                                <div class="col-3"><h6><label id="frequencyrange_4" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title" style="color: white">Physical Safeguards</h5>
                        <div id="tablePhysicalControls_4" class="mb-2">
                            <button id="addRowBtn" class="btn btn-primary btn-sm" type="button">Add Row</button>
                        </div>
                        <table class="table table-bordered small-font" id="table_safeguards_4">
                            <thead>
                                <tr>
                                    <th>Safeguard</th>
                                    <th>Safeguard Type</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be added here dynamically -->
                            </tbody>
                        </table>
                        <script>
                            $(document).ready(function() {
                                $("#addRowBtn").click(function() {
                                    var newRow = `<tr>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><button type="button" class="btn btn-danger btn-sm deleteRowBtn">Delete</button></td>
                                    </tr>`;
                                    $("#table_safeguards_4 tbody").append(newRow);
                                });

                                // Event delegation to handle dynamically added elements
                                $("#table_safeguards_4").on("click", ".deleteRowBtn", function() {
                                    $(this).closest("tr").remove();
                                });
                            });
                            </script>

                    </div>
                </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <button id="save_scenario_4" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(4);">
                            <i class="bi bi-play-fill mr-2"></i>Save Scenario 4
                            </button>
                        </div>
                    </div>


                </div>
            </div>

            </div>
        </div>
        <div class="tab-content" id="scenario5">
            <h3 style="color:#fff">Scenario 5</h3>
            <div class="row">
            <div class="col-md-6 small-font">

                <input type="hidden" name="hdnScenarioID_5" id="hdnScenarioID_5">
                <br>
                <div class="group-container">
                    <div class="group-header">
                        <div class="row">
                            <div class="col-md-5"><span style="color: white;">Scenario Description</span></div>
                            <div class="col-md-1"></div>
                            <div class="col-md-5"><button type="button" class="btn btn-primary btn-file-dialog" data-bs-toggle="modal" data-bs-target="#scenarioSelectModal" id="btnSelectScenario_5">Load Scenario</button></div>
                            <div class="col-md-1"></div>
                        </div>
                        </div>
                    <div class="group-body">
                        <textarea class="form-control small-font" name="txtScenarioDescription_5" id="txtScenarioDescription_5" rows="5" style="resize: none; word-wrap: normal" placeholder="Enter a concise and descriptive scenario" onchange="setRiskAssessmentRefreshRequired(5)" onblur="analyze_Scenario(5)"></textarea>
                        <div class="spinner-container" style="position: relative;">
                            <div class="spinner-overlay_5" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.7); display: none; justify-content: center; align-items: center;">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only">Analyzing...</span>
                                </div>
                            </div>
                            <br>
                            <input class="form-check-input" type="checkbox" id="lock_scenario_5" onchange="toggleLockScenario_5()">
                            <label class="form-check-label" for="lock_scenario_5">
                                Lock Scenario
                            </label>
                                <br>
                            <label for="txtScenarioAnalysis_5" class="small-font" style="visibility: hidden">Recommendations will align with selected standards:</label>
                            <textarea id="txtScenarioAnalysis_5" name="txtScenarioAnalysis_5" class="form-control small-font"  rows="5" style="resize: none; word-wrap: normal" readonly></textarea>

                            <script>
                            function toggleLockScenario_5() {
                                var checkbox = document.getElementById('lock_scenario_5');
                                var textarea = document.getElementById('txtScenarioDescription_5');
                                textarea.readOnly = checkbox.checked; // Set textarea readonly based on checkbox
                            }
                            </script>
                        </div>
                    </div>
                </div>


            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Exposed IP Address
                                </div>
                                <div class="group-body">

                                    <label class="switch">
                                      <input type="checkbox" id="exposed_system_5" name="exposed_system_5">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Default/ Weak Credentials
                                </div>
                                <div class="group-body">
                                <label class="switch">
                          <input type="checkbox" id="weak_credentials_5" name="weak_credentials_5">
                          <span class="slider1 round"></span>
                        </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>
            <br>
            <div class="row">
                    <div class="col-md-1"></div>
                        <div class="col-md-5">
                            <div class="group-container">
                                <div class="group-header">
                                    Production Outage
                                </div>
                                <div class="group-body">
                                <label class="switch">
                                      <input type="checkbox" id="production_outage_5" name="production_outage_5">
                                      <span class="slider1 round"></span>
                                    </label>
                                </div>
                            </div>

                </div>
                <div class="col-md-5">
                    <div class="group-container">
                                <div class="group-header">
                                    Outage Length (hours)
                                </div>
                                <div class="group-body">

                            <input type="number" id="outage_5" name="outage_5" min="0" max="100" class="form-control">
                                </div>
                            </div>

                </div>
                <div class="col-md-1"></div>
            </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Source

                </div>
                <div class="group-body">

                  <select id="selectThreat_5" name="selectThreat_5" class="form-control small-font">
                    <option value="">-- Select Threat Source --</option>
                    {% for threatsources in threatsources %}
                        <option value="{{ threatsources.ThreatSource}}">{{ threatsources.ThreatSource }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>

            <div class="group-container">
                <div class="group-header">
                     Threat Tactic

                </div>
                <div class="group-body">
                    <select id="selectTactics_5" name="selectTactics_5" class="form-control small-font">
                    <option value="">-- Select Threat Tactics --</option>
                    {% for mitreTactics in mitreTactics %}
                        <option value="{{ mitreTactics.tactic}}">{{ mitreTactics.tactic }}</option>
                    {% endfor %}
                  </select>

                </div>
              </div>
            <div class="group-container">
                <div class="group-header">
                     Scenario Impact

                </div>
                <div class="group-body">
                     <select id="id_impact_5" name="impact" class="form-control small-font">
                        <option value="">-- Select Impact --</option>
                        {% for value, display in scenario_form.fields.impact.choices %}
                            <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>

                </div>
              </div>
                <div class="group-container">
                <div class="group-header">
                     Asset Detail

                </div>
                <div class="group-body">
                     <textarea class="form-control small-font" name="txtAssets_5" id="txtAssets_5" rows="3" style="resize: none; word-wrap: normal" placeholder="Add asset names relevant to the scenario..."></textarea>

                </div>
              </div>

                </div>
            <div class="col-md-6 small-font">
                <br>
                <div class="group-container">
                <h5 style="color: white">Business Impact Analysis</h5>
                <font style="color:white">Click the icons to add additional detail</font>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for safety rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#safetyModal_5" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/safety.png' %}" style="height:2rem"> &nbsp;Safety</label></div>
                                <div class="col-7">
                                    <label for="range_safety_5"></label>

                                    <input type="range" min="1" max="10" value="1" class="slider" id="range_safety_5" name="range_safety_5" onchange="initSlider('range_safety_5', 'safetyrange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><label id="safetyrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                              </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for life rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#lifeModal_5" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/danger.png' %}" style="height:2rem"> &nbsp;Life</label></div>
                                <div class="col-7">
                                    <label for="range_life_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_life_5" name="range_life_5" onchange="initSlider('range_life_5', 'liferange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><h6><label id="liferange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for production rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#productionModal_5" data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/production.png' %}" style="height:2rem">&nbsp; Production</label></div>
                                <div class="col-7">
                                    <label for="range_production_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_production_5" name="range_production_5" onchange="initSlider('range_production_5', 'productionrange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><h6><label id="productionrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                             <!--slider for finance rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#financeModal_5"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/finance.png' %}" style="height:2rem">&nbsp; Financial</label></div>
                                <div class="col-7">
                                    <label for="range_finance_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_finance_5" name="range_finance_5" onchange="initSlider('range_finance_5', 'financerange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><h6><label id="financerange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for reputation rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#reputationModal_5"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/reputation.png' %}" style="height:2rem"> &nbsp;Reputation</label></div>
                                <div class="col-7">
                                    <label for="range_reputation_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_reputation_5" name="range_reputation_5" onchange="initSlider('range_reputation_5', 'reputationrange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><h6><label id="reputationrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for environment impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#environmentModal_5"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/environment.png' %}" style="height:2rem"> &nbsp;Environment</label></div>
                                <div class="col-7">
                                    <label for="range_environment_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_environment_5" name="range_environment_5" onchange="initSlider('range_environment_5', 'environmentrange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><h6><label id="environmentrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for regulatory impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#regulationModal_5"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/regulation.png' %}" style="height:2rem">&nbsp; Regulatory</label></div>
                                <div class="col-7">
                                    <label for="range_regulatory_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_regulatory_5" name="range_regulatory_5" onchange="initSlider('range_regulatory_5', 'regulatoryrange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><h6><label id="regulatoryrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#dataModal_5"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/data.png' %}" style="height:2rem"> &nbsp;Data/IP</label></div>
                                <div class="col-7">
                                    <label for="range_data_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_data_5" name="range_data_5" onchange="initSlider('range_data_5', 'datarange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><h6><label id="datarange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for data impact rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-3"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#supplyModal_5"  data-bs-placement="top" style="cursor: pointer"><img src="{% static 'images/supply.png' %}" style="height:2rem"> &nbsp;Supply Chain</label></div>
                                <div class="col-7">
                                    <label for="range_supply_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_supply_5" name="range_supply_5" onchange="initSlider('range_supply_5', 'supplyrange_5');setRiskAssessmentRefreshRequired(5);">
                                </div>
                                <div class="col-2"><h6><label id="supplyrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                </div>
                <h5 style="color: white">Vulnerability and Likelihood Analysis</h5>
                <div class="group-container">
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for vulnerability rating -->
                            <div class="slider-container d-flex align-items-center" >
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="modal" data-bs-target="#vulnModal_5"  data-bs-placement="top" style="cursor: pointer">Vulnerability</label></div>
                                <div class="col-7">
                                    <label for="range_vuln_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_vuln_5" name="range_vuln_5" onchange="initSlider('range_vuln_5', 'vulnrange_5')">
                                </div>
                                <div class="col-3"><label id="vulnrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for threat rating -->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to estimate the danger to life of the selected scenario">Threat</label></div>
                                <div class="col-7">
                                    <label for="range_threat_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_threat_5" name="range_threat_5" onchange="initSlider('range_threat_5', 'threatrange_5');">
                                </div>
                                <div class="col-3"><h6><label id="threatrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <!--slider for frequency-->
                            <div class="slider-container d-flex align-items-center">
                                <div class="col-2"><label class="small-font d-flex align-items-center " data-bs-toggle="tooltip" data-bs-placement="top" title="Use the slider to indicate asset status">Asset Status</label></div>
                                <div class="col-7">
                                    <label for="range_frequency_5"></label><input type="range" min="1" max="10" value="1" class="slider" id="range_frequency_5" name="range_frequency_5" onchange="initFrequencySlider('range_frequency_5', 'frequencyrange_5');">
                                </div>
                                <div class="col-3"><h6><label id="frequencyrange_5" class="form-label text-center d-flex align-items-center justify-content-center small-font "></label></h6></div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title" style="color: white">Physical Safeguards</h5>
                        <div id="tablePhysicalControls_5" class="mb-2">
                            <button id="addRowBtn" class="btn btn-primary btn-sm" type="button">Add Row</button>
                        </div>
                        <table class="table table-bordered small-font" id="table_safeguards_5">
                            <thead>
                                <tr>
                                    <th>Safeguard</th>
                                    <th>Safeguard Type</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be added here dynamically -->
                            </tbody>
                        </table>
                        <script>
                            $(document).ready(function() {
                                $("#addRowBtn").click(function() {
                                    var newRow = `<tr>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><textarea class="form-control" maxlength="100"></textarea></td>
                                        <td><button type="button" class="btn btn-danger btn-sm deleteRowBtn">Delete</button></td>
                                    </tr>`;
                                    $("#table_safeguards_5 tbody").append(newRow);
                                });

                                // Event delegation to handle dynamically added elements
                                $("#table_safeguards_5").on("click", ".deleteRowBtn", function() {
                                    $(this).closest("tr").remove();
                                });
                            });
                            </script>

                    </div>
                </div>

                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body card-body-white">
                            <button id="save_scenario_5" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(5);">
                            <i class="bi bi-play-fill mr-2"></i>Save Scenario 5
                            </button>
                        </div>
                    </div>


                </div>
            </div>

            </div>
        </div>
        <div class="tab-content" id="tab8">
            <span id="facilityNameTable"></span> <h2>Actions</h2>
            <label for="accountable" class="form-label" style="color: white">Actions for this Risk Assessment</label>
        <table id="actiontable" class="table table-striped table-bordered small-font" style="background-color: white">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Owner</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be populated by the JavaScript function -->
            </tbody>
        </table>
        </div>
     <div class="tab-content" id="tab9">
         <h4 style="color: #fff">Scenario 1 Outcomes</h4>
         <div class="col small-font">
                <br>
                <button id="risk-assessment-btn_1" type="button" class="btn btn-primary" style="background-color: #e24e42"   onclick="checkEditModeAndExecute(this.id, 'loadingSpinner1')">
                    <i class="bi bi-play-fill mr-2"></i>Execute Risk Assessment
                </button>
                <br>
                <!-- Add this HTML element where you want to display the loading spinner -->
                <div id="loadingSpinner1" class="spinner-border" role="status" style="display: none;">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Risk Rating
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblriskRating_1" name="lblriskRating_1" style="color:white"></label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Residual Risk
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblinherentRisk_1" name="lblinherentRisk_1" style="color:white"></label>
                                    <input type="hidden" id="txtResidualRisk_1">
                                </div>

                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Executive Summary
                            </div>
                                <div class="group-body">
                            <textarea rows="10"  id="txtexec_summary_1" name="txtexec_summary_1" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                            <a href="#" id="copyExecSummaryLink" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Exec Summary
                            </a>
                            </div>
                            <script>
                                document.getElementById('copyExecSummaryLink').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var execSummaryText = document.getElementById('txtexec_summary_1').value;
                                    navigator.clipboard.writeText(execSummaryText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Executive summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>

                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Damage Estimate
                            </div>
                                <div class="group-body">

                                    <textarea rows="10"  id="txtDamage_1" name="txtDamage_1" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                                    <a href="#" id="copyDamageLink" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Damage Estimate
                            </a>
                                    <script>
                                document.getElementById('copyDamageLink').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var damageText = document.getElementById('txtDamage_1').value;
                                    navigator.clipboard.writeText(damageText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Damage summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col">
                        <div class="group-container">
                            <div class="group-header">
                                 Event Costs
                            </div>
                                <div class="group-body">
                                    <div id="monthly_cost_chart_1" style="height:300px"></div>
                                    <input type="hidden" id="scenario_12month_costs_1" name="scenario_12month_costs_1">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                    <button id="save_scenario_1" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(1);">
                    <i class="bi bi-play-fill mr-2"></i>Save Scenario 1
                    </button>
                <br>


                </div>
     </div>
     <div class="tab-content" id="tab10">
         <h4 style="color:#fff">Scenario 2 Outcomes</h4>
         <div class="col small-font">
                <br>
                <button id="risk-assessment-btn_2" type="button" class="btn btn-primary" style="background-color: #e24e42"   onclick="checkEditModeAndExecute(this.id, 'loadingSpinner2')">
                    <i class="bi bi-play-fill mr-2"></i>Execute Risk Assessment
                </button>
                <br>
                <!-- Add this HTML element where you want to display the loading spinner -->
                <div id="loadingSpinner2" class="spinner-border" role="status" style="display: none;">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Risk Rating
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblriskRating_2" name="lblriskRating_2" style="color:white"></label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Residual Risk
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblinherentRisk_2" name="lblinherentRisk_2" style="color:white"></label>
                                    <input type="hidden" id="txtResidualRisk_2">
                                </div>

                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Executive Summary
                            </div>
                                <div class="group-body">
                            <textarea rows="10"  id="txtexec_summary_2" name="txtexec_summary_2" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                            <a href="#" id="copyExecSummaryLink_2" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Exec Summary
                            </a>
                            </div>
                            <script>
                                document.getElementById('copyExecSummaryLink_2').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var execSummaryText = document.getElementById('txtexec_summary_2').value;
                                    navigator.clipboard.writeText(execSummaryText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Executive summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>

                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Damage Estimate
                            </div>
                                <div class="group-body">

                                    <textarea rows="10"  id="txtDamage_2" name="txtDamage_2" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                                    <a href="#" id="copyDamageLink_2" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Damage Estimate
                            </a>
                                    <script>
                                document.getElementById('copyDamageLink_2').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var damageText = document.getElementById('txtDamage_2').value;
                                    navigator.clipboard.writeText(damageText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Damage summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col">
                        <div class="group-container">
                            <div class="group-header">
                                 Event Costs
                            </div>
                                <div class="group-body">
                                    <div id="monthly_cost_chart_2" style="height:300px"></div>
                                    <input type="hidden" id="scenario_12month_costs_2" name="scenario_12month_costs_2">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                    <button id="save_scenario_2" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(2);">
                    <i class="bi bi-play-fill mr-2"></i>Save Scenario 2
                    </button>
                <br>


                </div>
     </div>
     <div class="tab-content" id="tab11">
         <h4 style="color:#fff">Scenario 3 Outcomes</h4>
         <div class="col small-font">
                <br>
                <button id="risk-assessment-btn_3" type="button" class="btn btn-primary" style="background-color: #e24e42"   onclick="checkEditModeAndExecute(this.id, 'loadingSpinner3')">
                    <i class="bi bi-play-fill mr-2"></i>Execute Risk Assessment
                </button>
                <br>
                <!-- Add this HTML element where you want to display the loading spinner -->
                <div id="loadingSpinner3" class="spinner-border" role="status" style="display: none;">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Risk Rating
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblriskRating_3" name="lblriskRating_3" style="color:white"></label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Residual Risk
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblinherentRisk_3" name="lblinherentRisk_3" style="color:white"></label>
                                    <input type="hidden" id="txtResidualRisk_3">
                                </div>

                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Executive Summary
                            </div>
                                <div class="group-body">
                            <textarea rows="10"  id="txtexec_summary_3" name="txtexec_summary_3" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                            <a href="#" id="copyExecSummaryLink_3" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Exec Summary
                            </a>
                            </div>
                            <script>
                                document.getElementById('copyExecSummaryLink_3').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var execSummaryText = document.getElementById('txtexec_summary_3').value;
                                    navigator.clipboard.writeText(execSummaryText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Executive summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>

                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Damage Estimate
                            </div>
                                <div class="group-body">

                                    <textarea rows="10"  id="txtDamage_3" name="txtDamage_3" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                                    <a href="#" id="copyDamageLink_3" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Damage Estimate
                            </a>
                                    <script>
                                document.getElementById('copyDamageLink_3').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var damageText = document.getElementById('txtDamage_3').value;
                                    navigator.clipboard.writeText(damageText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Damage summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col">
                        <div class="group-container">
                            <div class="group-header">
                                 Event Costs
                            </div>
                                <div class="group-body">
                                    <div id="monthly_cost_chart_3" style="height:300px"></div>
                                    <input type="hidden" id="scenario_12month_costs_3" name="scenario_12month_costs_3">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                    <button id="save_scenario_3" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(3);">
                    <i class="bi bi-play-fill mr-2"></i>Save Scenario 3
                    </button>
                <br>


                </div>
     </div>
     <div class="tab-content" id="tab12">
         <h4 style="color:#fff">Scenario 4 Outcomes</h4>
         <div class="col small-font">
                <br>
                <button id="risk-assessment-btn_4" type="button" class="btn btn-primary" style="background-color: #e24e42"   onclick="checkEditModeAndExecute(this.id, 'loadingSpinner4')">
                    <i class="bi bi-play-fill mr-2"></i>Execute Risk Assessment
                </button>
                <br>
                <!-- Add this HTML element where you want to display the loading spinner -->
                <div id="loadingSpinner4" class="spinner-border" role="status" style="display: none;">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Risk Rating
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblriskRating_4" name="lblriskRating_4" style="color:white"></label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Residual Risk
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblinherentRisk_4" name="lblinherentRisk_4" style="color:white"></label>
                                    <input type="hidden" id="txtResidualRisk_4">
                                </div>

                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Executive Summary
                            </div>
                                <div class="group-body">
                            <textarea rows="10"  id="txtexec_summary_4" name="txtexec_summary_4" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                            <a href="#" id="copyExecSummaryLink_4" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Exec Summary
                            </a>
                            </div>
                            <script>
                                document.getElementById('copyExecSummaryLink_4').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var execSummaryText = document.getElementById('txtexec_summary_4').value;
                                    navigator.clipboard.writeText(execSummaryText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Executive summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>

                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Damage Estimate
                            </div>
                                <div class="group-body">

                                    <textarea rows="10"  id="txtDamage_4" name="txtDamage_4" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                                    <a href="#" id="copyDamageLink_4" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Damage Estimate
                            </a>
                                    <script>
                                document.getElementById('copyDamageLink_4').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var damageText = document.getElementById('txtDamage_1').value;
                                    navigator.clipboard.writeText(damageText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Damage summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col">
                        <div class="group-container">
                            <div class="group-header">
                                 Event Costs
                            </div>
                                <div class="group-body">
                                    <div id="monthly_cost_chart_4" style="height:300px"></div>
                                    <input type="hidden" id="scenario_12month_costs_4" name="scenario_12month_costs_4">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                    <button id="save_scenario_1" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(4);">
                    <i class="bi bi-play-fill mr-2"></i>Save Scenario 4
                    </button>
                <br>


                </div>
     </div>
     <div class="tab-content" id="tab13">
         <h4 style="color:#fff">Scenario 5 Outcomes</h4>
         <div class="col small-font">
                <br>
                <button id="risk-assessment-btn_5" type="button" class="btn btn-primary" style="background-color: #e24e42"   onclick="checkEditModeAndExecute(this.id, 'loadingSpinner5')">
                    <i class="bi bi-play-fill mr-2"></i>Execute Risk Assessment
                </button>
                <br>
                <!-- Add this HTML element where you want to display the loading spinner -->
                <div id="loadingSpinner5" class="spinner-border" role="status" style="display: none;">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Risk Rating
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblriskRating_5" name="lblriskRating_5" style="color:white"></label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Residual Risk
                            </div>
                                <div class="group-body">
                                    <img src="{% static 'images/redcube.png' %}" class="cube-icon" alt="Red Cube"><label id="lblinherentRisk_5" name="lblinherentRisk_5" style="color:white"></label>
                                    <input type="hidden" id="txtResidualRisk_5">
                                </div>

                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Executive Summary
                            </div>
                                <div class="group-body">
                            <textarea rows="10"  id="txtexec_summary_5" name="txtexec_summary_5" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                            <a href="#" id="copyExecSummaryLink_5" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Exec Summary
                            </a>
                            </div>
                            <script>
                                document.getElementById('copyExecSummaryLink_5').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var execSummaryText = document.getElementById('txtexec_summary_5').value;
                                    navigator.clipboard.writeText(execSummaryText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Executive summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>

                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="group-container">
                            <div class="group-header">
                                 Damage Estimate
                            </div>
                                <div class="group-body">

                                    <textarea rows="10"  id="txtDamage_5" name="txtDamage_5" class="form-control custom-textarea" style="font-size: 14px; color: #0a53be; resize: none" readonly></textarea>
                                    <a href="#" id="copyDamageLink_5" class="copy-code-link">
                                <i class="bi bi-clipboard"></i> Copy Damage Estimate
                            </a>
                                    <script>
                                document.getElementById('copyDamageLink_5').addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent the default anchor action
                                    var damageText = document.getElementById('txtDamage_5').value;
                                    navigator.clipboard.writeText(damageText).then(function() {
                                        /* Success action, e.g., showing a tooltip or alert */
                                        console.log('Damage summary copied to clipboard.');
                                    }, function(err) {
                                        /* Handle error */
                                        console.error('Could not copy text: ', err);
                                    });
                                });
                                </script>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col">
                        <div class="group-container">
                            <div class="group-header">
                                 Event Costs
                            </div>
                                <div class="group-body">
                                    <div id="monthly_cost_chart_5" style="height:300px"></div>
                                    <input type="hidden" id="scenario_12month_costs_5" name="scenario_12month_costs_5">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>

                    <button id="save_scenario_5" type="button" class="btn btn-primary" style="background-color: #e24e42" onclick="save_scenario(5);">
                    <i class="bi bi-play-fill mr-2"></i>Save Scenario 5
                    </button>
                <br>


                </div>
     </div>
     </div>
    </div>
</div>
</div>
</form>

<br>
<div class="row" id="attacktreerow" style="visibility:hidden">

                <div class="col">
                    <div class="form-group-attack-tree ">
                        <div id="attack_tree"></div>
                    </div>
                </div>

            </div>
<input type="hidden" id="hdnattacktree" name="hdnattacktree">
<!-- safety ratings -->
<div class="modal fade" id="safetyModal_1" tabindex="-1" aria-labelledby="safetyModal_1_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="safetyModal_1_Label">Justification for Scenario 1 Safety Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <!-- Drop-down select control for the nature of the safety hazard -->
        <label for="hazardNature_1">Nature of Safety Hazard:</label>
        <select id="hazardNature_1" name="hazardNature_1" class="form-control mb-3">
            <option value="">-- Select Hazard --</option>
          <option value="Chemical">Chemical</option>
          <option value="Electrical">Electrical</option>
          <option value="Mechanical">Mechanical</option>
          <option value="Radiation">Radiation</option>
        </select>

        <!-- Yes/no option for SIS Outage -->
        <!-- Yes/no option for SIS Outage -->
        <div class="mb-3">
          <label>SIS Outage:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_1" id="sisOutageYes_1" value="yes">
            <label class="form-check-label" for="sisOutageYes_1">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_1" id="sisOutageNo_1" value="no" checked>
            <label class="form-check-label" for="sisOutageNo_1">No</label>
          </div>
        </div>


        <!-- Yes/no option for SIS Integrity Compromise -->
        <div class="mb-3">
          <label>SIS Integrity Compromise:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_1" id="sisIntegrityYes_1" value="yes">
            <label class="form-check-label" for="sisIntegrityYes_1">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_1" id="sisIntegrityNo_1" value="no" checked>
            <label class="form-check-label" for="sisIntegrityNo_1">No</label>
          </div>
        </div>


        <!-- Textarea for justification -->
        <label for="txtsafetyJustify_1">Justification:</label>
        <textarea id="txtsafetyJustify_1" name="txtsafetyJustify_1" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="safetyModal_2" tabindex="-1" aria-labelledby="safetyModal_2_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="safetyModal_2_Label">Justification for Scenario 2 Safety Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <!-- Drop-down select control for the nature of the safety hazard -->
        <label for="hazardNature_2">Nature of Safety Hazard:</label>
        <select id="hazardNature_2" name="hazardNature_2" class="form-control mb-3">
            <option value="">-- Select Hazard --</option>
          <option value="Chemical">Chemical</option>
          <option value="Electrical">Electrical</option>
          <option value="Mechanical">Mechanical</option>
          <option value="Radiation">Radiation</option>
        </select>

        <!-- Yes/no option for SIS Outage -->
        <div class="mb-3">
          <label>SIS Outage:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_2" id="sisOutageYes_2" value="yes">
            <label class="form-check-label" for="sisOutageYes_2">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_2" id="sisOutageNo_2" value="no">
            <label class="form-check-label" for="sisOutageNo_2">No</label>
          </div>
        </div>

        <!-- Yes/no option for SIS Integrity Compromise -->
        <div class="mb-3">
          <label>SIS Integrity Compromise:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_2" id="sisIntegrityYes_2" value="yes">
            <label class="form-check-label" for="sisIntegrityYes">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_2" id="sisIntegrityNo_2" value="no">
            <label class="form-check-label" for="sisIntegrityNo_2">No</label>
          </div>
        </div>

        <!-- Textarea for justification -->
        <label for="txtsafetyJustify_2">Justification:</label>
        <textarea id="txtsafetyJustify_2" name="txtsafetyJustify_2" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="safetyModal_3" tabindex="-1" aria-labelledby="safetyModal_3_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="safetyModal_3_Label">Justification for Scenario 3 Safety Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <!-- Drop-down select control for the nature of the safety hazard -->
        <label for="hazardNature_3">Nature of Safety Hazard:</label>
        <select id="hazardNature_3" name="hazardNature_3" class="form-control mb-3">
            <option value="">-- Select Hazard --</option>
          <option value="Chemical">Chemical</option>
          <option value="Electrical">Electrical</option>
          <option value="Mechanical">Mechanical</option>
          <option value="Radiation">Radiation</option>
        </select>

        <!-- Yes/no option for SIS Outage -->
        <div class="mb-3">
          <label>SIS Outage:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_3" id="sisOutageYes_3" value="yes">
            <label class="form-check-label" for="sisOutageYes_3">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_3" id="sisOutageNo_3" value="no">
            <label class="form-check-label" for="sisOutageNo_3">No</label>
          </div>
        </div>

        <!-- Yes/no option for SIS Integrity Compromise -->
        <div class="mb-3">
          <label>SIS Integrity Compromise:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_3" id="sisIntegrityYes_3" value="yes">
            <label class="form-check-label" for="sisIntegrityYes">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_1" id="sisIntegrityNo_3" value="no">
            <label class="form-check-label" for="sisIntegrityNo_1">No</label>
          </div>
        </div>

        <!-- Textarea for justification -->
        <label for="txtsafetyJustify_3">Justification:</label>
        <textarea id="txtsafetyJustify_3" name="txtsafetyJustify_3" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="safetyModal_4" tabindex="-1" aria-labelledby="safetyModal_4_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="safetyModal_4_Label">Justification for Scenario 4 Safety Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <!-- Drop-down select control for the nature of the safety hazard -->
        <label for="hazardNature_4">Nature of Safety Hazard:</label>
        <select id="hazardNature_4" name="hazardNature_4" class="form-control mb-3">
            <option value="">-- Select Hazard --</option>
          <option value="Chemical">Chemical</option>
          <option value="Electrical">Electrical</option>
          <option value="Mechanical">Mechanical</option>
          <option value="Radiation">Radiation</option>
        </select>

        <!-- Yes/no option for SIS Outage -->
        <div class="mb-3">
          <label>SIS Outage:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_4" id="sisOutageYes_4" value="yes">
            <label class="form-check-label" for="sisOutageYes_4">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_4" id="sisOutageNo_4" value="no">
            <label class="form-check-label" for="sisOutageNo_4">No</label>
          </div>
        </div>

        <!-- Yes/no option for SIS Integrity Compromise -->
        <div class="mb-3">
          <label>SIS Integrity Compromise:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_4" id="sisIntegrityYes_4" value="yes">
            <label class="form-check-label" for="sisIntegrityYes">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_4" id="sisIntegrityNo_4" value="no">
            <label class="form-check-label" for="sisIntegrityNo_4">No</label>
          </div>
        </div>

        <!-- Textarea for justification -->
        <label for="txtsafetyJustify_4">Justification:</label>
        <textarea id="txtsafetyJustify_4" name="txtsafetyJustify_4" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="safetyModal_5" tabindex="-1" aria-labelledby="safetyModal_5_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="safetyModal_5_Label">Justification for Scenario 5 Safety Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <!-- Drop-down select control for the nature of the safety hazard -->
        <label for="hazardNature_5">Nature of Safety Hazard:</label>
        <select id="hazardNature_5" name="hazardNature_1" class="form-control mb-3">
            <option value="">-- Select Hazard --</option>
          <option value="Chemical">Chemical</option>
          <option value="Electrical">Electrical</option>
          <option value="Mechanical">Mechanical</option>
          <option value="Radiation">Radiation</option>
        </select>

        <!-- Yes/no option for SIS Outage -->
        <div class="mb-3">
          <label>SIS Outage:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_5" id="sisOutageYes_5" value="yes">
            <label class="form-check-label" for="sisOutageYes_5">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisOutage_5" id="sisOutageNo_5" value="no">
            <label class="form-check-label" for="sisOutageNo_5">No</label>
          </div>
        </div>

        <!-- Yes/no option for SIS Integrity Compromise -->
        <div class="mb-3">
          <label>SIS Integrity Compromise:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_5" id="sisIntegrityYes_5" value="yes">
            <label class="form-check-label" for="sisIntegrityYes">Yes</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="sisIntegrity_1" id="sisIntegrityNo_5" value="no">
            <label class="form-check-label" for="sisIntegrityNo_5">No</label>
          </div>
        </div>

        <!-- Textarea for justification -->
        <label for="txtsafetyJustify_5">Justification:</label>
        <textarea id="txtsafetyJustify_5" name="txtsafetyJustify_5" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



<!-- life ratings -->
<div class="modal fade" id="lifeModal_1" tabindex="-1" aria-labelledby="lifeModal_1_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="lifeModal_1_Label">Justification for Scenario 1 Danger-to-Life Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtlifeJustify_1" name="txtlifeJustify_1" class="form-control" rows="3" style="resize: none"></textarea>
          <label for="dangerScope">Scope of Danger:</label>
        <select id="dangerScope_1" name="dangerScope_1" class="form-control mb-3">
            <option value="">-- Select Scope --</option>
          <option value="Facility">Facility</option>
          <option value="External">External</option>
          <option value="Both">Both</option>
        </select>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lifeModal_2" tabindex="-1" aria-labelledby="lifeModal_2_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="lifeModal_2_Label">Justification for Scenario 2 Danger-to-Life Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtlifeJustify_2" name="txtlifeJustify_2" class="form-control" rows="3" style="resize: none"></textarea>
           <label for="dangerScope">Scope of Danger:</label>
        <select id="dangerScope_2" name="dangerScope_2" class="form-control mb-3">
            <option value="">-- Select Scope --</option>
          <option value="Facility">Facility</option>
          <option value="External">External</option>
          <option value="Both">Both</option>
        </select>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lifeModal_3" tabindex="-1" aria-labelledby="lifeModal_3_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="lifeModal_3_Label">Justification for Scenario 3 Danger-to-Life Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtlifeJustify_3" name="txtlifeJustify_3" class="form-control" rows="3" style="resize: none"></textarea>
           <label for="dangerScope">Scope of Danger:</label>
        <select id="dangerScope_3" name="dangerScope_3" class="form-control mb-3">
            <option value="">-- Select Scope --</option>
          <option value="Facility">Facility</option>
          <option value="External">External</option>
          <option value="Both">Both</option>
        </select>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lifeModal_4" tabindex="-1" aria-labelledby="lifeModal_4_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="lifeModal_4_Label">Justification for Scenario 4 Danger-to-Life Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtlifeJustify_4" name="txtlifeJustify_4" class="form-control" rows="3" style="resize: none"></textarea>
           <label for="dangerScope">Scope of Danger:</label>
        <select id="dangerScope_4" name="dangerScope_4" class="form-control mb-3">
            <option value="">-- Select Scope --</option>
          <option value="Facility">Facility</option>
          <option value="External">External</option>
          <option value="Both">Both</option>
        </select>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lifeModal_5" tabindex="-1" aria-labelledby="lifeModal_5_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="lifeModal_5_Label">Justification for Scenario 5 Danger-to-Life Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtlifeJustify_5" name="txtlifeJustify_5" class="form-control" rows="3" style="resize: none"></textarea>
           <label for="dangerScope">Scope of Danger:</label>
        <select id="dangerScope_5" name="dangerScope_5" class="form-control mb-3">
            <option value="">-- Select Scope --</option>
          <option value="Facility">Facility</option>
          <option value="External">External</option>
          <option value="Both">Both</option>
        </select>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Production impact justifications -->
<div class="modal fade" id="productionModal_1" tabindex="-1" aria-labelledby="productionModal_1_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productionModal_1_Label">Justification for Scenario 1 Production Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtproductionJustify_1" name="txtproductionJustify_1" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="productionModal_2" tabindex="-1" aria-labelledby="productionModal_2_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productionModal_2_Label">Justification for Scenario 2 Production Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtproductionJustify_2" name="txtproductionJustify_2" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="productionModal_3" tabindex="-1" aria-labelledby="productionModal_3_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productionModal_3_Label">Justification for Scenario 3 Production Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtproductionJustify_3" name="txtproductionJustify_3" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="productionModal_4" tabindex="-1" aria-labelledby="productionModal_4_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productionModal_4_Label">Justification for Scenario 4 Production Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtproductionJustify_4" name="txtproductionJustify_4" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="productionModal_5" tabindex="-1" aria-labelledby="productionModal_5_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productionModal_5_Label">Justification for Scenario 5 Production Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtproductionJustify_5" name="txtproductionJustify_5" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Financial justification modals -->
<div class="modal fade" id="financeModal_1" tabindex="-1" aria-labelledby="financeModal_1_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="financeModal_1_Label">Justification for Scenario 1 Finance Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtfinanceJustify_1" name="txtfinanceJustify_1" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="financeModal_2" tabindex="-1" aria-labelledby="financeModal_2_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="financeModal_2_Label">Justification for Scenario 2 Finance Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtfinanceJustify_2" name="txtfinanceJustify_2" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="financeModal_3" tabindex="-1" aria-labelledby="financeModal_3_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="financeModal_3_Label">Justification for Scenario 3 Finance Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtfinanceJustify_3" name="txtfinanceJustify_3" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="financeModal_4" tabindex="-1" aria-labelledby="financeModal_4_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="financeModal_4_Label">Justification for Scenario 4 Finance Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtfinanceJustify_4" name="txtfinanceJustify_4" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="financeModal_5" tabindex="-1" aria-labelledby="financeModal_5_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="financeModal_5_Label">Justification for Scenario 5 Finance Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtfinanceJustify_5" name="txtfinanceJustify_5" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Reputation justification modals -->
<div class="modal fade" id="reputationModal_1" tabindex="-1" aria-labelledby="reputationModal_1_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reputationModal_1_Label">Justification for Scenario 1 Reputation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtreputationJustify_1" name="txtreputationJustify_1" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="reputationModal_2" tabindex="-1" aria-labelledby="reputationModal_2_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reputationModal_2_Label">Justification for Scenario 2 Reputation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtreputationJustify_2" name="txtreputationJustify_2" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="reputationModal_3" tabindex="-1" aria-labelledby="reputationModal_3_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reputationModal_3_Label">Justification for Scenario 3 Reputation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtreputationJustify_3" name="txtreputationJustify_3" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="reputationModal_4" tabindex="-1" aria-labelledby="reputationModal_4_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reputationModal_4_Label">Justification for Scenario 4 Reputation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtreputationJustify_4" name="txtreputationJustify_4" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="reputationModal_5" tabindex="-1" aria-labelledby="reputationModal_5_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reputationModal_5_Label">Justification for Scenario 5 Reputation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtreputationJustify_5" name="txtreputationJustify_5" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Environment justification modals -->
<div class="modal fade" id="environmentModal_1" tabindex="-1" aria-labelledby="environmentModal_1_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="environmentModal_1_Label">Justification for Scenario 1 Environment Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Dropdown for the type of contaminants -->
        <label for="contaminantType_1">Type of Contaminants:</label>
        <select id="contaminantType_1" name="contaminantType_1" class="form-control mb-3">
          <option value="">-- Select Contaminant Type --</option>
          <!-- Populate with actual contaminant types -->
          <option value="Chemical">Chemical</option>
          <option value="Biological">Biological</option>
          <option value="Radiological">Radiological</option>
          <option value="Physical">Physical</option>
        </select>

        <!-- Dropdown for the affected ecosystem -->
        <label for="affectedEcosystem_1">Affected Ecosystem:</label>
        <select id="affectedEcosystem_1" name="affectedEcosystem_1" class="form-control mb-3">
          <option value="">-- Select Ecosystem --</option>
          <!-- Populate with different ecosystem types -->
          <option value="Aquatic">Aquatic</option>
          <option value="Terrestrial">Terrestrial</option>
          <option value="Urban">Urban</option>
          <option value="Agricultural">Agricultural</option>
        </select>

        <!-- Dropdown for the extent of the contamination -->
        <label for="contaminationExtent_1">Extent of Contamination:</label>
        <select id="contaminationExtent_1" name="contaminationExtent_1" class="form-control mb-3">
          <option value="">-- Select Extent --</option>
          <option value="Localised">Localised</option>
          <option value="WideArea">Wide Area</option>
        </select>

        <!-- Dropdown for effect on local residential population -->
        <label for="effectOnPopulation_1">Effect on Local Residential Population:</label>
        <select id="effectOnPopulation_1" name="effectOnPopulation_1" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Dropdown for effect on local wildlife -->
        <label for="effectOnWildlife_1">Effect on Local Wildlife:</label>
        <select id="effectOnWildlife_1" name="effectOnWildlife_1" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Textarea for additional justification -->
        <label for="txtenvironmentJustify_1">Justification:</label>
        <textarea id="txtenvironmentJustify_1" name="txtenvironmentJustify_1" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="environmentModal_2" tabindex="-1" aria-labelledby="environmentModal_2_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="environmentModal_2_Label">Justification for Scenario 2 Environment Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Dropdown for the type of contaminants -->
        <label for="contaminantType_2">Type of Contaminants:</label>
        <select id="contaminantType_2" name="contaminantType_2" class="form-control mb-3">
          <option value="">-- Select Contaminant Type --</option>
            <option value="None">None</option>
          <option value="Chemical">Chemical</option>
          <option value="Biological">Biological</option>
          <option value="Radiological">Radiological</option>
          <option value="Physical">Physical</option>
        </select>

        <!-- Dropdown for the affected ecosystem -->
        <label for="affectedEcosystem_2">Affected Ecosystem:</label>
        <select id="affectedEcosystem_2" name="affectedEcosystem_2" class="form-control mb-3">
          <option value="">-- Select Ecosystem --</option>
            <option value="None">None</option>
          <option value="Aquatic">Aquatic</option>
          <option value="Urban">Urban</option>
          <option value="Agricultural">Agricultural</option>
        </select>

        <!-- Dropdown for the extent of the contamination -->
        <label for="contaminationExtent_2">Extent of Contamination:</label>
        <select id="contaminationExtent_2" name="contaminationExtent_2" class="form-control mb-3">
          <option value="">-- Select Extent --</option>
            <option value="N/A">N/A</option>
          <option value="Localised">Localised</option>
          <option value="WideArea">Wide Area</option>
        </select>

        <!-- Dropdown for effect on local residential population -->
        <label for="effectOnPopulation_2">Effect on Local Residential Population:</label>
        <select id="effectOnPopulation_2" name="effectOnPopulation_2" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
            <option value="None">None</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Dropdown for effect on local wildlife -->
        <label for="effectOnWildlife_2">Effect on Local Wildlife:</label>
        <select id="effectOnWildlife_2" name="effectOnWildlife_2" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
            <option value="N/A">N/A</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Textarea for additional justification -->
        <label for="txtenvironmentJustify_2">Justification:</label>
        <textarea id="txtenvironmentJustify_2" name="txtenvironmentJustify_2" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="environmentModal_3" tabindex="-1" aria-labelledby="environmentModal_3_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="environmentModal_3_Label">Justification for Scenario 3 Environment Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Dropdown for the type of contaminants -->
        <label for="contaminantType_3">Type of Contaminants:</label>
        <select id="contaminantType_3" name="contaminantType_3" class="form-control mb-3">
          <option value="">-- Select Contaminant Type --</option>
          <!-- Populate with actual contaminant types -->
          <option value="Chemical">Chemical</option>
          <option value="Biological">Biological</option>
          <option value="Radiological">Radiological</option>
          <option value="Physical">Physical</option>
        </select>

        <!-- Dropdown for the affected ecosystem -->
        <label for="affectedEcosystem_3">Affected Ecosystem:</label>
        <select id="affectedEcosystem_3" name="affectedEcosystem_3" class="form-control mb-3">
          <option value="">-- Select Ecosystem --</option>
          <!-- Populate with different ecosystem types -->
          <option value="Aquatic">Aquatic</option>
          <option value="Terrestrial">Terrestrial</option>
          <option value="Urban">Urban</option>
          <option value="Agricultural">Agricultural</option>
        </select>

        <!-- Dropdown for the extent of the contamination -->
        <label for="contaminationExtent_3">Extent of Contamination:</label>
        <select id="contaminationExtent_3" name="contaminationExtent_3" class="form-control mb-3">
          <option value="">-- Select Extent --</option>
          <option value="Localised">Localised</option>
          <option value="WideArea">Wide Area</option>
        </select>

        <!-- Dropdown for effect on local residential population -->
        <label for="effectOnPopulation_3">Effect on Local Residential Population:</label>
        <select id="effectOnPopulation_3" name="effectOnPopulation_3" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Dropdown for effect on local wildlife -->
        <label for="effectOnWildlife_3">Effect on Local Wildlife:</label>
        <select id="effectOnWildlife_3" name="effectOnWildlife_3" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Textarea for additional justification -->
        <label for="txtenvironmentJustify_3">Justification:</label>
        <textarea id="txtenvironmentJustify_3" name="txtenvironmentJustify_3" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="environmentModal_4" tabindex="-1" aria-labelledby="environmentModal_4_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="environmentModal_4_Label">Justification for Scenario4 Environment Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Dropdown for the type of contaminants -->
        <label for="contaminantType_4">Type of Contaminants:</label>
        <select id="contaminantType_4" name="contaminantType_4" class="form-control mb-3">
          <option value="">-- Select Contaminant Type --</option>
          <!-- Populate with actual contaminant types -->
          <option value="Chemical">Chemical</option>
          <option value="Biological">Biological</option>
          <option value="Radiological">Radiological</option>
          <option value="Physical">Physical</option>
        </select>

        <!-- Dropdown for the affected ecosystem -->
        <label for="affectedEcosystem_4">Affected Ecosystem:</label>
        <select id="affectedEcosystem_4" name="affectedEcosystem_4" class="form-control mb-3">
          <option value="">-- Select Ecosystem --</option>
          <!-- Populate with different ecosystem types -->
          <option value="Aquatic">Aquatic</option>
          <option value="Terrestrial">Terrestrial</option>
          <option value="Urban">Urban</option>
          <option value="Agricultural">Agricultural</option>
        </select>

        <!-- Dropdown for the extent of the contamination -->
        <label for="contaminationExtent_4">Extent of Contamination:</label>
        <select id="contaminationExtent_4" name="contaminationExtent_4" class="form-control mb-3">
          <option value="">-- Select Extent --</option>
          <option value="Localised">Localised</option>
          <option value="WideArea">Wide Area</option>
        </select>

        <!-- Dropdown for effect on local residential population -->
        <label for="effectOnPopulation_4">Effect on Local Residential Population:</label>
        <select id="effectOnPopulation_4" name="effectOnPopulation_4" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Dropdown for effect on local wildlife -->
        <label for="effectOnWildlife_4">Effect on Local Wildlife:</label>
        <select id="effectOnWildlife_4" name="effectOnWildlife_4" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Textarea for additional justification -->
        <label for="txtenvironmentJustify_4">Justification:</label>
        <textarea id="txtenvironmentJustify_4" name="txtenvironmentJustify_4" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="environmentModal_5" tabindex="-1" aria-labelledby="environmentModal_5_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="environmentModal_5_Label">Justification for Scenario 5 Environment Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Dropdown for the type of contaminants -->
        <label for="contaminantType_5">Type of Contaminants:</label>
        <select id="contaminantType_5" name="contaminantType_5" class="form-control mb-3">
          <option value="">-- Select Contaminant Type --</option>
          <!-- Populate with actual contaminant types -->
          <option value="Chemical">Chemical</option>
          <option value="Biological">Biological</option>
          <option value="Radiological">Radiological</option>
          <option value="Physical">Physical</option>
        </select>

        <!-- Dropdown for the affected ecosystem -->
        <label for="affectedEcosystem_5">Affected Ecosystem:</label>
        <select id="affectedEcosystem_5" name="affectedEcosystem_5" class="form-control mb-3">
          <option value="">-- Select Ecosystem --</option>
          <!-- Populate with different ecosystem types -->
          <option value="Aquatic">Aquatic</option>
          <option value="Terrestrial">Terrestrial</option>
          <option value="Urban">Urban</option>
          <option value="Agricultural">Agricultural</option>
        </select>

        <!-- Dropdown for the extent of the contamination -->
        <label for="contaminationExtent_5">Extent of Contamination:</label>
        <select id="contaminationExtent_5" name="contaminationExtent_5" class="form-control mb-3">
          <option value="">-- Select Extent --</option>
          <option value="Localised">Localised</option>
          <option value="WideArea">Wide Area</option>
        </select>

        <!-- Dropdown for effect on local residential population -->
        <label for="effectOnPopulation_5">Effect on Local Residential Population:</label>
        <select id="effectOnPopulation_5" name="effectOnPopulation_5" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Dropdown for effect on local wildlife -->
        <label for="effectOnWildlife_5">Effect on Local Wildlife:</label>
        <select id="effectOnWildlife_5" name="effectOnWildlife_5" class="form-control mb-3">
          <option value="">-- Select Effect --</option>
          <option value="Harmless">Harmless</option>
          <option value="Harmful">Harmful</option>
          <option value="Deadly">Deadly</option>
        </select>

        <!-- Textarea for additional justification -->
        <label for="txtenvironmentJustify_5">Justification:</label>
        <textarea id="txtenvironmentJustify_5" name="txtenvironmentJustify_5" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Regulatory justification modals -->
<div class="modal fade" id="regulationModal_1" tabindex="-1" aria-labelledby="regulationModal_1_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="regulationModal_1_Label">Justification for Scenario 1 Regulation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtregulationJustify_1" name="txtregulationJustify_1" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="regulationModal_2" tabindex="-1" aria-labelledby="regulationModal_2_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="regulationModal_2_Label">Justification for Scenario 2 Regulation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtregulationJustify_2" name="txtregulationJustify_2" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="regulationModal_3" tabindex="-1" aria-labelledby="regulationModal_3_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="regulationModal_3_Label">Justification for Scenario 3 Regulation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtregulationJustify_3" name="txtregulationJustify_3" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="regulationModal_4" tabindex="-1" aria-labelledby="regulationModal_4_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="regulationModal_4_Label">Justification for Scenario 4 Regulation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtregulationJustify_4" name="txtregulationJustify_4" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="regulationModal_5" tabindex="-1" aria-labelledby="regulationModal_5_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="regulationModal_5_Label">Justification for Scenario 5 Regulation Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtregulationJustify_5" name="txtregulationJustify_5" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<!-- Data justification modals -->
<div class="modal fade" id="dataModal_1" tabindex="-1" aria-labelledby="dataModal_1_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dataModal_1_Label">Justification for Scenario 1 Data Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
        <div class="modal-body">
        <label for="txtdataJustify_1" class="form-label">Justification for Data Rating:</label>
        <textarea id="txtdataJustify_1" name="txtdataJustify_1" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <!-- Checkbox for PII affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataPII_1" name="dataPII_1">
            <label class="form-check-label" for="dataPII_1">Personal Identifiable Information (PII) Affected</label>
        </div>

        <!-- Checkbox for Company IP affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCompanyIP_1" name="dataCompanyIP_1">
            <label class="form-check-label" for="dataCompanyIP_1">Company Intellectual Property (IP) Affected</label>
        </div>

        <!-- Checkbox for Customer Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCustomer_1" name="dataCustomer_1">
            <label class="form-check-label" for="dataCustomer_1">Customer Data Affected</label>
        </div>

        <!-- Checkbox for Financial Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataFinancial_1" name="dataFinancial_1">
            <label class="form-check-label" for="dataFinancial_1">Financial Data Affected</label>
        </div>

<!-- Close button -->
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dataModal_2" tabindex="-1" aria-labelledby="dataModal_2_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dataModal_2_Label">Justification for Scenario 2 Data Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
        <div class="modal-body">
        <label for="txtdataJustify_2" class="form-label">Justification for Data Rating:</label>
        <textarea id="txtdataJustify_2" name="txtdataJustify_1" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <!-- Checkbox for PII affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataPII_2" name="dataPII_2">
            <label class="form-check-label" for="dataPII_2">Personal Identifiable Information (PII) Affected</label>
        </div>

        <!-- Checkbox for Company IP affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCompanyIP_2" name="dataCompanyIP_2">
            <label class="form-check-label" for="dataCompanyIP_2">Company Intellectual Property (IP) Affected</label>
        </div>

        <!-- Checkbox for Customer Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCustomer_1" name="dataCustomer_2">
            <label class="form-check-label" for="dataCustomer_2">Customer Data Affected</label>
        </div>

        <!-- Checkbox for Financial Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataFinancial_2" name="dataFinancial_2">
            <label class="form-check-label" for="dataFinancial_2">Financial Data Affected</label>
        </div>

<!-- Close button -->
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dataModal_3" tabindex="-1" aria-labelledby="dataModal_3_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dataModal_3_Label">Justification for Scenario 3 Data Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
        <div class="modal-body">
        <label for="txtdataJustify_3" class="form-label">Justification for Data Rating:</label>
        <textarea id="txtdataJustify_3" name="txtdataJustify_3" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <!-- Checkbox for PII affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataPII_3" name="dataPII_3">
            <label class="form-check-label" for="dataPII_3">Personal Identifiable Information (PII) Affected</label>
        </div>

        <!-- Checkbox for Company IP affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCompanyIP_3" name="dataCompanyIP_3">
            <label class="form-check-label" for="dataCompanyIP_3">Company Intellectual Property (IP) Affected</label>
        </div>

        <!-- Checkbox for Customer Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCustomer_3" name="dataCustomer_3">
            <label class="form-check-label" for="dataCustomer_3">Customer Data Affected</label>
        </div>

        <!-- Checkbox for Financial Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataFinancial_3" name="dataFinancial_3">
            <label class="form-check-label" for="dataFinancial_3">Financial Data Affected</label>
        </div>

<!-- Close button -->
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dataModal_4" tabindex="-1" aria-labelledby="dataModal_4_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dataModal_4_Label">Justification for Scenario 4 Data Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
        <div class="modal-body">
        <label for="txtdataJustify_4" class="form-label">Justification for Data Rating:</label>
        <textarea id="txtdataJustify_4" name="txtdataJustify_4" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <!-- Checkbox for PII affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataPII_4" name="dataPII_4">
            <label class="form-check-label" for="dataPII_4">Personal Identifiable Information (PII) Affected</label>
        </div>

        <!-- Checkbox for Company IP affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCompanyIP_4" name="dataCompanyIP_4">
            <label class="form-check-label" for="dataCompanyIP_4">Company Intellectual Property (IP) Affected</label>
        </div>

        <!-- Checkbox for Customer Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCustomer_4" name="dataCustomer_4">
            <label class="form-check-label" for="dataCustomer_4">Customer Data Affected</label>
        </div>

        <!-- Checkbox for Financial Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataFinancial_4" name="dataFinancial_4">
            <label class="form-check-label" for="dataFinancial_4">Financial Data Affected</label>
        </div>

<!-- Close button -->
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dataModal_5" tabindex="-1" aria-labelledby="dataModal_5_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dataModal_5_Label">Justification for Scenario 5 Data Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
        <div class="modal-body">
        <label for="txtdataJustify_5" class="form-label">Justification for Data Rating:</label>
        <textarea id="txtdataJustify_5" name="txtdataJustify_5" class="form-control mb-3" rows="3" style="resize: none"></textarea>

        <!-- Checkbox for PII affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataPII_5" name="dataPII_5">
            <label class="form-check-label" for="dataPII_5">Personal Identifiable Information (PII) Affected</label>
        </div>

        <!-- Checkbox for Company IP affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCompanyIP_5" name="dataCompanyIP_5">
            <label class="form-check-label" for="dataCompanyIP_5">Company Intellectual Property (IP) Affected</label>
        </div>

        <!-- Checkbox for Customer Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataCustomer_5" name="dataCustomer_5">
            <label class="form-check-label" for="dataCustomer_5">Customer Data Affected</label>
        </div>

        <!-- Checkbox for Financial Data affected -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="dataFinancial_5" name="dataFinancial_5">
            <label class="form-check-label" for="dataFinancial_5">Financial Data Affected</label>
        </div>

<!-- Close button -->
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
</div>


<div class="modal fade" id="supplyModal_1" tabindex="-1" aria-labelledby="supplyModal_1_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supplyModal_1_Label">Justification for Scenario 1 Supply Chain Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
                <div class="modal-body">
                <!-- Textarea for justification -->
                <label for="txtsupplyJustify_1" class="form-label">Justification for Supply Chain Rating:</label>
                <textarea id="txtsupplyJustify_1" name="txtsupplyJustify_1" class="form-control mb-3" rows="3" style="resize: none"></textarea>

                <!-- Checkbox for inbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="inboundSupplyAffected_1" name="inboundSupplyAffected_1">
                    <label class="form-check-label" for="inboundSupplyAffected_1">Inbound Supply Affected</label>
                </div>

                <!-- Checkbox for outbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="outboundSupplyAffected_1" name="outboundSupplyAffected_1">
                    <label class="form-check-label" for="outboundSupplyAffected_1">Outbound Supply Affected</label>
                </div>

                <!-- Dropdown for overall impact on production -->
                <label for="productionImpact_1" class="form-label">Overall Impact on Production:</label>
                <select id="productionImpact_1" name="productionImpact_1" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Dropdown for impact on supply chain security -->
                <label for="supplyChainSecurityImpact_1" class="form-label">Impact on Supply Chain Security:</label>
                <select id="supplyChainSecurityImpact_1" name="supplyChainSecurityImpact_1" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Close button -->
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="supplyModal_2" tabindex="-1" aria-labelledby="supplyModal_2_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supplyModal_2_Label">Justification for Scenario 2 Supply Chain Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
                <div class="modal-body">
                <!-- Textarea for justification -->
                <label for="txtsupplyJustify_2" class="form-label">Justification for Supply Chain Rating:</label>
                <textarea id="txtsupplyJustify_2" name="txtsupplyJustify_2" class="form-control mb-3" rows="3" style="resize: none"></textarea>

                <!-- Checkbox for inbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="inboundSupplyAffected_2" name="inboundSupplyAffected_2">
                    <label class="form-check-label" for="inboundSupplyAffected_2">Inbound Supply Affected</label>
                </div>

                <!-- Checkbox for outbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="outboundSupplyAffected_2" name="outboundSupplyAffected_2">
                    <label class="form-check-label" for="outboundSupplyAffected_2">Outbound Supply Affected</label>
                </div>

                <!-- Dropdown for overall impact on production -->
                <label for="productionImpact_2" class="form-label">Overall Impact on Production:</label>
                <select id="productionImpact_2" name="productionImpact_2" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Dropdown for impact on supply chain security -->
                <label for="supplyChainSecurityImpact_2" class="form-label">Impact on Supply Chain Security:</label>
                <select id="supplyChainSecurityImpact_2" name="supplyChainSecurityImpact_2" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Close button -->
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="supplyModal_3" tabindex="-1" aria-labelledby="supplyModal_3_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supplyModal_3_Label">Justification for Scenario 3 Supply Chain Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
                <div class="modal-body">
                <!-- Textarea for justification -->
                <label for="txtsupplyJustify_3" class="form-label">Justification for Supply Chain Rating:</label>
                <textarea id="txtsupplyJustify_3" name="txtsupplyJustify_3" class="form-control mb-3" rows="3" style="resize: none"></textarea>

                <!-- Checkbox for inbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="inboundSupplyAffected_3" name="inboundSupplyAffected_3">
                    <label class="form-check-label" for="inboundSupplyAffected_3">Inbound Supply Affected</label>
                </div>

                <!-- Checkbox for outbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="outboundSupplyAffected_3" name="outboundSupplyAffected_3">
                    <label class="form-check-label" for="outboundSupplyAffected_3">Outbound Supply Affected</label>
                </div>

                <!-- Dropdown for overall impact on production -->
                <label for="productionImpact_3" class="form-label">Overall Impact on Production:</label>
                <select id="productionImpact_3" name="productionImpact_3" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Dropdown for impact on supply chain security -->
                <label for="supplyChainSecurityImpact_3" class="form-label">Impact on Supply Chain Security:</label>
                <select id="supplyChainSecurityImpact_3" name="supplyChainSecurityImpact_3" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Close button -->
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="supplyModal_4" tabindex="-1" aria-labelledby="supplyModal_4_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supplyModal_4_Label">Justification for Scenario 4 Supply Chain Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
                <div class="modal-body">
                <!-- Textarea for justification -->
                <label for="txtsupplyJustify_4" class="form-label">Justification for Supply Chain Rating:</label>
                <textarea id="txtsupplyJustify_4" name="txtsupplyJustify_1" class="form-control mb-3" rows="3" style="resize: none"></textarea>

                <!-- Checkbox for inbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="inboundSupplyAffected_4" name="inboundSupplyAffected_4">
                    <label class="form-check-label" for="inboundSupplyAffected_4">Inbound Supply Affected</label>
                </div>

                <!-- Checkbox for outbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="outboundSupplyAffected_4" name="outboundSupplyAffected_4">
                    <label class="form-check-label" for="outboundSupplyAffected_4">Outbound Supply Affected</label>
                </div>

                <!-- Dropdown for overall impact on production -->
                <label for="productionImpact_4" class="form-label">Overall Impact on Production:</label>
                <select id="productionImpact_4" name="productionImpact_4" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Dropdown for impact on supply chain security -->
                <label for="supplyChainSecurityImpact_4" class="form-label">Impact on Supply Chain Security:</label>
                <select id="supplyChainSecurityImpact_4" name="supplyChainSecurityImpact_4" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Close button -->
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="supplyModal_5" tabindex="-1" aria-labelledby="supplyModal_5_Label" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supplyModal_5_Label">Justification for Scenario 5 Supply Chain Rating</h5>
                <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
                <div class="modal-body">
                <!-- Textarea for justification -->
                <label for="txtsupplyJustify_5" class="form-label">Justification for Supply Chain Rating:</label>
                <textarea id="txtsupplyJustify_5" name="txtsupplyJustify_5" class="form-control mb-3" rows="3" style="resize: none"></textarea>

                <!-- Checkbox for inbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="inboundSupplyAffected_5" name="inboundSupplyAffected_5">
                    <label class="form-check-label" for="inboundSupplyAffected_5">Inbound Supply Affected</label>
                </div>

                <!-- Checkbox for outbound supply affected -->
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="outboundSupplyAffected_5" name="outboundSupplyAffected_5">
                    <label class="form-check-label" for="outboundSupplyAffected_5">Outbound Supply Affected</label>
                </div>

                <!-- Dropdown for overall impact on production -->
                <label for="productionImpact_5" class="form-label">Overall Impact on Production:</label>
                <select id="productionImpact_5" name="productionImpact_5" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Dropdown for impact on supply chain security -->
                <label for="supplyChainSecurityImpact_5" class="form-label">Impact on Supply Chain Security:</label>
                <select id="supplyChainSecurityImpact_5" name="supplyChainSecurityImpact_5" class="form-select mb-3">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
                </select>

                <!-- Close button -->
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



<!-- Vulnerability justification modals -->
<div class="modal fade" id="vulnModal_1" tabindex="-1" aria-labelledby="vulnModal_1_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="vulnModal_1_Label">Justification for Scenario 1 Vulnerability Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtvulnJustify_1" name="txtvulnJustify_1" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="vulnModal_2" tabindex="-1" aria-labelledby="vulnModal_2_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="vulnModal_2_Label">Justification for Scenario 2 Vulnerability Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtvulnJustify_2" name="txtvulnJustify_2" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="vulnModal_3" tabindex="-1" aria-labelledby="vulnModal_3_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="vulnModal_3_Label">Justification for Scenario 3 Vulnerability Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtvulnJustify_3" name="txtvulnJustify_3" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="vulnModal_4" tabindex="-1" aria-labelledby="vulnModal_4_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="vulnModal_4_Label">Justification for Scenario 4 Vulnerability Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtvulnJustify_4" name="txtvulnJustify_4" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="vulnModal_5" tabindex="-1" aria-labelledby="vulnModal_5_Label" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="vulnModal_5_Label">Justification for Scenario 5 Vulnerability Rating</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="txtvulnJustify_5" name="txtvulnJustify_5" class="form-control" rows="3" style="resize: none"></textarea>
        <button type="button" class="btn btn-secondary mt-3 modal-button" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



</form>

<!-- RAActionsModal.html -->
<div class="modal fade" id="RAActionsModal" tabindex="-1" aria-labelledby="RAActionsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="RAActionsModalLabel" style="color: white">Action:</h5>
        <button type="button" class="btn-close modal-button" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
        <div class="modal-body">
            <form id="raActionsForm">
                {% csrf_token %}
                <input type="hidden" name="hdnphaID" id="hdnphaID" value="0">
                <input type="hidden" name="hdntxtModalRAW" id="hdntxtModalRAW">

                <!-- Action Title -->
                <div class="mb-3">
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body">
                            <label for="actionTitle" class="form-label" style="color: white">Headline</label>
                            <input type="text" class="form-control" id="actionTitle" name="actionTitle" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-7">
                        <!-- Action Owner -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionOwner" class="form-label" style="color: white">Risk Owner</label>
                                    <input type="text" class="form-control" id="actionOwner" name="actionOwner" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <!-- Action Date -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionDate" class="form-label" style="color: white">Action Date</label>
                                    <input type="date" class="form-control" id="actionDate" name="actionDate" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <!-- Action Owner -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionEffort" class="form-label" style="color: white">Effort Level:</label>
                                    <Select class="form-control" id="actionEffort" name="actionEffort">
                                            <option value="">-- Select Effort --</option>
                                            <option value="Low">Low</option>
                                            <option value="Medium">Medium</option>
                                            <option value="High">High</option>
                                            <option value="Very High">Very High</option>
                                        </select>
                                </div>
                                </div>
                            </div>
                        </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionDifficulty" class="form-label" style="color: white">Difficulty Level</label>
                                    <Select class="form-control" id="actionDifficulty" name="actionDifficulty">
                                            <option value="">-- Select Difficulty --</option>
                                            <option value="Low">Low</option>
                                            <option value="Medium">Medium</option>
                                            <option value="High">High</option>
                                            <option value="Very High">Very High</option>
                                        </select>

                                </div>
                            </div>
                        </div>
                    </div>
                    </div>


                <div class="row">
                    <div class="col-md-4">
                        <!-- Action Owner -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionCost" class="form-label" style="color: white">Estimated Cost</label>
                                    <Select class="form-control" id="actionCost" name="actionCost">
                                            <option value="">-- Select Costs --</option>
                                            <option value="Low">Low</option>
                                            <option value="Medium">Medium</option>
                                            <option value="High">High</option>
                                            <option value="Very High">Very High</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <!-- Action Owner -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionAffinity" class="form-label" style="color: white">Risk Mitigation</label>
                                    <Select class="form-control" id="actionAffinity" name="actionAffinity">
                                            <option value="">-- Select Level --</option>
                                            <option value="Low">Low</option>
                                            <option value="Medium">Medium</option>
                                            <option value="High">High</option>
                                            <option value="Very High">Very High</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <!-- Action Date -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionStatus" class="form-label" style="color: white">Status</label>
                                    <input type="text" class="form-control" id="actionStatus" name="actionStatus" readonly value="Open">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body">
                            <label for="actionDescription" class="form-label" style="color: white">Description</label>
                            <textarea id="actionDescription" name="actionDescription" class="form-control" rows="3" style="resize: none"></textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-7">
                        <!-- Action Owner -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionPriority" class="form-label" style="color: white">Urgency</label>
                                        <select class="form-control" id="actionPriority" name="actionPriority">
                                            <option value="0">-- Select Urgency --</option>
                                            <option value="1">Low</option>
                                            <option value="2">Medium</option>
                                            <option value="3">High</option>
                                            <option value="4">Critical</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <!-- Action Date -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="actionDueDate" class="form-label" style="color: white">Target Date</label>
                                    <input type="date" class="form-control" id="actionDueDate" name="actionDueDate">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Action Assets -->
                <div class="mb-3">
                    <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                        <div class="card-body">
                            <div class="row justify-content-center">
                                <div class="col-md-12">
                                <p class="justify-content-center" style="color: white">Expected Risk Mitigation from Action</p>
                                </div>
                            </div>
                            <div class="row justify-content-center">
                                <div class="col-md-4">
                                    <label for="safetyMitigation" style="color: white">Safety: <span id="safetyMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="safetyMitigation" name="safetyMitigation" min="0" max="100" value="0">
                                </div>
                                <div class="col-md-4">
                                    <label for="lifeMitigation" style="color: white">Life: <span id="lifeMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="lifeMitigation" name="lifeMitigation" min="0" max="100" value="0">
                                </div>
                                <div class="col-md-4">
                                    <label for="productionMitigation" style="color: white">Production: <span id="productionMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="productionMitigation" name="productionMitigation" min="0" max="100" value="0">
                                </div>
                            </div>
                            <div class="row justify-content-center mt-4">
                                <div class="col-md-4">
                                    <label for="financeMitigation" style="color: white">Finance: <span id="financeMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="financeMitigation" name="financeMitigation" min="0" max="100" value="0">
                                </div>

                                <div class="col-md-4">
                                    <label for="reputationMitigation" style="color: white">Reputation: <span id="reputationMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="reputationMitigation" name="reputationMitigation" min="0" max="100" value="0">
                                </div>
                                <div class="col-md-4">
                                    <label for="environmentMitigation" style="color: white">Environment: <span id="environmentMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="environmentMitigation" name="environmentMitigation" min="0" max="100" value="0">
                                </div>
                            </div>
                            <div class="row justify-content-center mt-4">
                                <div class="col-md-4">
                                    <label for="regulationMitigation" style="color: white">Regulation: <span id="regulationMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="regulationMitigation" name="regulationMitigation" min="0" max="100" value="0">
                                </div>
                                <div class="col-md-4">
                                    <label for="dataMitigation" style="color: white">Data: <span id="dataMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="dataMitigation" name="dataMitigation" min="0" max="100" value="0">
                                </div>

                                <div class="col-md-4">
                                    <label for="supplyMitigation" style="color: white">Supply: <span id="supplyMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="supplyMitigation" name="supplyMitigation" min="0" max="100" value="0">
                                </div>
                            </div>
                            <div class="row justify-content-center mt-4">
                                <div class="col-md-4">
                                    <label for="threatMitigation" style="color: white">Threat: <span id="threatMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="threatMitigation" name="threatMitigation" min="0" max="100" value="0">
                                </div>
                                <div class="col-md-4">
                                    <label for="vulnerabilityMitigation" style="color: white">Vulnerability: <span id="vulnerabilityMitigationValue"></span></label>
                                    <input type="range" class="form-control custom-range" id="vulnerabilityMitigation" name="vulnerabilityMitigation" min="0" max="100" value="0">
                                </div>
                            </div>
                            <script>
                            document.addEventListener('DOMContentLoaded', (event) => {
                              // This function updates the span displaying the value of the slider
                              function updateSliderValue(slider) {
                                const valueDisplayId = slider.id + 'Value';
                                const valueDisplay = document.getElementById(valueDisplayId);
                                if (valueDisplay) {
                                  valueDisplay.textContent = slider.value + '%'; // Add the '%' symbol
                                } else {
                                  // console.error('No element found with id:', valueDisplayId);
                                }
                              }

                              // Get all range inputs on the form
                              const sliders = document.querySelectorAll('input[type="range"]');

                              // Initialize the display values and add event listeners to each slider
                              sliders.forEach(slider => {
                                updateSliderValue(slider); // Initialize the display value
                                slider.addEventListener('input', () => updateSliderValue(slider));
                              });
                            });

                            </script>
                        </div>

                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <!-- Action Owner -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="outageSIS" class="form-label" style="color: white">Safety (SIS) Outage:</label>
                                        <select class="form-control" id="outageSIS" name="outageSIS">
                                            <option value="">-- Select Option --</option>
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <!-- Action Date -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="outageICS" class="form-label" style="color: white">Control System (SCADA/ICS) Outage:</label>
                                        <select class="form-control" id="outageICS" name="outageICS">
                                            <option value="">-- Select Option --</option>
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <!-- Action Date -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="outageEMS" class="form-label" style="color: white">Environmental (EMS) Outage:</label>
                                        <select class="form-control" id="outageEMS" name="outageEMS">
                                            <option value="">-- Select Option --</option>
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <!-- Action Owner -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="outageIT" class="form-label" style="color: white">IT Outage:</label>
                                        <select class="form-control" id="outageIT" name="outageIT">
                                            <option value="">-- Select Option --</option>
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <!-- Action Date -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="outagePS" class="form-label" style="color: white">Physical Security Outage:</label>
                                        <select class="form-control" id="outagePS" name="outagePS">
                                            <option value="">-- Select Option --</option>
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <!-- Action Date -->
                        <div class="mb-3">
                            <div class="card mb-3 shadow-sm"> <!-- Bootstrap card with shadow -->
                                <div class="card-body">
                                    <label for="outageWWW" class="form-label" style="color: white">Internet Outage:</label>
                                        <select class="form-control" id="outageWWW" name="outageWWW">
                                            <option value="0">-- Select Option --</option>
                                            <option value="1">Yes</option>
                                            <option value="2">No</option>
                                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="submitRAActionForm();">Save</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </form>
        </div>
        <!-- ... (rest of the modal code) ... -->

    </div>
  </div>
</div>
<div class="modal fade" id="scenarioSelectModal" tabindex="-1" aria-labelledby="scenarioSelectModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="scenarioSelectModalLabel">Select a Scenario</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="file-explorer">
          <ul id="scenarioList" class="list-group">
            <!-- Scenario items will be populated here -->
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>


    var selectedButtonId = "";
    // Function to populate the scenario list in the modal
function populateScenarioList() {
  $.ajax({
    url: '/OTRisk/get_saved_scenario_builders',
    type: 'GET',
    success: function(response) {
      var scenarioList = $('#scenarioList');
      scenarioList.empty();

      response.forEach(function(scenario) {
        var listItem = $(`
          <li class="list-group-item list-group-item-action" data-id="${scenario.id}">
            <span class="file-icon"><i class="fas fa-file-alt"></i></span>
            <span class="file-name">${scenario.scenario_name}</span>
          </li>
        `);
        listItem.on('click', function() {
          retrieveScenario($(this).data('id'));
          $('#scenarioSelectModal').modal('hide');
        });
        scenarioList.append(listItem);
      });
    },
    error: function(error) {
      console.error('Error fetching scenarios:', error);
    }
  });
}



// Function to retrieve and display a selected scenario
function retrieveScenario(scenarioId) {
  resetScenarioTab(selectedButtonId);
  $.ajax({
    url: '/OTRisk/retrieve_scenario_builder/' + scenarioId,
    type: 'GET',
    success: function(response) {
        resetScenarioTab(selectedButtonId);
      $('#txtScenarioDescription_' + selectedButtonId).val(response.scenario_description);
      $('#txtScenarioAnalysis_' + selectedButtonId).val(response.consequences);
      // $('#attack_tree_text').val(response.attack_tree_data);

        // Check if data.attack_tree_text is defined, not null, and not an empty string
        //if (response.attack_tree_data && response.attack_tree_data.trim() !== '') {

        //    var jsonStringFromDatabase = response.attack_tree_data;
         //   var jsonObject = JSON.parse(jsonStringFromDatabase);
        //    drawAttackTree(jsonObject);
        // }

      if (response.factors['Environmental consequences']) {
        $('#range_environment_' + selectedButtonId).val(response.factors['Environmental consequences'].score);
        $('#txtenvironmentJustify_' + selectedButtonId).val(response.factors['Environmental consequences'].narrative);
      }
       if (response.factors['Data']) {
        $('#range_data_' + selectedButtonId).val(response.factors['Data'].score);
        $('#txtdataJustify_' + selectedButtonId).val(response.factors['Data'].narrative);
      }
      if (response.factors['Danger-to-life']) {
        $('#range_life_' + selectedButtonId).val(response.factors['Danger-to-life'].score);
        $('#txtlifeJustify_' + selectedButtonId).val(response.factors['Danger-to-life'].narrative);
      }
      if (response.factors['Financials']) {
        $('#range_finance_' + selectedButtonId).val(response.factors['Financials'].score);
        $('#txtfinanceJustify_' + selectedButtonId).val(response.factors['Financials'].narrative);
      }
      if (response.factors['Operations']) {
        $('#range_production_' + selectedButtonId).val(response.factors['Operations'].score);
        $('#txtproductionJustify_' + selectedButtonId).val(response.factors['Operations'].narrative);
      }
      if (response.factors['Regulations']) {
        $('#range_regulatory_' + selectedButtonId).val(response.factors['Regulations'].score);
        $('#txtregulatoryJustify_' + selectedButtonId).val(response.factors['Regulations'].narrative);
      }
      if (response.factors['Reputation']) {
        $('#range_reputation_' + selectedButtonId).val(response.factors['Reputation'].score);
        $('#txtreputationJustify_' + selectedButtonId).val(response.factors['Reputation'].narrative);
      }
      if (response.factors['Safety']) {
        $('#range_safety_' + selectedButtonId).val(response.factors['Safety'].score);
        $('#txtsafetyJustify_' + selectedButtonId).val(response.factors['Safety'].narrative);
      }
      if (response.factors['Supply chain']) {
        $('#range_supply_' + selectedButtonId).val(response.factors['Supply chain'].score);
        $('#txtsupplyJustify_' + selectedButtonId).val(response.factors['Supply chain'].narrative);
      }



    },
    error: function(error) {
      console.error('Error retrieving scenario:', error);
    }
  });
}

// Call populateScenarioList when the modal is about to be shown
$('#scenarioSelectModal').on('show.bs.modal', function (e) {
  populateScenarioList();
  selectedButtonId = $(e.relatedTarget).attr('id'); // Store the ID of the clicked button
});

// Event handlers for the buttons
// Event handlers for the buttons
$('[id^=btnSelectScenario_]').on('click', function() {
  var fullId = $(this).attr('id');
  selectedButtonId = fullId.charAt(fullId.length - 1); // Get the last character, which is the number
});


</script>
<script>


function checkEditModeAndExecute(buttonId, spinnerId) {
    // Assuming you're using JavaScript to get the session variable

    Swal.fire({
    title: 'Confirm',
    text: "Risk analysis of the scenario can take up to a minute to complete. Do you want to proceed?",
    imageUrl: 'static/images/anzen_owl.png',
    imageWidth: 200, // You can adjust this value
    imageHeight: 200, // You can adjust this value
    background: '#000', // Set background to black
    color: '#fff',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes',
    cancelButtonText: 'Cancel',
        customClass: {
            popup: 'swal2-custom-border' // Apply custom class to the popup/dialog
        }
}).then((result) => {
    if (result.isConfirmed) {
        // User clicked 'Yes', proceed with the risk assessment
        executeRiskAssessment(buttonId, spinnerId);
    }
    // If user clicked 'Cancel', just exit (do nothing)
});


}

    function getCookie(name) {
        let value = "; " + document.cookie;
        let parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
    }

    $.ajaxSetup({
        headers: { "X-CSRFToken": getCookie("csrftoken") }
    });

    function submitRAActionForm() {
        $.ajax({
            type: "POST",
            url: "{% url 'OTRisk:save_ra_action' %}",
            data: $("#raActionsForm").serialize(),
            success: function(response) {
                if (response.status == "success") {
                    $("#RAActionsModal").modal('hide');
                    // Optionally, show a success message or perform other actions.
                } else {
                    alert("Error saving data!");
                }
            }
        });
    }

function abbreviateValue(value) {
    var newValue = value;
    if (value >= 1000 && value < 1000000) {
        newValue = "$" + (value / 1000).toFixed(1) + "k"; // Thousands
    } else if (value >= 1000000) {
        newValue = "$" + (value / 1000000).toFixed(1) + "m"; // Millions
    } else {
        newValue = "$" + value; // Less than 1000
    }
    return newValue;
}

        // Function to assign value with error handling
        function assignValueWithValidation(targetId, value) {
          const targetElement = document.getElementById(targetId);

          if (value !== null && value !== undefined) {
            targetElement.value = value;
          } else {
            console.error(`Invalid value for ${targetId}`);
          }
        }

function createCostChart(containerId, costArray) {
    console.log(costArray);
    var data = [];
    for (let i = 0; i < costArray.length; i++) {
        data.push({x: `Month ${i + 1}`, value: costArray[i]});
    }

    // Ensure the chart library is ready before creating the chart
    anychart.onDocumentReady(function() {
        // Clear the container before creating a new chart
        document.getElementById(containerId).innerHTML = '';

        var chart = anychart.column();
        chart.data(data);

        // Set the chart title
        chart.title("Monthly Cost Estimates");

        // Customize the X-axis labels
        var xAxis = chart.xAxis();
        xAxis.title("Month");
        xAxis.labels()
            .rotation(-70) // Angle the labels
            .fontSize(10); // Smaller font size

        // Customize the Y-axis
        var yAxis = chart.yAxis();
        yAxis.title("Cost in USD");

        var series = chart.getSeries(0);
        series.labels(true);
        series.labels()
            .position("above")
            .anchor("centerBottom")
            .fontSize(10)
            .format(function() {
                return abbreviateValue(this.value);
            });

        // Optionally disable credits if needed
        var credits = chart.credits();
        credits.enabled(false);

        // Draw the chart in the specified container
        chart.container(containerId);
        chart.draw();
    });
}

// Helper function to abbreviate large numbers
function abbreviateValue(value) {
    // Implement abbreviation logic here
    // For example, converting 1000 to "1K"
    // This is just a placeholder function
    return value; // Modify this according to your abbreviation logic
}

        // AJAX function to call the Django view
        function executeRiskAssessment(buttonID, spinnerID) {

            $('#' + spinnerID).show();
            var buttonNumber = buttonID.split('_')[1];
            var scenarioCountTextbox = document.querySelector('input[name="scenarioCount"]');




            // Check if the textbox value is null, empty, or less than buttonNumber
            if (!scenarioCountTextbox.value || scenarioCountTextbox.value < buttonNumber) {
                // Ensure the value does not exceed 5
                scenarioCountTextbox.value = Math.min(buttonNumber, 5);
            }
            setRiskAssessmentRefreshNotRequired(buttonNumber);
            // Gather the necessary data for the AJAX request (impact scores and scenario information)
            var scenario = document.getElementById('txtScenarioDescription_' + buttonNumber).value;
            var industry = document.getElementById('selectIndustry').value;
            var facilityType = document.getElementById('selectFacility').value;
            var revenue = document.getElementById('txtRevenue').value;

            if (!scenario || !industry || !facilityType || !revenue) {
                alert("Not enough data to execute risk assessment");
                $('#' + spinnerID).hide();
                return; // Exits the function
            }

            var safetyImpact = document.getElementById('range_safety_' + buttonNumber).value;
            var lifeImpact = document.getElementById('range_life_' + buttonNumber).value;
            var productionImpact = document.getElementById('range_production_' + buttonNumber).value;
            var financialImpact = document.getElementById('range_finance_' + buttonNumber).value;
            var reputationImpact = document.getElementById('range_reputation_' + buttonNumber).value;
            var environmentImpact = document.getElementById('range_environment_' + buttonNumber).value;
            var regulatoryImpact = document.getElementById('range_regulatory_' + buttonNumber).value;
            var supplyImpact = document.getElementById('range_supply_' + buttonNumber).value;
            var dataImpact = document.getElementById('range_data_' + buttonNumber).value;
            var threatSource = document.getElementById('selectThreat_' + buttonNumber).value;
            var threatTactic = document.getElementById('selectTactics_' + buttonNumber).value;
            var impact = document.getElementById('id_impact_' + buttonNumber).value;
            var vulnerabilityExposure = document.getElementById('range_vuln_' + buttonNumber).value;
            var threatExposure = document.getElementById('range_threat_' + buttonNumber).value;
            var assetStatus = document.getElementById('range_frequency_' + buttonNumber).value;
            var insurance = document.getElementById('txtInsurance').value;
            var deductable = document.getElementById('txtDeductable').value;
            var outage = document.getElementById('production_outage_' + buttonNumber).checked;
            var exposed_system = document.getElementById('exposed_system_' + buttonNumber).checked;
            var weak_credentials = document.getElementById('weak_credentials_' + buttonNumber).checked;
            var outageLength = document.getElementById('outage_' + buttonNumber).value;
            var consequences = document.getElementById('txtScenarioAnalysis_' + buttonNumber).value;
            var safeguardDescriptions = [];
            $('#table_safeguards tbody tr').each(function() {
                var description = $(this).find('textarea').eq(0).val(); // Assuming the first textarea is the Safeguard Description
                if (description) {
                    safeguardDescriptions.push(description);
                }
            });

            // Prepare the safeguards data for the AJAX request
            var safeguardsData;
            if (safeguardDescriptions.length === 0) {
                safeguardsData = "None defined";
            } else {
                // Join the descriptions with a separator if there are any
                safeguardsData = safeguardDescriptions.join('; ');
            }

            // Make the AJAX call to the Django view using a separate endpoint for risk assessment
            $.ajax({
                type: "GET",
                url: "{% url 'OTRisk:openai_assess_risk' %}",  // URL for the Django view
                data: {
                    // Pass the impact scores and scenario information as parameters
                    safety_impact: safetyImpact,
                    life_impact: lifeImpact,
                    production_impact: productionImpact,
                    financial_impact: financialImpact,
                    reputation_impact: reputationImpact,
                    environment_impact: environmentImpact,
                    regulatory_impact: regulatoryImpact,
                    data_impact: dataImpact,
                    supply_impact: supplyImpact,
                    threat_source: threatSource,
                    threat_tactic: threatTactic,
                    vulnerability_exposure: vulnerabilityExposure,
                    threat_exposure: threatExposure,
                    industry: industry,
                    facility_type: facilityType,
                    scenario: scenario,
                    assetStatus: assetStatus,
                    revenue: revenue,
                    insurance: insurance,
                    deductable: deductable,
                    outage: outage,
                    outageLength: outageLength,
                    impact: impact,
                    // controlScore: controlScore,
                    weak_credentials: weak_credentials,
                    exposed_system: exposed_system,
                    consequences: consequences,
                    safeguards: safeguardsData,
                 },
                success: function (response) {

                    // Extract the risk score and risk rating from the response
                    var riskRating = response[0];
                    var riskScore = response[1];
                    // var low_estimate = response[2];
                    // var high_estimate = response[3];
                    var riskSummary = response[2];
                    var executive_summary = response[4];
                    var costArray = riskSummary.split('|').map(Number);
                    console.log(riskSummary);
                    console.log(costArray);
                    document.getElementById('scenario_12month_costs_' + buttonNumber).value = riskSummary;
                    createCostChart('monthly_cost_chart_' + buttonNumber, costArray);


                    // var median_estimate = response[5];
                    // var risk_summary_array = response[6];
                    var damage = response[3];
                    // var riskSummaryArray = risk_summary_array;



                    $('#lblriskRating_' + buttonNumber).text(riskRating);
                    $('#lblinherentRisk_' + buttonNumber).text(riskScore);
                    $('#txtDamage_' + buttonNumber).val(damage);
                    $('#txtexec_summary_' + buttonNumber).val(executive_summary);


                    $('#lblriskSummary_' + buttonNumber).val(riskSummary);


                    $('#' + spinnerID).hide();


                    $('#' + spinnerID).hide();

                },
                error: function (xhr, status, error) {
                    // Handle any errors that occur during the AJAX call
                    console.error(error);
                    $('#' + spinnerID).hide();
                },
            });
        }


    document.addEventListener('DOMContentLoaded', function() {

      var rangeVuln2 = document.getElementById('range_vuln_2');
      var txtVuln2Container = document.getElementById('txtVuln_2_container');
      var txtVuln2 = document.getElementById('txtVuln_2');
      // var closeTxtVuln2 = document.getElementById('closeTxtVuln_2');

      rangeVuln2.addEventListener('click', function() {
        //txtVuln2Container.style.display = 'block';
      });

      //closeTxtVuln2.addEventListener('click', function() {
       // txtVuln2Container.style.display = 'none';
     // });
    });

  // Preserve input values when switching tabs
  $(document).ready(function() {
    $('a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
      var target = $(e.target).attr("href"); // Get the target tab id
      var previousTab = $(e.relatedTarget).attr("href"); // Get the previous tab id

      // Store the input values of the previous tab
      $(previousTab).find(':input').each(function() {
        var inputId = $(this).attr('id');
        var inputValue = $(this).val();
        localStorage.setItem(inputId, inputValue);
      });

      // Restore the input values of the target tab
      $(target).find(':input').each(function() {
        var inputId = $(this).attr('id');
        var savedValue = localStorage.getItem(inputId);
        if (savedValue !== null) {
          $(this).val(savedValue);
        }
      });
    });
  });

  $(document).ready(function(){
    $('#rawtable').dataTable( {
        "pageLength": 15,
            "lengthChange": false

    } );
});


$(document).ready(function() {
    $('#selectIndustry').select2();
});

$(document).ready(function() {
    $('#selectFacility').select2();
});

$(document).ready(function() {
    $('#selectTrigger').select2();
});

$(document).ready(function() {
    $('#selectStatus').select2();
});

//following code to load raw data and scenarios from the clicked raw record in the table
$(document).ready(function() {
    $('#rawtable').on('click', 'tbody tr', function() {

        handleAddNewClick(0)
         clearValues();

            sessionStorage.setItem('scenario1id', '');

            sessionStorage.setItem('scenario2id', '');

            sessionStorage.setItem('scenario3id', '');

            sessionStorage.setItem('scenario4id', '');

            sessionStorage.setItem('scenario5id', '');



        document.getElementById("txtScenarioDescription_1").value = "";

        document.getElementById("txtScenarioDescription_2").value = "";
        document.getElementById("scenario3-tab").click();
        document.getElementById("txtScenarioDescription_3").value = "";
        document.getElementById("txtScenarioDescription_4").value = "";
        document.getElementById("txtScenarioDescription_5").value = "";
        document.getElementById("txtAssets_1").value = "";
        document.getElementById("txtAssets_2").value = "";
        document.getElementById("txtAssets_3").value = "";
        document.getElementById("txtAssets_4").value = "";
        document.getElementById("txtAssets_5").value = "";
        document.getElementById("editBtn").disabled= false;
        document.getElementById("scenario1-tab").click();


        // Get the data from the clicked row
        var title = $(this).find('td:eq(1)').text();
        var businessUnit = $(this).find('td:eq(8)').text();
        var leader = $(this).find('td:eq(9)').text();
        var facility = $(this).find('td:eq(6)').text();
        var industry = $(this).find('td:eq(7)').text();
        var trigger = $(this).find('td:eq(5)').text();
        var status = $(this).find('td:eq(2)').text();
        var insurance = $(this).data('insurance');
        var revenue = $(this).data('revenue');
        var deductable = $(this).data('deductable');
        var raw_id = $(this).find('td:eq(0)').text();
         var approverId = $(this).data('approver-id');

        var currentUserId = $('#userId').val();
        var recordCreatorId = $(this).data('data_owner');
        var isSuperUser = $('#isSuperUser').val();
        var statusFlag = $(this).find('td:eq(2)').text().trim(); // Assuming the StatusFlag is in the third column
        var approverId = $(this).data('approver-id');

        var isCreatorOrSuperUser = (currentUserId == recordCreatorId || isSuperUser);
        var isCurrentApprover = (currentUserId == approverId);

        var showApproverDropdown = isCreatorOrSuperUser && statusFlag !== 'Approved' && statusFlag !== 'Closed';
        var showApprovalControls = isCurrentApprover && statusFlag !== 'Approved' && statusFlag !== 'Closed';


        // Show or hide the approver selection dropdown based on user role and status
        if (isCreatorOrSuperUser && statusFlag === 'Open') {
            $('#selectApprover').closest('.form-group').show();
        } else {
            $('#selectApprover').closest('.form-group').hide();
        }

        // Show or hide the approval controls
        if (isCurrentApprover && statusFlag !== 'Approved' && statusFlag !== 'Closed') {
            $('#approvalControls').show();
        } else {
            $('#approvalControls').hide();
        }

        // Hide the entire Workflow Management container if both dropdown and checkboxes are not visible
         if (!showApproverDropdown && !showApprovalControls) {
            $('.workflow-management-section').attr('style', 'visibility: hidden;');
        } else {
            $('.workflow-management-section').attr('style', 'display: block;');
        }


        document.getElementById("hdnRawID").value = raw_id;
        document.getElementById('hdntxtModalRAW').value = raw_id;
        sessionStorage.setItem('rawid',raw_id);
        sessionStorage.setItem('editMode','0');
        sessionStorage.setItem('addNew','0');
        sessionStorage.setItem('RATitle',title);
        sessionStorage.setItem('RABU',businessUnit);
        $('#editBtn').prop('disabled', false);

        // Dynamically set the href attribute of the link
        var newHref = "{% url 'OTRisk:rawreport' raworksheet_id=0 %}".replace('0', raw_id);
        $('#generateReportLink').attr('href', newHref);

        // Set the values of the form controls
        $('#txtTitle').val(title);
        $('#txtBU').val(businessUnit);
        $('#txtLeader').val(leader);
        $('#selectFacility').val(facility).trigger('change'); // Use .trigger('change') to update the Select2 control
        $('#selectIndustry').val(industry).trigger('change'); // Use .trigger('change') to update the Select2 control
        $('#selectTrigger').val(trigger).trigger('change'); // Use .trigger('change') to update the Select2 control
        $('#selectStatus').val(status).trigger('change');
        $('#txtRevenue').val(revenue.toLocaleString('en-US', {
            style: 'currency',
            currency: 'USD',
            maximumFractionDigits: 0 // To ensure no decimal point
        }));

        $('#txtInsurance').val(insurance.toLocaleString('en-US', {
            style: 'currency',
            currency: 'USD',
            maximumFractionDigits: 0 // To ensure no decimal point
        }));

        $('#txtDeductable').val(deductable.toLocaleString('en-US', {
            style: 'currency',
            currency: 'USD',
            maximumFractionDigits: 0 // To ensure no decimal point
        }));

        // Send an AJAX request to get the matching scenarios
        $.ajax({
            url: '/OTRisk/get_scenarios/',
            data: {
                'raw_id': raw_id
            },
            dataType: 'json',

            success: function(data) {
                var scenarios = data.scenarios;
                var safeguards = data.safeguards;
                document.getElementById("scenarioCount").value = scenarios.length;
                 // Clear existing icons before appending new ones
                for (var j = 1; j <= 5; j++) {
                    $('#scenario' + j + '-tab').find('.bi-check-square').remove();
                }

                for (var i = 1; i <= scenarios.length && i <= 5; i++) {
                    // Create the icon element
                    var iconHtml = '<i class="bi bi-check-square"></i>';

                    // Append the icon to the tab link
                    $('#scenario' + i + '-tab').append(' ' + iconHtml);
                }

                if (scenarios.length >= 2) {
                    document.getElementById("scenario2-tab").click();
                    document.getElementById("scenarioCount").value = "2";
                    document.getElementById("hdnScenarioID_2").value = scenarios[1].pk;
                    sessionStorage.setItem('scenario2id', scenarios[1].pk);
                    document.getElementById("txtScenarioDescription_2").value = scenarios[1].fields.ScenarioDescription;
                    document.getElementById("txtScenarioAnalysis_2").value = scenarios[1].fields.raw_consequences;
                    document.getElementById("selectThreat_2").value = scenarios[1].fields.threatSource;
                    document.getElementById("selectTactics_2").value = scenarios[1].fields.threatTactic;
                    document.getElementById("id_impact_2").value = scenarios[1].fields.impact;
                    document.getElementById('exposed_system_2').checked = scenarios[1].fields.exposed_system;
                    document.getElementById('weak_credentials_2').checked = scenarios[1].fields.weak_credentials;
                    document.getElementById("lblriskSummary_2").value = scenarios[1].fields.riskSummary;
                    document.getElementById("range_safety_2").value = scenarios[1].fields.SafetyScore;
                    initSlider('range_safety_2', 'safetyrange_2')
                    document.getElementById("range_life_2").value = scenarios[1].fields.lifeScore;
                    initSlider('range_life_2', 'liferange_2')
                    document.getElementById("range_production_2").value = scenarios[1].fields.productionScore;
                    initSlider('range_production_2', 'productionrange_2')
                    document.getElementById("range_finance_2").value = scenarios[1].fields.FinancialScore;
                    initSlider('range_finance_2', 'financerange_2')
                    document.getElementById("range_reputation_2").value = scenarios[1].fields.ReputationScore;
                    initSlider('range_reputation_2', 'reputationrange_2')
                    document.getElementById("range_environment_2").value = scenarios[1].fields.environmentScore;
                    initSlider('range_environment_2', 'environmentrange_1')
                    document.getElementById("range_regulatory_2").value = scenarios[1].fields.regulatoryScore;
                    initSlider('range_regulatory_2', 'regulatoryrange_2')
                    document.getElementById("range_supply_2").value = scenarios[1].fields.SupplyChainScore;
                    initSlider('range_supply_2', 'supplyrange_2')
                    document.getElementById("range_data_2").value = scenarios[1].fields.DataScore;
                    initSlider('range_data_2', 'datarange_2')
                    document.getElementById("range_vuln_2").value = scenarios[1].fields.VulnScore;
                    initSlider('range_vuln_2', 'vulnrange_2')
                    document.getElementById("range_threat_2").value = scenarios[1].fields.ThreatScore;
                    initSlider('range_threat_2', 'threatrange_2');
                    document.getElementById("txtAssets_2").value = scenarios[1].fields.notes;
                    document.getElementById("txtsafetyJustify_2").value = scenarios[1].fields.justifySafety;
                    document.getElementById("txtlifeJustify_2").value = scenarios[1].fields.justifyLife;
                    document.getElementById("txtproductionJustify_2").value = scenarios[1].fields.justifyProduction;
                    document.getElementById("txtfinanceJustify_2").value = scenarios[1].fields.justifyFinancial;
                    document.getElementById("txtreputationJustify_2").value = scenarios[1].fields.justifyReputation;
                    document.getElementById("txtenvironmentJustify_2").value = scenarios[1].fields.justifyEnvironment;
                    document.getElementById("txtregulationJustify_2").value = scenarios[1].fields.justifyRegulation;
                    document.getElementById("txtdataJustify_2").value = scenarios[1].fields.justifyData;
                    document.getElementById("txtsupplyJustify_2").value = scenarios[1].fields.justifySupply;
                    document.getElementById("txtDamage_2").value = scenarios[1].fields.scenario_damage;
                    document.getElementById("txtexec_summary_2").value = scenarios[1].fields.executive_summary;
                    document.getElementById("scenario_12month_costs_2").value = scenarios[1].fields.scenario_12month_costs;
                    document.getElementById("lblriskRating_2").textContent = scenarios[1].fields.RiskStatus;

                    document.getElementById("lblinherentRisk_2").textContent = scenarios[1].fields.residual_risk;
                    document.getElementById("txtResidualRisk_2").value = scenarios[1].fields.residual_risk;
                    var residualRisk = scenarios[1].fields.residual_risk;
                    var riskText = "";

                        // Determine the risk text based on the value of residual risk
                        if (residualRisk >= 0 && residualRisk <= 2) {
                            riskText = "Low";
                        } else if (residualRisk === 3 || residualRisk === 4) {
                            riskText = "Low/Medium";
                        } else if (residualRisk === 5 || residualRisk === 6) {
                            riskText = "Medium";
                        } else if (residualRisk === 7) {
                            riskText = "Medium/High";
                        } else if (residualRisk === 8 || residualRisk === 9) {
                            riskText = "High";
                        } else if (residualRisk === 10) {
                            riskText = "Very High";
                        }

                       document.getElementById("lblinherentRisk_2").textContent = riskText;
                       try {
                           var costArray = scenarios[1].fields.scenario_12month_costs.split('|').map(Number);
                           createCostChart('monthly_cost_chart_2', costArray);
                       }
                       catch (e){}

                          // Assuming 'safeguards' is the variable holding the safeguards data received from the server
                        var scenarioId = scenarios[1].pk; // The ID of the currently selected scenario
                        var scenarioSafeguards = safeguards[scenarioId]; // The safeguards for the selected scenario

                        // Find the table where you want to add the safeguards
                        var safeguardsTableBody = document.getElementById('table_safeguards_2').getElementsByTagName('tbody')[0];

                        // Clear existing rows in the table
                        safeguardsTableBody.innerHTML = '';

                        // Check if there are safeguards for the selected scenario
                        if (scenarioSafeguards && scenarioSafeguards.length > 0) {
                            // Iterate over each safeguard and add it to the table as editable rows
                            scenarioSafeguards.forEach(function(safeguard) {
                                var newRow = `<tr>
                                    <td><textarea class="form-control" maxlength="255">${safeguard.fields.safeguard_description}</textarea></td>
                                    <td><textarea class="form-control" maxlength="100">${safeguard.fields.safeguard_type}</textarea></td>
                                    <td><button type="button" class="btn btn-danger btn-sm deleteRowBtn">Delete</button></td>
                                </tr>`;
                                $(safeguardsTableBody).append(newRow);
                            });
                        } else {

                        }

                        // Reattach the event handler for delete buttons in case it was cleared with innerHTML = ''
                        $("#table_safeguards_2").on("click", ".deleteRowBtn", function() {
                            $(this).closest("tr").remove();
                        });


                        disableAllControls();
                    loadActions(raw_id)


                      }

                  if (scenarios.length >= 3) {
                      document.getElementById("scenarioCount").value = "3";
                      document.getElementById("scenario3-tab").click();
                      document.getElementById("hdnScenarioID_3").value = scenarios[2].pk;
                      sessionStorage.setItem('scenario3id',scenarios[2].pk);
                      document.getElementById("txtScenarioDescription_3").value = scenarios[2].fields.ScenarioDescription;
                      document.getElementById("txtScenarioAnalysis_3").value = scenarios[2].fields.raw_consequences;
                      document.getElementById("selectThreat_3").value = scenarios[2].fields.threatSource;
                      document.getElementById("selectTactics_3").value = scenarios[2].fields.threatTactic;
                      document.getElementById("id_impact_3").value = scenarios[2].fields.impact;
                      var outageValue = scenarios[2].fields.outage === "true";
                        // Set the checkbox checked property based on the outage value
                      document.getElementById("production_outage_3").checked = outageValue;
                      document.getElementById("outage_3").value = scenarios[2].fields.outageLength;
                      document.getElementById('exposed_system_3').checked = scenarios[2].fields.exposed_system;
                        document.getElementById('weak_credentials_3').checked = scenarios[2].fields.weak_credentials;

                     document.getElementById("lblriskRating_3").value = scenarios[2].fields.RiskStatus;
                     document.getElementById("lblriskSummary_3").value = scenarios[2].fields.riskSummary;



                      document.getElementById("range_safety_3").value = scenarios[2].fields.SafetyScore;
                      initSlider('range_safety_3', 'safetyrange_3')
                      document.getElementById("range_life_3").value = scenarios[2].fields.lifeScore;
                      initSlider('range_life_3', 'liferange_3')
                      document.getElementById("range_production_3").value = scenarios[2].fields.productionScore;
                      initSlider('range_production_3', 'productionrange_3')
                      document.getElementById("range_finance_3").value = scenarios[2].fields.FinancialScore;
                      initSlider('range_finance_3', 'financerange_3')
                      document.getElementById("range_reputation_3").value = scenarios[2].fields.ReputationScore;
                      initSlider('range_reputation_3', 'reputationrange_3')
                      document.getElementById("range_environment_3").value = scenarios[2].fields.environmentScore;
                      initSlider('range_environment_3', 'environmentrange_3')
                      document.getElementById("range_regulatory_3").value = scenarios[2].fields.regulatoryScore;
                      initSlider('range_regulatory_3', 'regulatoryrange_3')
                      document.getElementById("range_supply_3").value = scenarios[2].fields.SupplyChainScore;
                      initSlider('range_supply_3', 'supplyrange_3')
                      document.getElementById("range_data_3").value = scenarios[2].fields.DataScore;
                      initSlider('range_data_3', 'datarange_3')
                      document.getElementById("range_vuln_3").value = scenarios[2].fields.VulnScore;
                      initSlider('range_vuln_3', 'vulnrange_3')
                      document.getElementById("range_threat_3").value = scenarios[2].fields.ThreatScore;
                      initSlider('range_threat_3', 'threatrange_3')
                      document.getElementById("txtAssets_3").value = scenarios[2].fields.notes;
                      document.getElementById("txtsafetyJustify_3").value = scenarios[2].fields.justifySafety;
                      document.getElementById("txtlifeJustify_3").value = scenarios[2].fields.justifyLife;
                      document.getElementById("txtproductionJustify_3").value = scenarios[2].fields.justifyProduction;
                      document.getElementById("txtfinanceJustify_3").value = scenarios[2].fields.justifyFinancial;
                      document.getElementById("txtreputationJustify_3").value = scenarios[2].fields.justifyReputation;
                      document.getElementById("txtenvironmentJustify_3").value = scenarios[2].fields.justifyEnvironment;
                      document.getElementById("txtregulationJustify_3").value = scenarios[2].fields.justifyRegulation;
                      document.getElementById("txtdataJustify_3").value = scenarios[2].fields.justifyData;
                      document.getElementById("txtsupplyJustify_3").value = scenarios[2].fields.justifySupply;
                      var costArray = scenarios[2].fields.scenario_12month_costs.split('|').map(Number);
                      createCostChart('monthly_cost_chart_2', costArray);

                      }
                  if (scenarios.length >= 4) {
                      document.getElementById("scenarioCount").value = "4";
                      document.getElementById("scenario4-tab").click();
                      document.getElementById("hdnScenarioID_4").value = scenarios[3].pk;
                      sessionStorage.setItem('scenario4id',scenarios[3].pk);
                      document.getElementById("txtScenarioDescription_4").value = scenarios[3].fields.ScenarioDescription;
                      document.getElementById("txtScenarioAnalysis_4").value = scenarios[3].fields.raw_consequences;
                      document.getElementById("selectThreat_4").value = scenarios[3].fields.threatSource;
                      document.getElementById("selectTactics_4").value = scenarios[3].fields.threatTactic;
                      document.getElementById("id_impact_4").value = scenarios[3].fields.impact;
                      var outageValue = scenarios[3].fields.outage === "true";
                        // Set the checkbox checked property based on the outage value
                      document.getElementById("production_outage_4").checked = outageValue;
                      document.getElementById("outage_4").value = scenarios[3].fields.outageLength;
                      document.getElementById('exposed_system_4').checked = scenarios[3].fields.exposed_system;
                      document.getElementById('weak_credentials_4').checked = scenarios[3].fields.weak_credentials;

                     document.getElementById("lblriskRating_4").value = scenarios[3].fields.RiskStatus;
                     document.getElementById("lblriskSummary_4").value = scenarios[3].fields.riskSummary;



                      document.getElementById("range_safety_4").value = scenarios[3].fields.SafetyScore;
                      initSlider('range_safety_4', 'safetyrange_4')
                      document.getElementById("range_life_4").value = scenarios[3].fields.lifeScore;
                      initSlider('range_life_4', 'liferange_4')
                      document.getElementById("range_production_4").value = scenarios[3].fields.productionScore;
                      initSlider('range_production_4', 'productionrange_4')
                      document.getElementById("range_finance_4").value = scenarios[3].fields.FinancialScore;
                      initSlider('range_finance_4', 'financerange_4')
                      document.getElementById("range_reputation_4").value = scenarios[3].fields.ReputationScore;
                      initSlider('range_reputation_4', 'reputationrange_4')
                      document.getElementById("range_environment_4").value = scenarios[3].fields.environmentScore;
                      initSlider('range_environment_4', 'environmentrange_4')
                      document.getElementById("range_regulatory_4").value = scenarios[3].fields.regulatoryScore;
                      initSlider('range_regulatory_4', 'regulatoryrange_4')
                      document.getElementById("range_supply_4").value = scenarios[3].fields.SupplyChainScore;
                      initSlider('range_supply_4', 'supplyrange_4')
                      document.getElementById("range_data_4").value = scenarios[3].fields.DataScore;
                      initSlider('range_data_4', 'datarange_4')
                      document.getElementById("range_vuln_4").value = scenarios[3].fields.VulnScore;
                      initSlider('range_vuln_4', 'vulnrange_4')
                      document.getElementById("range_threat_4").value = scenarios[3].fields.ThreatScore;
                      initSlider('range_threat_4', 'threatrange_4')
                      document.getElementById("txtAssets_4").value = scenarios[3].fields.notes;
                      document.getElementById("txtsafetyJustify_4").value = scenarios[3].fields.justifySafety;
                      document.getElementById("txtlifeJustify_4").value = scenarios[3].fields.justifyLife;
                      document.getElementById("txtproductionJustify_4").value = scenarios[3].fields.justifyProduction;
                      document.getElementById("txtfinanceJustify_4").value = scenarios[3].fields.justifyFinancial;
                      document.getElementById("txtreputationJustify_4").value = scenarios[3].fields.justifyReputation;
                      document.getElementById("txtenvironmentJustify_4").value = scenarios[3].fields.justifyEnvironment;
                      document.getElementById("txtregulationJustify_4").value = scenarios[3].fields.justifyRegulation;
                      document.getElementById("txtdataJustify_4").value = scenarios[3].fields.justifyData;
                      document.getElementById("txtsupplyJustify_4").value = scenarios[3].fields.justifySupply;
                        var costArray = scenarios[3].fields.scenario_12month_costs.split('|').map(Number);
                          createCostChart('monthly_cost_chart_4', costArray);

                      }
                  if (scenarios.length >= 5) {
                      document.getElementById("scenarioCount").value = "5";
                      document.getElementById("scenario5-tab").click();
                      document.getElementById("hdnScenarioID_5").value = scenarios[4].pk;
                      sessionStorage.setItem('scenario5id',scenarios[4].pk);
                      document.getElementById("txtScenarioDescription_5").value = scenarios[4].fields.ScenarioDescription;
                      document.getElementById("txtScenarioAnalysis_5").value = scenarios[4].fields.raw_consequences;
                      document.getElementById("selectThreat_5").value = scenarios[4].fields.threatSource;
                      document.getElementById("selectTactics_5").value = scenarios[4].fields.threatTactic;
                      document.getElementById("id_impact_5").value = scenarios[4].fields.impact;
                      var outageValue = scenarios[4].fields.outage === "true";
                        // Set the checkbox checked property based on the outage value
                      document.getElementById("production_outage_5").checked = outageValue;
                      document.getElementById("outage_5").value = scenarios[4].fields.outageLength;
                      document.getElementById('exposed_system_5').checked = scenarios[4].fields.exposed_system;
                      document.getElementById('weak_credentials_5').checked = scenarios[4].fields.weak_credentials;

                      document.getElementById("lblriskRating_5").value = scenarios[4].fields.RiskStatus;
                      document.getElementById("lblriskSummary_5").value = scenarios[4].fields.riskSummary;



                      document.getElementById("range_safety_5").value = scenarios[4].fields.SafetyScore;
                      initSlider('range_safety_5', 'safetyrange_5')
                      document.getElementById("range_life_5").value = scenarios[4].fields.lifeScore;
                      initSlider('range_life_5', 'liferange_5')
                      document.getElementById("range_production_5").value = scenarios[4].fields.productionScore;
                      initSlider('range_production_5', 'productionrange_5')
                      document.getElementById("range_finance_5").value = scenarios[4].fields.FinancialScore;
                      initSlider('range_finance_5', 'financerange_5')
                      document.getElementById("range_reputation_5").value = scenarios[4].fields.ReputationScore;
                      initSlider('range_reputation_5', 'reputationrange_5')
                      document.getElementById("range_environment_5").value = scenarios[4].fields.environmentScore;
                      initSlider('range_environment_5', 'environmentrange_5')
                      document.getElementById("range_regulatory_5").value = scenarios[4].fields.regulatoryScore;
                      initSlider('range_regulatory_5', 'regulatoryrange_5')
                      document.getElementById("range_supply_5").value = scenarios[4].fields.SupplyChainScore;
                      initSlider('range_supply_5', 'supplyrange_5')
                      document.getElementById("range_data_5").value = scenarios[4].fields.DataScore;
                      initSlider('range_data_5', 'datarange_5')
                      document.getElementById("range_vuln_5").value = scenarios[4].fields.VulnScore;
                      initSlider('range_vuln_5', 'vulnrange_5')
                      document.getElementById("range_threat_5").value = scenarios[4].fields.ThreatScore;
                      initSlider('range_threat_5', 'threatrange_5');
                      document.getElementById("txtAssets_5").value = scenarios[4].fields.notes;
                      document.getElementById("txtsafetyJustify_5").value = scenarios[4].fields.justifySafety;
                      document.getElementById("txtlifeJustify_5").value = scenarios[4].fields.justifyLife;
                      document.getElementById("txtproductionJustify_5").value = scenarios[4].fields.justifyProduction;
                      document.getElementById("txtfinanceJustify_5").value = scenarios[4].fields.justifyFinancial;
                      document.getElementById("txtreputationJustify_5").value = scenarios[4].fields.justifyReputation;
                      document.getElementById("txtenvironmentJustify_5").value = scenarios[4].fields.justifyEnvironment;
                      document.getElementById("txtregulationJustify_5").value = scenarios[4].fields.justifyRegulation;
                      document.getElementById("txtdataJustify_5").value = scenarios[4].fields.justifyData;
                      document.getElementById("txtsupplyJustify_5").value = scenarios[4].fields.justifySupply;
                        var costArray = scenarios[4].fields.scenario_12month_costs.split('|').map(Number);
                          createCostChart('monthly_cost_chart_5', costArray);

                      }
                try {
                    document.getElementById("scenario1-tab").click();
                     if (scenarios && scenarios.length > 0 && scenarios[0]) {
                         document.getElementById("hdnScenarioID_1").value = scenarios[0].pk;

                         sessionStorage.setItem('scenario1id', scenarios[0].pk);
                         document.getElementById("txtScenarioDescription_1").value = scenarios[0].fields.ScenarioDescription;
                         document.getElementById("txtScenarioAnalysis_1").value = scenarios[0].fields.raw_consequences;
                         document.getElementById("selectThreat_1").value = scenarios[0].fields.threatSource;
                         document.getElementById("selectTactics_1").value = scenarios[0].fields.threatTactic;
                         document.getElementById("id_impact_1").value = scenarios[0].fields.impact;
                         var outageValue = scenarios[0].fields.outage === "true";
                        // Set the checkbox checked property based on the outage value
                        document.getElementById("production_outage_1").checked = outageValue;
                         document.getElementById('exposed_system_1').checked = scenarios[0].fields.exposed_system;
                         document.getElementById('weak_credentials_1').checked = scenarios[0].fields.weak_credentials;
                         //document.getElementById("outage_1").value = scenarios[0].fields.outageLength;

                         document.getElementById("lblriskSummary_1").value = scenarios[0].fields.riskSummary;

                         document.getElementById("range_safety_1").value = scenarios[0].fields.SafetyScore;
                         initSlider('range_safety_1', 'safetyrange_1')
                         document.getElementById("range_life_1").value = scenarios[0].fields.lifeScore;
                         initSlider('range_life_1', 'liferange_1')
                         document.getElementById("range_production_1").value = scenarios[0].fields.productionScore;
                         initSlider('range_production_1', 'productionrange_1')
                         document.getElementById("range_finance_1").value = scenarios[0].fields.FinancialScore;
                         initSlider('range_finance_1', 'financerange_1')
                         document.getElementById("range_reputation_1").value = scenarios[0].fields.ReputationScore;
                         initSlider('range_reputation_1', 'reputationrange_1')
                         document.getElementById("range_environment_1").value = scenarios[0].fields.environmentScore;
                         initSlider('range_environment_1', 'environmentrange_1')
                         document.getElementById("range_regulatory_1").value = scenarios[0].fields.regulatoryScore;
                         initSlider('range_regulatory_1', 'regulatoryrange_1')
                         document.getElementById("range_supply_1").value = scenarios[0].fields.SupplyChainScore;
                         initSlider('range_supply_1', 'supplyrange_1')
                         document.getElementById("range_data_1").value = scenarios[0].fields.DataScore;
                         initSlider('range_data_1', 'datarange_1')
                         document.getElementById("range_vuln_1").value = scenarios[0].fields.VulnScore;
                         initSlider('range_vuln_1', 'vulnrange_1')
                         document.getElementById("range_threat_1").value = scenarios[0].fields.ThreatScore;
                         initSlider('range_threat_1', 'threatrange_1');
                         document.getElementById("txtAssets_1").value = scenarios[0].fields.notes;
                         document.getElementById("txtsafetyJustify_1").value = scenarios[0].fields.justifySafety;
                         document.getElementById("txtlifeJustify_1").value = scenarios[0].fields.justifyLife;
                          document.getElementById("txtproductionJustify_1").value = scenarios[0].fields.justifyProduction;
                          document.getElementById("txtfinanceJustify_1").value = scenarios[0].fields.justifyFinancial;
                          document.getElementById("txtreputationJustify_1").value = scenarios[0].fields.justifyReputation;
                          document.getElementById("txtenvironmentJustify_1").value = scenarios[0].fields.justifyEnvironment;
                          document.getElementById("txtregulationJustify_1").value = scenarios[0].fields.justifyRegulation;
                          document.getElementById("txtdataJustify_1").value = scenarios[0].fields.justifyData;
                          document.getElementById("txtsupplyJustify_1").value = scenarios[0].fields.justifySupply;
                          document.getElementById("txtDamage_1").value = scenarios[0].fields.scenario_damage;
                          document.getElementById("txtexec_summary_1").value = scenarios[0].fields.executive_summary;
                          document.getElementById("scenario_12month_costs_1").value = scenarios[0].fields.scenario_12month_costs;
                          document.getElementById("lblriskRating_1").textContent = scenarios[0].fields.RiskStatus;

                          document.getElementById("lblinherentRisk_1").textContent = scenarios[0].fields.residual_risk;
                          document.getElementById("txtResidualRisk_1").value = scenarios[0].fields.residual_risk;
                          var residualRisk = scenarios[0].fields.residual_risk; // Assuming this is an integer
                            var riskText = ""; // Initialize the risk text variable

                            // Determine the risk text based on the value of residual risk
                            if (residualRisk >= 0 && residualRisk <= 2) {
                                riskText = "Low";
                            } else if (residualRisk === 3 || residualRisk === 4) {
                                riskText = "Low/Medium";
                            } else if (residualRisk === 5 || residualRisk === 6) {
                                riskText = "Medium";
                            } else if (residualRisk === 7) {
                                riskText = "Medium/High";
                            } else if (residualRisk === 8 || residualRisk === 9) {
                                riskText = "High";
                            } else if (residualRisk === 10) {
                                riskText = "Very High";
                            }

                            // Set the text content of lblinherentRisk_1 to the determined risk text
                            document.getElementById("lblinherentRisk_1").textContent = riskText;

                          var costArray = scenarios[0].fields.scenario_12month_costs.split('|').map(Number);
                          createCostChart('monthly_cost_chart_1', costArray);

                          // Assuming 'safeguards' is the variable holding the safeguards data received from the server
                                var scenarioId = scenarios[0].pk; // The ID of the currently selected scenario
                                var scenarioSafeguards = safeguards[scenarioId]; // The safeguards for the selected scenario

                                // Find the table where you want to add the safeguards
                                var safeguardsTableBody = document.getElementById('table_safeguards_1').getElementsByTagName('tbody')[0];

                                // Clear existing rows in the table
                                safeguardsTableBody.innerHTML = '';

                                // Check if there are safeguards for the selected scenario
                                if (scenarioSafeguards && scenarioSafeguards.length > 0) {
                                    // Iterate over each safeguard and add it to the table as editable rows
                                    scenarioSafeguards.forEach(function(safeguard) {
                                        var newRow = `<tr>
                                            <td><textarea class="form-control" maxlength="255">${safeguard.fields.safeguard_description}</textarea></td>
                                            <td><textarea class="form-control" maxlength="100">${safeguard.fields.safeguard_type}</textarea></td>
                                            <td><button type="button" class="btn btn-danger btn-sm deleteRowBtn">Delete</button></td>
                                        </tr>`;
                                        $(safeguardsTableBody).append(newRow);
                                    });
                                } else {

                                }

                                // Reattach the event handler for delete buttons in case it was cleared with innerHTML = ''
                                $("#table_safeguards_1").on("click", ".deleteRowBtn", function() {
                                    $(this).closest("tr").remove();
                                });


                        disableAllControls();
                        var isExternalReferrer = {{ is_external_referrer|lower }};

                        $('.tab-content').removeClass('active').hide();

                        if (!sessionStorage.getItem('handledExternalReferrer')) {
                        if (isExternalReferrer) {
                            sessionStorage.setItem('handledExternalReferrer', 'true');
                            $('#tab1').addClass('active').show();
                        } else {
                            // Otherwise, show tab2
                            $('#tab2').addClass('active').show();
                        }
                        // Mark that we've handled the external referrer

                    } else {
                        // If already handled, default to showing tab2 or other logic
                        $('#tab2').addClass('active').show();
                    }

                         //now load the action items table
                     } else {
                        // console.warn("");
                     }

                    loadActions(raw_id);
                    // $('.tab-content').removeClass('active').hide();
                    // $('#tab1').addClass('active').show();
                } catch (error){
                      console.log(error);
                }
                 }
        });
    });

});

function loadActions(rawID) {
    $.ajax({
        url: '/OTRisk/get_rawactions/',
        data: {
            'raw_id': rawID
        },
        dataType: 'json',
        success: function(actions) {
            // Clear existing rows
            $("#actiontable tbody").empty();

            // Populate table with new rows
            actions.forEach(function(action) {
                var row = '<tr>' +
                    '<td>' + action.ID + '</td>' +
                    '<td>' + action.actionTitle + '</td>' +
                    '<td>' + action.actionDescription + '</td>' +
                    '<td>' + action.actionStatus + '</td>' +
                    '<td>' + action.actionPriority + '</td>' +
                    '<td>' + action.actionOwner + '</td>' +
                    // Add more <td> elements for each field in the RAActions model
                    '</tr>';
                $("#actiontable tbody").append(row);
            });
        }
    });
}

function initFrequencySlider(sliderId, outputId) {
    var slider = document.getElementById(sliderId);
    var output = document.getElementById(outputId);

    switch (parseInt(slider.value)) {
        case 1:
            output.innerHTML = "New / Hardened";
            break;
        case 2:
            output.innerHTML = "New / Hardened";
            break;
        case 3:
            output.innerHTML = "Current / Managed";
            break;
        case 4:
            output.innerHTML = "Current / Managed";
            break;
        case 5:
            output.innerHTML = "Aging / Supported";
            break;
        case 6:
            output.innerHTML = "Aging / Supported";
            break;
        case 7:
            output.innerHTML = "Legacy / Unmanaged";
            break;
        case 8:
            output.innerHTML = "Legacy / Unmanaged";
            break;
        case 9:
            output.innerHTML = "Obselete";
            break;
        case 10:
            output.innerHTML = "Obselete";
            break;
    }
}


  function initSlider(sliderId, outputId) {
    var slider = document.getElementById(sliderId);
    var output = document.getElementById(outputId);

    // Display the default slider value
    output.innerHTML = getSeverityLabel(slider.value);

    // Update the current slider value (each time you drag the slider handle)
    slider.oninput = function() {
      output.innerHTML = getSeverityLabel(this.value);
      // calculateRiskScore();
    };
  }

  function getSeverityLabel(value) {
    switch (parseInt(value)) {
      case 1:
        case 2:
        return "Low";
      case 3:
        case 4:
        return "Low/Medium";
      case 5:
        case 6:
        return "Medium";
      case 7:
        case 8:
        return "Medium/High";
      case 9:
        case 10:
        return "High";
      default:
        return "";
    }
  }



    function clearValues(){

      document.getElementById("scenario2-tab").click();
      document.getElementById("hdnScenarioID_2").value = '';
      document.getElementById("txtScenarioDescription_2").value = '';
      document.getElementById("txtScenarioAnalysis_2").value = '';
      document.getElementById("selectThreat_2").value = '';
      document.getElementById("selectTactics_2").value = '';
        document.getElementById("id_impact_2").value = '';
      document.getElementById("range_safety_2").value = 0;
      initSlider('range_safety_2', 'safetyrange_2')
      document.getElementById("range_life_2").value = 0;
      initSlider('range_life_2', 'liferange_2')
      document.getElementById("range_production_2").value = 0;
      initSlider('range_production_2', 'productionrange_2')
      document.getElementById("range_finance_2").value = 0;
      initSlider('range_finance_1', 'financerange_2')
      document.getElementById("range_reputation_2").value = 0;
      initSlider('range_reputation_2', 'reputationrange_2')
      document.getElementById("range_environment_2").value = 0;
      initSlider('range_environment_2', 'environmentrange_2')
      document.getElementById("range_regulatory_2").value = 0;
      initSlider('range_regulatory_2', 'regulatoryrange_2')
        document.getElementById("range_supply_2").value = 0;
      initSlider('range_supply_2', 'supplyrange_2')
      document.getElementById("range_data_2").value = 0;
      initSlider('range_data_2', 'datarange_2')
      document.getElementById("range_vuln_2").value = 0;
      initSlider('range_vuln_2', 'vulnrange_2')
      document.getElementById("range_threat_2").value = 0;
      initSlider('range_threat_2', 'threatrange_2')
      document.getElementById("txtAssets_2").value = '';
      document.getElementById("lblriskRating_2").value = '';

      document.getElementById("lblriskSummary_2").value = '';
      document.getElementById("production_outage_2").checked = false;
      document.getElementById('exposed_system_2').checked = false;
      document.getElementById('weak_credentials_2').checked = false;
      document.getElementById("outage_2").value = 0;


      document.getElementById("scenarioCount").value = '';
      document.getElementById("scenario3-tab").click();
      document.getElementById("hdnScenarioID_3").value = 0;
      document.getElementById("txtScenarioDescription_3").value = '';
      document.getElementById("txtScenarioAnalysis_3").value = '';
      document.getElementById("selectThreat_3").value = '';
      document.getElementById("selectTactics_3").value = '';
        document.getElementById("id_impact_3").value = '';
      document.getElementById("range_safety_3").value = 0;
      initSlider('range_safety_3', 'safetyrange_3')
      document.getElementById("range_life_3").value = 0;
      initSlider('range_life_3', 'liferange_3')
      document.getElementById("range_production_3").value = 0;
      initSlider('range_production_3', 'productionrange_3')
      document.getElementById("range_finance_3").value = 0;
      initSlider('range_finance_3', 'financerange_3')
      document.getElementById("range_reputation_3").value = 0;
      initSlider('range_reputation_3', 'reputationrange_3')
      document.getElementById("range_environment_3").value = 0;
      initSlider('range_environment_3', 'environmentrange_3')
      document.getElementById("range_regulatory_3").value = 0;
      initSlider('range_regulatory_3', 'regulatoryrange_3')
        document.getElementById("range_supply_3").value = 0;
      initSlider('range_supply_3', 'supplyrange_3')
      document.getElementById("range_data_3").value = 0;
      initSlider('range_data_3', 'datarange_3')
      document.getElementById("range_vuln_3").value = 0;
      initSlider('range_vuln_3', 'vulnrange_3')
      document.getElementById("range_threat_3").value = 0;
      initSlider('range_threat_3', 'threatrange_3')
      document.getElementById("txtAssets_3").value = '';
      document.getElementById("lblriskRating_3").value = '';

      document.getElementById("lblriskSummary_3").value = '';
      document.getElementById("production_outage_3").checked = false;
      document.getElementById('exposed_system_3').checked = false;
      document.getElementById('weak_credentials_3').checked = false;
      document.getElementById("outage_3").value = 0;


      document.getElementById("scenarioCount").value = "";
      document.getElementById("scenario4-tab").click();
      document.getElementById("hdnScenarioID_4").value = 0;
      document.getElementById("txtScenarioDescription_4").value = '';
      document.getElementById("txtScenarioAnalysis_4").value = '';
      document.getElementById("selectThreat_4").value = '';
      document.getElementById("selectTactics_4").value = '';
        document.getElementById("id_impact_4").value = '';
      document.getElementById("range_safety_4").value = 0;
      initSlider('range_safety_4', 'safetyrange_4')
      document.getElementById("range_life_4").value = 0;
      initSlider('range_life_4', 'liferange_4')
      document.getElementById("range_production_4").value = 0;
      initSlider('range_production_4', 'productionrange_4')
      document.getElementById("range_finance_4").value = 0;
      initSlider('range_finance_4', 'financerange_4')
      document.getElementById("range_reputation_4").value = 0;
      initSlider('range_reputation_4', 'reputationrange_4')
      document.getElementById("range_environment_4").value = 0;
      initSlider('range_environment_4', 'environmentrange_4')
      document.getElementById("range_regulatory_4").value = 0;
      initSlider('range_regulatory_4', 'regulatoryrange_4')
      document.getElementById("range_supply_4").value = 0;
      initSlider('range_supply_4', 'supplyrange_4')
      document.getElementById("range_data_4").value = 0;
      initSlider('range_data_4', 'datarange_4')
      document.getElementById("range_vuln_4").value = 0;
      initSlider('range_vuln_4', 'vulnrange_4')
      document.getElementById("range_threat_4").value = 0;
      initSlider('range_threat_4', 'threatrange_4')
      document.getElementById("txtAssets_4").value = '';
      document.getElementById("lblriskRating_4").value = '';

      document.getElementById("lblriskSummary_4").value = '';
      document.getElementById("production_outage_4").checked = false;
      document.getElementById('exposed_system_4').checked = false;
      document.getElementById('weak_credentials_4').checked = false;
      document.getElementById("outage_4").value = 0;


      document.getElementById("scenarioCount").value = "";
      document.getElementById("scenario5-tab").click();
      document.getElementById("hdnScenarioID_5").value = '';
      document.getElementById("txtScenarioDescription_5").value = '';
      document.getElementById("txtScenarioAnalysis_5").value = '';
      document.getElementById("selectThreat_5").value = '';
      document.getElementById("selectTactics_5").value = '';
        document.getElementById("id_impact_5").value = '';
      document.getElementById("production_outage_5").checked = false;
      document.getElementById('exposed_system_5').checked = false;
      document.getElementById('weak_credentials_5').checked = false;
      document.getElementById("outage_5").value = 0;

      initSlider('range_safety_5', 'safetyrange_5')
      document.getElementById("range_life_5").value = 0;
      initSlider('range_life_5', 'liferange_5')
      document.getElementById("range_production_5").value = 0;
      initSlider('range_production_5', 'productionrange_5')
      document.getElementById("range_finance_5").value = 0;
      initSlider('range_finance_5', 'financerange_5')
      document.getElementById("range_reputation_5").value = 0;
      initSlider('range_reputation_5', 'reputationrange_5')
      document.getElementById("range_environment_5").value = 0;
      initSlider('range_environment_5', 'environmentrange_5')
      document.getElementById("range_regulatory_5").value = 0;
      initSlider('range_regulatory_5', 'regulatoryrange_5')
      document.getElementById("range_supply_5").value = 0;
      initSlider('range_supply_5', 'supplyrange_5')
      document.getElementById("range_data_5").value = 0;
      initSlider('range_data_5', 'datarange_5')
      document.getElementById("range_vuln_5").value = 0;
      initSlider('range_vuln_5', 'vulnrange_5')
      document.getElementById("range_threat_5").value = 0;
      initSlider('range_threat_5', 'threatrange_5')
      document.getElementById("txtAssets_5").value = '';
      document.getElementById("lblriskRating_5").value = '';

      document.getElementById("lblriskSummary_5").value = '';


      document.getElementById("scenario1-tab").click();
      document.getElementById("hdnScenarioID_1").value = '';
      document.getElementById("txtScenarioDescription_1").value = '';
      document.getElementById("txtScenarioAnalysis_1").value = '';
      document.getElementById("selectThreat_1").value = '';
      document.getElementById("production_outage_1").checked = false;
      document.getElementById('exposed_system_1').checked = false;
      document.getElementById('weak_credentials_1').checked = false;
      document.getElementById("outage_1").value = '';
      document.getElementById("selectTactics_1").value = '';
      document.getElementById("id_impact_1").value = '';
      document.getElementById("range_safety_1").value = 0;
      initSlider('range_safety_1', 'safetyrange_1')
      document.getElementById("range_life_1").value = 0;
      initSlider('range_life_1', 'liferange_1')
      document.getElementById("range_production_1").value = 0;
      initSlider('range_production_1', 'productionrange_1')
      document.getElementById("range_finance_1").value = 0;
      initSlider('range_finance_1', 'financerange_1')
      document.getElementById("range_reputation_1").value = 0;
      initSlider('range_reputation_1', 'reputationrange_1')
      document.getElementById("range_environment_1").value = 0;
      initSlider('range_environment_1', 'environmentrange_1')
      document.getElementById("range_regulatory_1").value = 0;
      initSlider('range_regulatory_1', 'regulatoryrange_1')
      document.getElementById("range_supply_1").value = 0;
      initSlider('range_supply_1', 'supplyrange_1')
      document.getElementById("range_data_1").value = 0;
      initSlider('range_data_1', 'datarange_1')
      document.getElementById("range_vuln_1").value = 0;
      initSlider('range_vuln_1', 'vulnrange_1')
      document.getElementById("range_threat_1").value = 0;
      initSlider('range_threat_1', 'threatrange_1')
      document.getElementById("txtAssets_1").value = '';
      document.getElementById("lblriskRating_1").value = '';
      document.getElementById("lblriskSummary_1").value = '';

    }

function setRiskAssessmentRefreshRequired(scenarioNumber) {
    sessionStorage.setItem('riskAssessmentRefreshRequired_' + scenarioNumber, '1');
}


function setRiskAssessmentRefreshNotRequired(scenarioNumber) {
    sessionStorage.setItem('riskAssessmentRefreshRequired_' + scenarioNumber, '0');
}

function checkRiskAssessmentRefreshVariables() {
    for (let i = 1; i <= 5; i++) {
        let value = sessionStorage.getItem('riskAssessmentRefreshRequired_' + i);
        if (value === '1') {
            alert('Changes have been made to Scenario ' + i + ' that are not reflected in the risk assessment score and estimated costs. Re-run the risk assessment before saving the worksheet.');
            return false; // This will prevent the form submission
        }
    }

    return true; // This will allow the form to be submitted
}

function save_scenario(buttonId) {

    Swal.fire({
        title: 'Save Scenario?',
        text: "Do you want to save the scenario?",
        imageUrl: 'static/images/anzen_owl.png',
        imageWidth: 150, // Adjust as necessary
        imageHeight: 150, // Adjust as necessary
        background: '#000', // Black background
        color: '#fff', // Set text color to white
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes',
        cancelButtonText: 'Cancel',
        customClass: {
            popup: 'swal2-custom-border' // Apply custom class to the popup/dialog
        }
    }).then((result) => {
        if (result.isConfirmed) {
            // Gather data from your form controls
            var scenarioData = {
                'scenarioID': $('#hdnScenarioID_' + buttonId).val(),
                'rawID': sessionStorage.getItem('rawid'),
                'ScenarioDescription': $('#txtScenarioDescription_' + buttonId).val(),
                'RiskScore': $('#lblriskScore_' + buttonId).val(),
                'ThreatScore': $('#range_threat_' + buttonId).val(),
                'VulnScore': $('#range_vuln_' + buttonId).val(),
                'ReputationScore': $('#range_reputation_' + buttonId).val(),
                'OperationScore': $('#range_production_' + buttonId).val(),
                'FinancialScore': $('#range_finance_' + buttonId).val(),
                'SafetyScore': $('#range_safety_' + buttonId).val(),
                'DataScore': $('#range_data_' + buttonId).val(),
                'SupplyChainScore': $('#range_supply_' + buttonId).val(),
                'lifeScore': $('#range_life_' + buttonId).val(),
                'productionScore': $('#range_production_' + buttonId).val(),
                'environmentScore': $('#range_environment_' + buttonId).val(),
                'regulatoryScore': $('#range_regulatory_' + buttonId).val(),
                'RiskStatus': document.getElementById('lblriskRating_' + buttonId).textContent,
                'residual_risk': document.getElementById('lblinherentRisk_' + buttonId).textContent,
                'threatSource': $('#selectThreat_' + buttonId).val(),
                'threatTactic': $('#selectTactics_' + buttonId).val(),
                'impact': $('#id_impact_' + buttonId).val(),
                'riskSummary': $('#lblriskSummary_' + buttonId).val(),
                'justifySafety': $('#txtsafetyJustify_' + buttonId).val(),
                'justifyLife': $('#txtlifeJustify_' + buttonId).val(),
                'justifyProduction': $('#txtproductionJustify_' + buttonId).val(),
                'justifyFinancial': $('#txtfinanceJustify_' + buttonId).val(),
                'justifyReputation': $('#txtreputationJustify_' + buttonId).val(),
                'justifyEnvironment': $('#txtenvironmentJustify_' + buttonId).val(),
                'justifyRegulation': $('#txtregulationJustify_' + buttonId).val(),
                'justifyData': $('#txtdataJustify_' + buttonId).val(),
                'justifySupply': $('#txtsupplyJustify_' + buttonId).val(),
                'outage': $('#production_outage_' + buttonId).prop('checked'),
                'weak_credentials': $('#weak_credentials_' + buttonId).prop('checked'),
                'exposed_system': $('#exposed_system_' + buttonId).prop('checked'),
                'outageLength': $('#outage_' + buttonId).val(),
                'threatSource': $('#selectThreat_' + buttonId).val(),
                'residual_risk': $('#residual_risk_' + buttonId).val(),
                'bia_safety_hazard': $('#hazardNature_' + buttonId).val(),
                'bia_sis_outage': $('input[name="sisOutage_' + buttonId + '"]:checked').val(),
                'bia_sis_compromise': $('input[name="sisIntegrity_' + buttonId + '"]:checked').val(),
                'bia_life_scope': $('#dangerScope_' + buttonId).val(),
                'bia_contaminants': $('#contaminantType_' + buttonId).val(),
                'bia_contamination': $('#contaminationExtent_' + buttonId).val(),
                'bia_resident': $('#effectOnPopulation_' + buttonId).val(),
                'bia_wildlife': $('#effectOnWildlife_' + buttonId).val(),
                'bia_data_pii': $('#dataPII_' + buttonId).val(),
                'bia_data_ip': $('#dataCompanyIP_' + buttonId).val(),
                'bia_data_customer': $('#dataCustomer_' + buttonId).val(),
                'bia_data_finance': $('#dataFinancial_' + buttonId).val(),
                'bia_supply_outbound': $('#outboundSupplyAffected_' + buttonId).val(),
                'bia_supply_inbound': $('#inboundSupplyAffected_' + buttonId).val(),
                'bia_supply_prodimpact': $('#productionImpact_' + buttonId).val(),
                'bia_supply_security': $('#supplyChainSecurityImpact_' + buttonId).val(),
                'raw_consequences': $('#txtScenarioAnalysis_' + buttonId).val(),
                'scenario_damage': $('#txtDamage_' + buttonId).val(),
                'scenario_12month_costs': $('#scenario_12month_costs_' + buttonId).val(),
                'executive_summary': $('#txtexec_summary_' + buttonId).val(),
                'safeguards': [],
                'residual_risk': $('#lblinherentRisk_' + buttonId).textContent,
            };
            // Iterate over each row in the table_safeguards table
            $('#table_safeguards_' + buttonId + ' tbody tr').each(function () {
                var safeguard = $(this).find('textarea').eq(0).val(); // Assuming the first textarea is Safeguard
                var safeguardType = $(this).find('textarea').eq(1).val(); // Assuming the second textarea is Safeguard Type

                // Add this row's data to the scenarioData.safeguards array
                scenarioData.safeguards.push({
                    'safeguard_description': safeguard,
                    'safeguard_type': safeguardType
                });
            });

            $.ajax({
                type: 'POST',
                url: '/OTRisk/create_or_update_raw_scenario/',
                data: scenarioData,
                dataType: 'json',
                success: function (response) {
                    // Handle success response from the server, e.g., show a success message
                    showNotification('Scenario saved successfully: ' + response.message);
                },
                error: function (error) {
                    // Handle error response from the server, e.g., display an error message
                    alert('Error saving scenario: ' + error.responseJSON.error);
                }
            });
            disableAllControls();
        }
    });
    }

function showNotification(message, isError = false) {
    var notificationDiv = document.getElementById('notificationMessage');
    notificationDiv.innerHTML = message;
    notificationDiv.style.display = 'block';
    notificationDiv.className = isError ? 'notification-message error' : 'notification-message';

    // Automatically hide the notification after some time
    setTimeout(function() {
        notificationDiv.style.display = 'none';
    }, 5000); // Hide after 5 seconds
}


function setSliderColor(slider) {

    let value = slider.value;
    let color;
    if (value <= 3) {
        color = "green";
    } else if (value <= 6) {
        color = "yellow";
    } else if (value <= 8) {
        color = "orange";
    } else {
        color = "red";
    }
    slider.style.setProperty("--thumb-color", color);  // Set the color variable
}

$(document).ready(function() {

    $('#rawtable').on('click', 'tbody tr.selectable-row', function() {
        // Remove 'highlighted' class from all other rows
        // $('tr.selectable-row').removeClass('highlighted');

        // Add 'highlighted' class to the clicked row
        // $(this).addClass('highlighted');
    });
    // Trigger click on the first row of the table
    $('#rawtable tbody tr.selectable-row:first').click();

});



    function disableAllControls() {
        // Disable all input, textarea, select, and button elements

        var elements = document.querySelectorAll('input:not([type="hidden"]), textarea, select, button:not(.modal-button)');
        elements.forEach(function(element) {
            element.disabled = true;
        });
        document.getElementById('addNewBtn').disabled = false;
        document.getElementById('editBtn').disabled = false;
        document.getElementById('btnlogout').disabled = false;
    }

    function enableAllControls() {
        // Disable all input, textarea, select, and button elements
        var elements = document.querySelectorAll('input, textarea, select, button');
        elements.forEach(function(element) {
            element.disabled = false;
        });

    }
    // Call the function when the page loads
    window.onload = disableAllControls;


function analyze_Scenario(scenario) {
    var spinner = document.querySelector('.spinner-overlay_' + scenario);
    spinner.style.display = 'flex'; // Show spinner
    var scenarioText = document.getElementById('txtScenarioDescription_' + scenario).value;
    var rawID = sessionStorage.getItem('rawid');

    $.ajax({
        url: "{% url 'OTRisk:analyze_raw_scenario' %}",
        type: 'POST',
        data: {
            'scenario': scenarioText,
            'rawID': rawID,
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function(response) {
            var analyzeTextarea = document.getElementById('txtScenarioAnalysis_' + scenario);
            // Check if 'consequence' exists in the response and is not empty
            if (response.consequence && response.consequence.trim()) {
                analyzeTextarea.value = response.consequence;
            } else {
                // Handle scenarios where 'consequence' is empty or not in response
                analyzeTextarea.value = 'No analysis available.';
            }

            // var attackTreeJson = JSON.stringify(response.incident_flow_diagram);
            // document.getElementById('hdnattacktree').value = attackTreeJson;
            // drawAttackTree(response.incident_flow_diagram);

            // document.getElementById("attacktreerow").style.visibility = "visible";
            spinner.style.display = 'none'; // Hide spinner
        },
        error: function(xhr, status, error) {
            console.error("Error in analyzing scenario: ", status, error);
            spinner.style.display = 'none'; // Hide spinner
        }
    });
}

function drawAttackTree(data) {

    var container = document.getElementById('attack_tree');
    var containerWidth = container.clientWidth;
    var svgWidth = containerWidth; // Use full container width
    var margin = { top: 10, right: 60, bottom: 10, left: 140 }; // Adjusted margins
    var width = svgWidth - margin.left - margin.right;
    var svgHeight = 200; // Match the container height

    // Create an off-screen SVG element for D3 to use
    var svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svgElement.setAttribute("width", svgWidth);
    svgElement.setAttribute("height", svgHeight);
    svgElement.setAttribute("viewBox", "0 0 " + svgWidth + " " + svgHeight);

    // Render the diagram to the off-screen SVG using D3
     var svg = d3.select(svgElement)
        .append("g")
        .attr("transform", "translate(140,10)"); // Adjusted margins

    // Define the arrow marker
    svg.append("svg:defs").selectAll("marker")
        .data(["end"])
        .enter().append("svg:marker")
        .attr("id", String)
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 25)
        .attr("markerWidth", 6)
        .attr("markerHeight", 6)
        .attr("orient", "auto")
        .append("svg:path")
        .attr("d", "M0,-5L10,0L0,5");

     var i = 0;
    var svgHeight = svgHeight * 2; // Increase the height of the SVG
    svgElement.setAttribute("height", svgHeight);
    var treemap = d3.tree()
        .size([svgHeight, svgWidth - margin.left - margin.right])
        .nodeSize([50, 100]); // Adjust node size to control spacing

    var root = d3.hierarchy(data, function(d) { return d.children; });
    root.x0 = svgHeight / 2;
    root.y0 = 0;

    // Color-blind-friendly color scale
    var colorScale = d3.scaleOrdinal(["#88CCEE", "#DDCC77", "#CC6677", "#882255", "#44AA99", "#117733", "#999933", "#AA4499"]);

    update(root);

    function update(source) {
        var treeData = treemap(root);

        var nodes = treeData.descendants(),
            links = treeData.descendants().slice(1);

        nodes.forEach(function(d) {
            d.x = d.x + svgHeight / 4; // Adjust this value as needed
        });

        var node = svg.selectAll('g.node')
            .data(nodes, function(d) { return d.id || (d.id = ++i); });

        var nodeEnter = node.enter().append('g')
            .attr('class', 'node')
            .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });

        nodeEnter.append('circle')
            .attr('r', 5) // Smaller radius
            .style("stroke", "black")
            .style("stroke-width", 1.5)
            .style("fill", function(d) { return colorScale(d.depth); });

        nodeEnter.append('text')
            .style("fill", "darkgray")
            .style("font-size", "14px") // Increased font size
            .style("font-weight", "bold")
            .attr("transform", "rotate(-10)")
            .attr("dy", ".35em")
            .attr("x", function(d) { return d.children ? -13 - this.getComputedTextLength() : 13; })
            .attr("text-anchor", function(d) { return d.children ? "end" : "start"; })
            .text(function(d) { return d.data.name; });

        var link = svg.selectAll('path.link')
            .data(links, function(d) { return d.id; });

        link.enter().insert('path', "g")
            .attr("class", "link")
            .style("stroke", function(d) { return colorScale(d.depth); })
            .style("stroke-width", 2)
            .style("fill", "none")
            .attr("marker-end", "url(#end)") // Add the arrow marker
            .attr('d', function(d) {
                return "M" + d.y + "," + d.x
                    + "C" + (d.y + d.parent.y) / 2 + "," + d.x
                    + " " + (d.y + d.parent.y) / 2 + "," + d.parent.x
                    + " " + d.parent.y + "," + d.parent.x;
            });
    }

     // Ensure the SVG is fully rendered before converting
    setTimeout(function() {
        convertSVGtoPNG(svgElement).then(pngUrl => {
            // Display the PNG in the attack_tree container
            container.innerHTML = '<img src="' + pngUrl + '" style="width: 100%; height: auto;">';
        }).catch(error => {
            console.error("Error converting SVG to PNG:", error);
        });
    }, 0); // Timeout set to 0 to allow the rendering cycle to complet
}

function convertSVGtoPNG(svgElement) {
    return new Promise((resolve, reject) => {
        var svgData = new XMLSerializer().serializeToString(svgElement);
        var canvas = document.createElement('canvas');
        var ctx = canvas.getContext('2d');
        var img = new Image();

        canvas.width = svgElement.getAttribute("width");
        canvas.height = svgElement.getAttribute("height");

        img.onload = function() {
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            var pngUrl = canvas.toDataURL("image/png");
            resolve(pngUrl);
        };

        img.onerror = function() {
            reject(new Error("Error loading SVG data into image"));
        };

        img.src = 'data:image/svg+xml; charset=utf8, ' + encodeURIComponent(svgData);
    });
}

</script>

 <textarea id="lblriskSummary_1" name="lblriskSummary_1" class="form-control" readonly style="resize: none; visibility: hidden" rows="15" > </textarea>
<textarea id="lblriskSummary_2" name="lblriskSummary_2" class="form-control" readonly style="resize: none; visibility: hidden" rows="15" > </textarea>
<textarea id="lblriskSummary_3" name="lblriskSummary_3" class="form-control" readonly style="resize: none; visibility: hidden" rows="15" > </textarea>
<textarea id="lblriskSummary_4" name="lblriskSummary_4" class="form-control" readonly style="resize: none; visibility: hidden" rows="15" > </textarea>
<textarea id="lblriskSummary_5" name="lblriskSummary_5" class="form-control" readonly style="resize: none; visibility: hidden" rows="15" > </textarea>




</body>
</html>